<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ¥µè‡´æ•¸ç¨ Web</title>
    <!-- å¼•å…¥ Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- å¼•å…¥ Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&display=swap" rel="stylesheet">
    <!-- å¼•å…¥ SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <style>
        body { font-family: 'Noto Sans TC', sans-serif; }

        .sudoku-cell {
            transition: background-color 0.2s;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Courier New', monospace;
            position: relative;
        }

        /* æ ¼ç·šæ¨£å¼ */
        .sudoku-cell:nth-child(3n) { border-right-width: 2px; border-right-color: #374151; }
        .sudoku-cell:nth-child(9n) { border-right-width: 1px; border-right-color: #9CA3AF; }
        .sudoku-cell:nth-child(n+19):nth-child(-n+27),
        .sudoku-cell:nth-child(n+46):nth-child(-n+54) { border-bottom-width: 2px; border-bottom-color: #374151; }

        .grid-cols-9 > div:nth-child(9n) { border-right-width: 0; }
        .grid-cols-9 > div:nth-last-child(-n+9) { border-bottom-width: 0; }

        /* é¸ä¸­èˆ‡é«˜äº® */
        .cell-selected { background-color: #BFDBFE !important; transform: scale(0.95); border-radius: 4px; z-index: 10; }
        .cell-highlight { background-color: #E5E7EB !important; }

        /* æ–‡å­—é¡è‰² */
        .is-original { color: #111827; font-weight: 800; }
        .is-user { color: #2563EB; font-weight: 600; }

        /* === æ–°å¢ï¼šéŒ¯èª¤æç¤ºæ¨£å¼ === */
        .is-error {
            color: #EF4444 !important; /* ç´…å­— */
            background-color: #FEE2E2 !important; /* ç´…åº• */
            animation: shake 0.3s ease-in-out; /* æ™ƒå‹•å‹•ç•« */
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-4px); }
            75% { transform: translateX(4px); }
        }

        * { touch-action: manipulation; }
    </style>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col items-center py-6 px-2 select-none">

    <header class="mb-6 text-center">
        <h1 class="text-3xl md:text-4xl font-bold text-gray-800 tracking-wider">æ•¸ç¨ <span class="text-blue-600">SUDOKU</span></h1>
        <p class="text-gray-500 text-sm mt-1">å³æ™‚é©—è­‰ + æš«åœåŠŸèƒ½ç‰ˆ</p>
    </header>

    <main class="w-full max-w-5xl flex flex-col md:flex-row gap-8 items-start justify-center">

        <!-- å·¦å´ï¼šæ£‹ç›¤å€ (å¢åŠ  relative ä»¥ä¾¿æ”¾ç½®æš«åœé®ç½©) -->
        <div class="relative w-full max-w-md md:max-w-[500px] mx-auto bg-white p-1 shadow-xl rounded-lg border-4 border-gray-800">

            <!-- æš«åœé®ç½©å±¤ -->
            <div id="pause-overlay" class="hidden absolute inset-0 bg-gray-900/95 z-50 flex flex-col items-center justify-center text-white rounded-sm backdrop-blur-sm">
                <div class="text-6xl mb-4">â¸</div>
                <h2 class="text-3xl font-bold mb-6 tracking-widest">éŠæˆ²æš«åœ</h2>
                <button onclick="togglePause()" class="px-8 py-3 bg-blue-600 hover:bg-blue-500 rounded-full font-bold text-lg shadow-lg transition transform hover:scale-105 active:scale-95">
                    ç¹¼çºŒéŠæˆ²
                </button>
            </div>

            <div id="grid-container" class="grid grid-cols-9 grid-rows-9 w-full aspect-square border border-gray-400 bg-gray-50">
                <!-- JS å‹•æ…‹ç”Ÿæˆ -->
            </div>
        </div>

        <!-- å³å´ï¼šæ§åˆ¶é¢æ¿ -->
        <div class="w-full max-w-md mx-auto md:w-80 flex flex-col gap-6">

            <!-- ç‹€æ…‹å¡ç‰‡ (ä¿®æ”¹è¨ˆæ™‚å™¨å€åŸŸ) -->
            <div class="bg-white p-4 rounded-xl shadow-md border-l-4 border-blue-500 flex justify-between items-center">
                <div>
                    <span class="text-gray-500 text-xs uppercase font-bold">é›£åº¦ Difficulty</span>
                    <select id="difficulty-select" class="block w-full mt-1 font-bold text-gray-800 bg-transparent border-none focus:ring-0 cursor-pointer">
                        <option value="1">ç°¡å–® Easy</option>
                        <option value="2">ä¸­ç­‰ Medium</option>
                        <option value="3">å›°é›£ Hard</option>
                    </select>
                </div>
                <div class="text-right flex flex-col items-end">
                    <span class="text-gray-500 text-xs uppercase font-bold mb-1">è¨ˆæ™‚ Time</span>
                    <div class="flex items-center gap-2 bg-gray-100 px-3 py-1 rounded-lg">
                        <div id="timer" class="text-xl font-mono font-bold text-blue-600 w-16 text-center">00:00</div>
                        <!-- æš«åœæŒ‰éˆ• -->
                        <button id="pause-btn" onclick="togglePause()" class="text-gray-500 hover:text-blue-600 transition focus:outline-none" title="æš«åœ/ç¹¼çºŒ">
                            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/></svg>
                        </button>
                    </div>
                </div>
            </div>

            <!-- è™›æ“¬éµç›¤ -->
            <div class="bg-white p-4 rounded-xl shadow-md">
                <div class="flex justify-between items-end mb-2">
                    <p class="text-xs text-gray-400 font-bold uppercase">è¼¸å…¥ Input</p>
                    <span class="text-[10px] text-red-500 font-bold bg-red-50 px-2 py-0.5 rounded-full">å³æ™‚æª¢æŸ¥é–‹å•Ÿä¸­</span>
                </div>
                <div class="grid grid-cols-5 gap-2">
                    <button class="numpad-btn h-12 bg-gray-100 hover:bg-blue-100 text-blue-800 font-bold rounded-lg text-xl transition active:scale-95 border border-gray-200" onclick="inputNumber(1)">1</button>
                    <button class="numpad-btn h-12 bg-gray-100 hover:bg-blue-100 text-blue-800 font-bold rounded-lg text-xl transition active:scale-95 border border-gray-200" onclick="inputNumber(2)">2</button>
                    <button class="numpad-btn h-12 bg-gray-100 hover:bg-blue-100 text-blue-800 font-bold rounded-lg text-xl transition active:scale-95 border border-gray-200" onclick="inputNumber(3)">3</button>
                    <button class="numpad-btn h-12 bg-gray-100 hover:bg-blue-100 text-blue-800 font-bold rounded-lg text-xl transition active:scale-95 border border-gray-200" onclick="inputNumber(4)">4</button>
                    <button class="numpad-btn h-12 bg-gray-100 hover:bg-blue-100 text-blue-800 font-bold rounded-lg text-xl transition active:scale-95 border border-gray-200" onclick="inputNumber(5)">5</button>
                    <button class="numpad-btn h-12 bg-gray-100 hover:bg-blue-100 text-blue-800 font-bold rounded-lg text-xl transition active:scale-95 border border-gray-200" onclick="inputNumber(6)">6</button>
                    <button class="numpad-btn h-12 bg-gray-100 hover:bg-blue-100 text-blue-800 font-bold rounded-lg text-xl transition active:scale-95 border border-gray-200" onclick="inputNumber(7)">7</button>
                    <button class="numpad-btn h-12 bg-gray-100 hover:bg-blue-100 text-blue-800 font-bold rounded-lg text-xl transition active:scale-95 border border-gray-200" onclick="inputNumber(8)">8</button>
                    <button class="numpad-btn h-12 bg-gray-100 hover:bg-blue-100 text-blue-800 font-bold rounded-lg text-xl transition active:scale-95 border border-gray-200" onclick="inputNumber(9)">9</button>
                    <button class="h-12 bg-red-50 hover:bg-red-100 text-red-600 font-bold rounded-lg transition active:scale-95 border border-red-100 flex items-center justify-center" onclick="inputNumber(0)">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 4H8l-7 8 7 8h13a2 2 0 0 0 2-2V6a2 2 0 0 0-2-2z"></path><line x1="18" y1="9" x2="12" y2="15"></line><line x1="12" y1="9" x2="18" y2="15"></line></svg>
                    </button>
                </div>
            </div>

            <div class="flex flex-col gap-3">
                <button onclick="newGame()" class="w-full py-3 bg-blue-600 hover:bg-blue-700 text-white font-bold rounded-lg shadow transition active:scale-95 flex items-center justify-center gap-2">
                    âœ¨ é–‹å§‹æ–°éŠæˆ²
                </button>
                <div class="flex gap-3">
                    <button onclick="checkGame()" class="flex-1 py-3 bg-green-500 hover:bg-green-600 text-white font-bold rounded-lg shadow transition active:scale-95">
                        âœ… å…¨ç›¤æª¢æŸ¥
                    </button>
                    <button onclick="resetBoard()" class="flex-1 py-3 bg-gray-500 hover:bg-gray-600 text-white font-bold rounded-lg shadow transition active:scale-95">
                        ğŸ”„ é‡ç½®
                    </button>
                </div>
            </div>
        </div>
    </main>

    <footer class="mt-8 text-gray-400 text-sm">
        &copy; 2025 Sudoku Web App
    </footer>

    <script>
        // --- 1. æ ¸å¿ƒé‚è¼¯ ---
        class SudokuCore {
            constructor() {
                this.board = Array(9).fill().map(() => Array(9).fill(0));
                this.solution = Array(9).fill().map(() => Array(9).fill(0));
                this.original = Array(9).fill().map(() => Array(9).fill(0));
            }
            generate(difficulty) {
                this.board = Array(9).fill().map(() => Array(9).fill(0));
                for(let i=0; i<9; i+=3) this.fillBox(i, i);
                this.solve(this.board);
                this.solution = JSON.parse(JSON.stringify(this.board));
                let attempts = difficulty === '1' ? 30 : difficulty === '2' ? 40 : 50;
                this.removeDigits(attempts);
                this.original = JSON.parse(JSON.stringify(this.board));
            }
            fillBox(row, col) {
                let num;
                for(let i=0; i<3; i++) {
                    for(let j=0; j<3; j++) {
                        do { num = Math.floor(Math.random() * 9) + 1; } while(!this.isSafeInBox(row, col, num));
                        this.board[row+i][col+j] = num;
                    }
                }
            }
            isSafeInBox(rowStart, colStart, num) {
                for(let i=0; i<3; i++) for(let j=0; j<3; j++) if(this.board[rowStart+i][colStart+j] === num) return false;
                return true;
            }
            isSafe(grid, row, col, num) {
                for(let x=0; x<9; x++) if(grid[row][x] === num) return false;
                for(let x=0; x<9; x++) if(grid[x][col] === num) return false;
                let startRow = row - row % 3, startCol = col - col % 3;
                for(let i=0; i<3; i++) for(let j=0; j<3; j++) if(grid[i+startRow][j+startCol] === num) return false;
                return true;
            }
            solve(grid) {
                for(let i=0; i<9; i++) {
                    for(let j=0; j<9; j++) {
                        if(grid[i][j] === 0) {
                            for(let num=1; num<=9; num++) {
                                if(this.isSafe(grid, i, j, num)) {
                                    grid[i][j] = num;
                                    if(this.solve(grid)) return true;
                                    grid[i][j] = 0;
                                }
                            }
                            return false;
                        }
                    }
                }
                return true;
            }
            removeDigits(count) {
                while(count > 0) {
                    let cellId = Math.floor(Math.random() * 81);
                    let i = Math.floor(cellId / 9), j = cellId % 9;
                    if(this.board[i][j] !== 0) { this.board[i][j] = 0; count--; }
                }
            }
        }

        // --- 2. ä»‹é¢æ§åˆ¶é‚è¼¯ ---
        const core = new SudokuCore();
        let selectedCell = null;
        let timerInterval = null;
        let seconds = 0;
        let isPaused = false; // æš«åœç‹€æ…‹

        function initGrid() {
            const container = document.getElementById('grid-container');
            container.innerHTML = '';
            for(let r=0; r<9; r++) {
                for(let c=0; c<9; c++) {
                    const cell = document.createElement('div');
                    cell.className = 'sudoku-cell border-gray-300 border border-collapse text-2xl md:text-3xl select-none';
                    cell.dataset.r = r;
                    cell.dataset.c = c;
                    cell.onclick = () => selectCell(r, c);
                    container.appendChild(cell);
                }
            }
        }

        function newGame() {
            if (isPaused) togglePause(); // ç¢ºä¿æ–°éŠæˆ²æ™‚ä¸æ˜¯æš«åœç‹€æ…‹
            const diff = document.getElementById('difficulty-select').value;
            core.generate(diff);
            renderBoard();
            resetTimer();
            selectedCell = null;
            highlightSameNumber(0);
        }

        function renderBoard() {
            for(let r=0; r<9; r++) {
                for(let c=0; c<9; c++) {
                    const cell = document.querySelector(`.sudoku-cell[data-r='${r}'][data-c='${c}']`);
                    const val = core.board[r][c];
                    const isOrig = core.original[r][c] !== 0;

                    cell.textContent = val === 0 ? '' : val;
                    // æ¸…é™¤æ‰€æœ‰ç‹€æ…‹é¡åˆ¥ï¼Œé‡æ–°è³¦äºˆåŸºç¤é¡åˆ¥
                    cell.className = `sudoku-cell border-gray-300 border text-2xl md:text-3xl select-none ${isOrig ? 'is-original bg-gray-100' : 'is-user bg-white'}`;

                    if(selectedCell && selectedCell.r === r && selectedCell.c === c) {
                        cell.classList.add('cell-selected');
                    }

                    // --- æ¸²æŸ“æ™‚ä¿ç•™éŒ¯èª¤ç‹€æ…‹ ---
                    // å¦‚æœæ˜¯ä½¿ç”¨è€…è¼¸å…¥(éé¡Œç›®)ï¼Œä¸”å€¼ä¸ç‚º0ï¼Œä¸”å€¼ä¸ç­‰æ–¼è§£ç­” => æ¨™è¨˜éŒ¯èª¤
                    if (!isOrig && val !== 0 && val !== core.solution[r][c]) {
                        cell.classList.add('is-error');
                    }
                }
            }
        }

        function selectCell(r, c) {
            if(isPaused) return; // æš«åœæ™‚ç¦æ­¢é¸å–
            if (core.original[r][c] !== 0) {
                highlightSameNumber(core.board[r][c]);
                return;
            }
            selectedCell = {r, c};
            // é‡æ–°æ¸²æŸ“ä»¥æ›´æ–°é¸å–æ¡†ï¼ŒåŒæ™‚ä¿æŒä¹‹å‰çš„éŒ¯èª¤æ¨™è¨˜
            renderBoard();
            highlightSameNumber(core.board[r][c]);
        }

        function highlightSameNumber(num) {
            document.querySelectorAll('.cell-highlight').forEach(el => el.classList.remove('cell-highlight'));
            if(num === 0) return;
            for(let r=0; r<9; r++) {
                for(let c=0; c<9; c++) {
                    if(core.board[r][c] === num) {
                        const cell = document.querySelector(`.sudoku-cell[data-r='${r}'][data-c='${c}']`);
                        if(!cell.classList.contains('cell-selected')) cell.classList.add('cell-highlight');
                    }
                }
            }
        }

        // === æ ¸å¿ƒä¿®æ”¹ï¼šè¼¸å…¥èˆ‡å³æ™‚é©—è­‰ ===
        function inputNumber(num) {
            if(!selectedCell || isPaused) return;
            const {r, c} = selectedCell;
            const cell = document.querySelector(`.sudoku-cell[data-r='${r}'][data-c='${c}']`);

            core.board[r][c] = num;

            // 1. æ›´æ–°æ–‡å­—
            cell.textContent = num === 0 ? '' : num;

            // 2. å³æ™‚é©—è­‰é‚è¼¯
            if (num !== 0) {
                if (num !== core.solution[r][c]) {
                    // è¼¸å…¥éŒ¯èª¤ -> åŠ ç´…å­—ã€ç´…åº•ã€æ™ƒå‹•
                    cell.classList.add('is-error');
                } else {
                    // è¼¸å…¥æ­£ç¢º -> ç§»é™¤éŒ¯èª¤æ¨£å¼
                    cell.classList.remove('is-error');
                }
            } else {
                // æ¸…é™¤æ•¸å­— -> ç§»é™¤éŒ¯èª¤æ¨£å¼
                cell.classList.remove('is-error');
            }

            highlightSameNumber(num);

            // æª¢æŸ¥æ˜¯å¦å®Œæˆ
            checkCompletion();
        }

        // è‡ªå‹•æª¢æŸ¥æ˜¯å¦å…¨å°ï¼ˆç„¡é ˆæŒ‰éˆ•ï¼‰
        function checkCompletion() {
            let isFull = true;
            let isAllCorrect = true;
            for(let r=0; r<9; r++) {
                for(let c=0; c<9; c++) {
                    if(core.board[r][c] === 0) isFull = false;
                    if(core.board[r][c] !== core.solution[r][c]) isAllCorrect = false;
                }
            }
            if(isFull && isAllCorrect) {
                clearInterval(timerInterval);
                Swal.fire({
                    icon: 'success',
                    title: 'ğŸ‰ å¤ªç¥å•¦ï¼',
                    text: `æ­å–œå®Œæˆï¼è€—æ™‚: ${document.getElementById('timer').innerText}`,
                    confirmButtonColor: '#10B981'
                });
            }
        }

        function checkGame() {
            // æ‰‹å‹•æª¢æŸ¥æŒ‰éˆ•é‚è¼¯ (ä¸»è¦ç”¨æ–¼æª¢æŸ¥æ˜¯å¦æœ‰æ¼å¡«)
            let isFull = true;
            let hasError = false;
            for(let r=0; r<9; r++) {
                for(let c=0; c<9; c++) {
                    if(core.board[r][c] === 0) isFull = false;
                    else if(core.board[r][c] !== core.solution[r][c]) hasError = true;
                }
            }

            if (hasError) {
                Swal.fire({ icon: 'error', title: 'æœ‰éŒ¯èª¤', text: 'è«‹æª¢æŸ¥ç´…è‰²çš„æ ¼å­ï¼', confirmButtonColor: '#EF4444' });
            } else if (!isFull) {
                Swal.fire({ icon: 'info', title: 'æœªå®Œæˆ', text: 'é‚„æœ‰æ ¼å­æ²’å¡«å–”ï¼', confirmButtonColor: '#3B82F6' });
            } else {
                checkCompletion(); // å¦‚æœå…¨æ»¿ä¸”ç„¡éŒ¯ï¼Œè§¸ç™¼å‹åˆ©
            }
        }

        function resetBoard() {
            if(isPaused) return;
            Swal.fire({
                title: 'é‡ç½®ç›¤é¢ï¼Ÿ',
                text: "å°‡æ¸…é™¤æ‰€æœ‰é€²åº¦",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#6B7280',
                cancelButtonColor: '#d33',
                confirmButtonText: 'é‡ç½®'
            }).then((result) => {
                if (result.isConfirmed) {
                    for(let r=0; r<9; r++) {
                        for(let c=0; c<9; c++) {
                            core.board[r][c] = core.original[r][c];
                        }
                    }
                    renderBoard(); // é‡æ–°æ¸²æŸ“æœƒè‡ªå‹•æ¸…é™¤ .is-error
                }
            })
        }

        // === æ ¸å¿ƒä¿®æ”¹ï¼šè¨ˆæ™‚å™¨èˆ‡æš«åœ ===
        function resetTimer() {
            clearInterval(timerInterval);
            seconds = 0;
            isPaused = false;
            updateTimerDisplay();
            startTimer();
        }

        function startTimer() {
            clearInterval(timerInterval);
            timerInterval = setInterval(() => {
                if (!isPaused) { // åªæœ‰éæš«åœæ™‚æ‰è¨ˆæ™‚
                    seconds++;
                    updateTimerDisplay();
                }
            }, 1000);
        }

        function togglePause() {
            isPaused = !isPaused;
            const overlay = document.getElementById('pause-overlay');
            const pauseBtn = document.getElementById('pause-btn');

            if (isPaused) {
                // æš«åœç‹€æ…‹ï¼šé¡¯ç¤ºé®ç½©ã€åˆ‡æ›åœ–æ¨™
                overlay.classList.remove('hidden');
                pauseBtn.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M8 5v14l11-7z"/></svg>'; // Play Icon
            } else {
                // ç¹¼çºŒç‹€æ…‹ï¼šéš±è—é®ç½©ã€åˆ‡æ›åœ–æ¨™
                overlay.classList.add('hidden');
                pauseBtn.innerHTML = '<svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="currentColor"><path d="M6 19h4V5H6v14zm8-14v14h4V5h-4z"/></svg>'; // Pause Icon
            }
        }

        function updateTimerDisplay() {
            const m = Math.floor(seconds / 60).toString().padStart(2, '0');
            const s = (seconds % 60).toString().padStart(2, '0');
            document.getElementById('timer').textContent = `${m}:${s}`;
        }

        // éµç›¤ç›£è½
        document.addEventListener('keydown', (e) => {
            if(isPaused) return; // æš«åœæ™‚é–å®šéµç›¤
            if(!selectedCell) return;
            if(e.key >= '1' && e.key <= '9') inputNumber(parseInt(e.key));
            if(e.key === 'Backspace' || e.key === 'Delete') inputNumber(0);
            if(['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight'].includes(e.key)) {
                e.preventDefault();
                moveSelection(e.key);
            }
        });

        function moveSelection(key) {
            let {r, c} = selectedCell;
            if(key === 'ArrowUp') r = Math.max(0, r-1);
            if(key === 'ArrowDown') r = Math.min(8, r+1);
            if(key === 'ArrowLeft') c = Math.max(0, c-1);
            if(key === 'ArrowRight') c = Math.min(8, c+1);

            selectedCell = {r, c};
            renderBoard();
            highlightSameNumber(core.board[r][c]);
        }

        initGrid();
        newGame();
    </script>
</body>
</html>
