<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç§˜å¯†è½‰ç›¤</title>
    <!-- Firebase é…ç½®ï¼ˆå¿…é ˆåœ¨ Firebase SDK ä¹‹å‰è¼‰å…¥ï¼‰ -->
    <script src="firebase-config.js"></script>
    <!-- è¼‰å…¥ Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        // è¨­å®š Tailwind é…ç½®
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'Noto Sans TC', 'sans-serif'],
                    },
                    colors: {
                        'primary-buy': '#10b981', // Emerald green
                        'secondary-bad': '#ef4444', // Red
                        'accent-spin': '#fcd34d', // Amber
                    }
                }
            }
        }
    </script>
    <style>
        /* ç¢ºä¿ Canvas å±…ä¸­ä¸”éŸ¿æ‡‰å¼ */
        #wheelCanvas {
            box-shadow: 0 20px 40px -10px rgba(0, 0, 0, 0.4), 0 0 0 4px rgba(255, 255, 255, 0.1);
            border-radius: 9999px;
            transition: transform 3000ms cubic-bezier(0.17, 0.67, 0.12, 0.99);
            background: radial-gradient(circle at center, rgba(255, 255, 255, 0.1), transparent);
        }

        /* æŒ‡é‡æ¨£å¼ */
        .pointer {
            position: absolute;
            top: -18px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 20px solid transparent;
            border-right: 20px solid transparent;
            border-top: 38px solid #ffffff;
            z-index: 20;
            filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.4));
        }
        .pointer::before {
            content: '';
            position: absolute;
            top: -38px;
            left: -14px;
            width: 0;
            height: 0;
            border-left: 14px solid transparent;
            border-right: 14px solid transparent;
            border-top: 24px solid #f1f5f9;
            z-index: 1;
        }

        .canvas-container {
            position: relative;
            width: 100%;
            max-width: 600px; /* é™åˆ¶æœ€å¤§å¯¬åº¦ */
            margin: auto;
            aspect-ratio: 1 / 1; /* ä¿æŒæ­£æ–¹å½¢ */
        }

        /* ç¦ç”¨æŒ‰éˆ•æ¨£å¼ */
        .delete-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            color: #9ca3af !important;
        }

    </style>
</head>
<body class="bg-gray-50 min-h-screen p-4 font-sans">
    <div class="max-w-7xl mx-auto">
        <div class="flex justify-between items-center mb-4">
            <h1 class="text-3xl font-bold text-gray-800" id="wheelTitle">
                å‘½é‹è¼ªç›¤
            </h1>
            <a href="admin.html" class="text-sm text-gray-500 hover:text-gray-700 underline">å¾Œå°ç®¡ç†</a>
        </div>
        <p id="wheelDescription" class="text-center text-gray-600 mb-8" style="display: none;">
            <!-- èªªæ˜å°‡å‹•æ…‹é¡¯ç¤ºåœ¨é€™è£¡ -->
        </p>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- å·¦å´ï¼šè½‰ç›¤å€åŸŸ -->
            <div class="lg:col-span-2 bg-white p-6 md:p-10 rounded-xl shadow-2xl">
                <!-- è½‰ç›¤å’ŒæŒ‡é‡å®¹å™¨ -->
                <div class="canvas-container">
                    <!-- æŒ‡é‡ (ä½æ–¼é ‚éƒ¨ä¸­å¿ƒ) -->
                    <div class="pointer"></div>

                    <!-- è½‰ç›¤ Canvas -->
                    <canvas id="wheelCanvas" width="800" height="800" class="w-full h-full"></canvas>
                </div>

                <!-- æ—‹è½‰æŒ‰éˆ•å’Œçµæœé¡¯ç¤º -->
                <div class="flex flex-col items-center mt-8 space-y-4">
                    <button id="spinButton"
                            class="w-full md:w-auto px-10 py-4 text-xl font-bold text-gray-900 bg-accent-spin rounded-full shadow-lg transition duration-300 ease-in-out transform hover:scale-105 active:scale-95 disabled:opacity-50 disabled:cursor-not-allowed border-b-4 border-yellow-700/50">
                        é–‹å§‹æ—‹è½‰ï¼
                    </button>
                    <div id="resultDisplay"
                         class="min-h-[50px] w-full text-center text-2xl font-extrabold text-gray-700 p-3 rounded-lg bg-gray-100 transition-all duration-500 shadow-inner">
                        æŒ‰ä¸‹æŒ‰éˆ•é–‹å§‹
                    </div>
                </div>

                <!-- ä¸­çæ©Ÿç‡è¡¨æ ¼ -->
                <div class="mt-8 pt-6 border-t border-gray-200">
                    <h3 class="text-lg font-semibold text-gray-700 mb-4 text-center">ä¸­çæ©Ÿç‡</h3>
                    <div class="overflow-x-auto">
                        <table id="optionsDisplay" class="w-full border-collapse">
                            <thead>
                                <tr class="bg-gray-100">
                                    <th class="border border-gray-300 px-4 py-2 text-left">é¸é …</th>
                                    <th class="border border-gray-300 px-4 py-2 text-center">ä¸­çæ©Ÿç‡</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- é¸é …å°‡å‹•æ…‹é¡¯ç¤ºåœ¨é€™è£¡ -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- å³å´ï¼šè¨˜éŒ„æ˜ç´°å’Œé›²ç«¯åˆ†äº« -->
            <div class="lg:col-span-1 space-y-6">
                <!-- è½‰ç›¤è¨˜éŒ„ -->
                <div class="bg-white p-6 rounded-xl shadow-2xl">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-xl font-bold text-gray-800">è½‰ç›¤è¨˜éŒ„</h2>
                        <button id="resetHistoryBtn"
                                class="px-4 py-2 bg-red-500 text-white text-sm rounded hover:bg-red-600 transition">
                            é‡ç½®
                        </button>
                    </div>
                    <div id="historyDisplay" class="space-y-2 max-h-[400px] overflow-y-auto">
                        <p class="text-gray-500 text-sm text-center py-4">å°šç„¡è¨˜éŒ„</p>
                    </div>
                </div>

                <!-- é›²ç«¯åŒæ­¥åˆ†äº« -->
                <div class="bg-white p-6 rounded-xl shadow-2xl">
                    <h3 class="font-bold text-sm text-gray-600 uppercase tracking-widest mb-4">é›²ç«¯åŒæ­¥åˆ†äº«</h3>
                    <div id="dbStatus" class="text-[10px] text-gray-500 mb-2">æœªé€£ç·š</div>
                    <button id="cloudShareBtn" class="w-full bg-gray-700 hover:bg-gray-600 text-white py-3 rounded-xl text-xs font-bold transition-all disabled:opacity-50 disabled:cursor-not-allowed">ç”Ÿæˆåˆ†äº«é€£çµ</button>
                    <div id="shareArea" class="hidden space-y-2 mt-4">
                        <input type="text" id="shareUrlInput" readonly class="w-full bg-gray-100 border border-gray-300 rounded-lg px-3 py-2 text-[10px] text-indigo-600 focus:outline-none">
                        <button id="copyBtn" class="w-full bg-indigo-100 text-indigo-700 py-2 rounded-lg text-[10px] hover:bg-indigo-200">è¤‡è£½é€£çµ</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Firebase SDKs -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, collection, addDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Firebase é…ç½®
        let firebaseConfig;
        let firebaseEnabled = false;

        try {
            if (typeof __firebase_config !== 'undefined' && __firebase_config) {
                firebaseConfig = typeof __firebase_config === 'string'
                    ? JSON.parse(__firebase_config)
                    : __firebase_config;
                firebaseEnabled = true;
            } else {
                console.warn('âš ï¸ æœªæª¢æ¸¬åˆ°å¤–éƒ¨ Firebase é…ç½®');
                firebaseEnabled = false;
            }
        } catch (e) {
            console.error('âŒ Firebase é…ç½®è§£æå¤±æ•—:', e);
            firebaseEnabled = false;
        }

        const APP_ID = typeof __app_id !== 'undefined' ? __app_id : 'eoelior-wheel-data';

        // åˆå§‹åŒ– Firebase
        let app, auth, db;
        if (firebaseEnabled) {
            try {
                app = initializeApp(firebaseConfig);
                auth = getAuth(app);
                db = getFirestore(app);
            } catch (e) {
                console.error('âŒ Firebase åˆå§‹åŒ–å¤±æ•—:', e);
                firebaseEnabled = false;
            }
        }

        // æ›´æ–°é€£ç·šç‹€æ…‹é¡¯ç¤º
        function updateDbStatus(status, text) {
            const statusEl = document.getElementById('dbStatus');
            if (statusEl) {
                statusEl.innerText = text || status;
                statusEl.className = `text-[10px] ${
                    status === 'connected' ? 'text-green-600' :
                    status === 'connecting' ? 'text-yellow-600' :
                    'text-gray-500'
                }`;
            }
        }

        // åˆå§‹åŒ– Firebase èªè­‰
        async function initFirebase() {
            if (!firebaseEnabled || !auth) {
                updateDbStatus('disabled', 'æœªå•Ÿç”¨');
                return;
            }

            try {
                updateDbStatus('connecting', 'é€£ç·šä¸­...');
                await signInAnonymously(auth);

                onAuthStateChanged(auth, async (user) => {
                    if (user) {
                        updateDbStatus('connected', 'é›²ç«¯å·²é€£ç·š');

                        // æª¢æŸ¥ URL åƒæ•¸æ˜¯å¦æœ‰ Firebase åˆ†äº« ID
                        const params = new URLSearchParams(window.location.search);
                        const shareId = params.get('share');

                        if (shareId) {
                            try {
                                const snap = await getDoc(
                                    doc(db, 'artifacts', APP_ID, 'public', 'data', 'shared_wheels', shareId)
                                );
                                if (snap.exists()) {
                                    const firebaseConfig = snap.data();
                                    // è§¸ç™¼é…ç½®æ›´æ–°ï¼ˆé€šé window äº‹ä»¶ï¼‰
                                    window.dispatchEvent(new CustomEvent('firebaseConfigLoaded', { detail: firebaseConfig }));
                                }
                            } catch (e) {
                                console.error('è¼‰å…¥ Firebase åˆ†äº«é…ç½®å¤±æ•—:', e);
                            }
                        }
                    }
                });
            } catch (e) {
                console.error('Firebase èªè­‰å¤±æ•—:', e);
                updateDbStatus('error', 'é€£ç·šå¤±æ•—');
            }
        }

        // é›²ç«¯åˆ†äº«åŠŸèƒ½
        window.cloudShareWheel = async function(config) {
            if (!firebaseEnabled || !db) {
                alert('é›²ç«¯åŠŸèƒ½æœªå•Ÿç”¨ï¼Œè«‹æª¢æŸ¥ Firebase é…ç½®');
                return null;
            }

            try {
                const docRef = await addDoc(
                    collection(db, 'artifacts', APP_ID, 'public', 'data', 'shared_wheels'),
                    config
                );

                const shareUrl = window.location.origin + window.location.pathname + "?share=" + docRef.id;
                return shareUrl;
            } catch (e) {
                console.error('åˆ†äº«å¤±æ•—:', e);
                throw e;
            }
        };

        // å•Ÿå‹• Firebaseï¼ˆå¦‚æœå¯ç”¨ï¼‰
        if (firebaseEnabled) {
            initFirebase();
        } else {
            updateDbStatus('disabled', 'æœªå•Ÿç”¨');
        }
    </script>

    <script>
        // æ¨¡å¼å®šç¾©
        const MODES = {
            buy: {
                display: [50, 50],
                real: [80, 20]
            },
            fair: {
                display: [50, 50],
                real: [50, 50]
            }
        };

        const params = new URLSearchParams(location.search);
        const mode = params.get("mode");

        if (mode && MODES[mode]) {
            window.WHEEL_MODE = MODES[mode];
        }

        const canvas = document.getElementById('wheelCanvas');
        const ctx = canvas.getContext('2d');
        const spinButton = document.getElementById('spinButton');
        const resultDisplay = document.getElementById('resultDisplay');

        // é è¨­é…ç½®
        const defaultConfig = {
            title: "å‘½é‹è¼ªç›¤",
            description: "",
            segments: [
                { label: "è²·", color: '#10b981', visualPercent: 50, realPercent: 80 },
                { label: "ä¸å¥½", color: '#ef4444', visualPercent: 50, realPercent: 20 }
            ]
        };

        // å¾ URL åƒæ•¸è®€å–é…ç½®
        function loadConfigFromUrl() {
            const urlParams = new URLSearchParams(window.location.search);
            // æ”¯æ´æ–°æ ¼å¼ 'c' å’ŒèˆŠæ ¼å¼ 'config'
            const configParam = urlParams.get('c') || urlParams.get('config');

            if (configParam) {
                try {
                    // è§£ç¢¼ Base64ï¼ˆæ”¯æ´æ–°èˆŠå…©ç¨®ç·¨ç¢¼æ ¼å¼ï¼‰
                    let configJson;

                    // Base64 è½‰ UTF-8 çš„å‡½æ•¸
                    function base64ToUtf8(base64Str) {
                        // å…ˆæ¨™æº–åŒ– URL å®‰å…¨çš„ Base64 å­—ç¬¦
                        const normalized = base64Str.replace(/-/g, '+').replace(/_/g, '/');
                        // è£œé½Šå¡«å……
                        const padded = normalized + '='.repeat((4 - normalized.length % 4) % 4);

                        try {
                            // æ–¹æ³•1ï¼šä½¿ç”¨ TextDecoderï¼ˆç¾ä»£ç€è¦½å™¨ï¼‰
                            const binaryString = atob(padded);
                            const bytes = new Uint8Array(binaryString.length);
                            for (let i = 0; i < binaryString.length; i++) {
                                bytes[i] = binaryString.charCodeAt(i);
                            }
                            const decoder = new TextDecoder('utf-8');
                            return decoder.decode(bytes);
                        } catch (e) {
                            // æ–¹æ³•2ï¼šé™ç´šæ–¹æ¡ˆ
                            try {
                                return decodeURIComponent(escape(atob(padded)));
                            } catch (e2) {
                                // æœ€å¾Œå˜—è©¦ï¼šç›´æ¥è§£ç¢¼ï¼ˆä¸è™•ç† UTF-8ï¼‰
                                return atob(padded);
                            }
                        }
                    }

                    try {
                        // ä½¿ç”¨ base64ToUtf8 è§£ç¢¼ï¼ˆå…§éƒ¨æœƒè™•ç† URL å®‰å…¨æ ¼å¼å’Œå¡«å……ï¼‰
                        configJson = base64ToUtf8(configParam);
                    } catch (e) {
                        // å¦‚æœæ‰€æœ‰æ–¹æ³•éƒ½å¤±æ•—ï¼Œè¨˜éŒ„éŒ¯èª¤
                        console.error('è§£ç¢¼é…ç½®å¤±æ•—:', e);
                        throw e;
                    }

                    const sharedConfig = JSON.parse(configJson);

                    // æ”¯æ´ç·Šæ¹Šæ ¼å¼ï¼ˆç¸®å¯«å­—æ®µï¼‰å’Œå®Œæ•´æ ¼å¼
                    const config = {
                        title: sharedConfig.t || sharedConfig.title || defaultConfig.title,
                        description: sharedConfig.d || sharedConfig.description || defaultConfig.description,
                        segments: (sharedConfig.s || sharedConfig.segments || []).map(seg => ({
                            label: seg.l || seg.label,
                            color: seg.c || seg.color,
                            visualPercent: seg.v || seg.visualPercent,
                            // å„ªå…ˆä½¿ç”¨åˆ†äº«é…ç½®ä¸­çš„çœŸå¯¦æ©Ÿç‡ï¼ˆrï¼‰ï¼Œå¦å‰‡ä½¿ç”¨è¦–è¦ºæ¯”ä¾‹
                            realPercent: seg.r !== undefined ? seg.r : (seg.v || seg.visualPercent || seg.realPercent || 50)
                        }))
                    };

                    // ä¿å­˜åˆ° localStorageï¼ˆå¯é¸ï¼Œè®“ç”¨æˆ¶ä¹‹å¾Œä¹Ÿèƒ½ä½¿ç”¨ï¼‰
                    saveConfig(config);

                    return config;
                } catch (e) {
                    console.error('å¾ URL è¼‰å…¥é…ç½®å¤±æ•—ï¼Œä½¿ç”¨é è¨­å€¼', e);
                    return null;
                }
            }
            return null;
        }

        // å¾ localStorage è¼‰å…¥é…ç½®
        function loadConfig() {
            // å„ªå…ˆå¾ URL åƒæ•¸è®€å–
            const urlConfig = loadConfigFromUrl();
            if (urlConfig) {
                return urlConfig;
            }

            // å¦å‰‡å¾ localStorage è®€å–
            const saved = localStorage.getItem('wheelConfig');
            if (saved) {
                try {
                    return JSON.parse(saved);
                } catch (e) {
                    console.error('è¼‰å…¥é…ç½®å¤±æ•—ï¼Œä½¿ç”¨é è¨­å€¼', e);
                }
            }
            return defaultConfig;
        }

        // å„²å­˜é…ç½®
        function saveConfig(config) {
            localStorage.setItem('wheelConfig', JSON.stringify(config));
        }

        // è¼‰å…¥é…ç½®
        let config = loadConfig();
        let segments = [];
        const optionsDisplay = document.getElementById('optionsDisplay');


        // åˆå§‹åŒ–è½‰ç›¤æ•¸æ“š
        function initSegments() {
            segments = config.segments.map((seg, index) => {
                const degrees = (seg.visualPercent / 100) * 360;
                return {
                    label: seg.label,
                    color: seg.color,
                    degrees: degrees,
                    visualPercent: seg.visualPercent,
                    realPercent: seg.realPercent,
                    startAngleDeg: 0, // èµ·å§‹è§’åº¦ï¼ˆåº¦æ•¸ï¼‰
                    endAngleDeg: 0    // çµæŸè§’åº¦ï¼ˆåº¦æ•¸ï¼‰
                };
            });

            // è¨ˆç®—æ¯å€‹æ‰‡å€çš„èµ·å§‹å’ŒçµæŸè§’åº¦ï¼ˆåº¦æ•¸ï¼Œ0åº¦åœ¨å³å´3é»é˜æ–¹å‘ï¼‰
            let currentAngle = 0;
            segments.forEach(seg => {
                seg.startAngleDeg = currentAngle;
                seg.endAngleDeg = currentAngle + seg.degrees;
                currentAngle = seg.endAngleDeg;
            });

            updateOptionsDisplay();
            updateTitleAndDescription();
            drawWheel(); // ç¢ºä¿é…ç½®æ›´æ–°æ™‚é‡æ–°ç¹ªè£½è½‰ç›¤
        }

        // æ›´æ–°æ¨™é¡Œå’Œèªªæ˜é¡¯ç¤º
        function updateTitleAndDescription() {
            const titleElement = document.getElementById('wheelTitle');
            const descriptionElement = document.getElementById('wheelDescription');

            if (titleElement) {
                titleElement.textContent = config.title || defaultConfig.title;
            }

            if (descriptionElement) {
                if (config.description && config.description.trim()) {
                    descriptionElement.textContent = config.description;
                    descriptionElement.style.display = 'block';
                } else {
                    descriptionElement.style.display = 'none';
                }
            }
        }

        // æ›´æ–°é¸é …é¡¯ç¤ºï¼ˆè¡¨æ ¼æ ¼å¼ï¼‰
        function updateOptionsDisplay() {
            let html = '';
            config.segments.forEach(segment => {
                html += `
                    <tr>
                        <td class="border border-gray-300 px-4 py-2">
                            <span class="inline-block px-3 py-1 rounded text-white font-semibold" style="background-color: ${segment.color};">
                                ${segment.label}
                            </span>
                        </td>
                        <td class="border border-gray-300 px-4 py-2 text-center font-semibold">
                            ${segment.visualPercent.toFixed(1)}%
                        </td>
                    </tr>
                `;
            });
            const tbody = optionsDisplay.querySelector('tbody');
            if (tbody) {
                tbody.innerHTML = html;
            }
        }

        // è¼‰å…¥æ­·å²è¨˜éŒ„
        function loadHistory() {
            const saved = localStorage.getItem('wheelHistory');
            if (saved) {
                try {
                    return JSON.parse(saved);
                } catch (e) {
                    console.error('è¼‰å…¥æ­·å²è¨˜éŒ„å¤±æ•—', e);
                }
            }
            return [];
        }

        // å„²å­˜æ­·å²è¨˜éŒ„
        function saveHistory(history) {
            localStorage.setItem('wheelHistory', JSON.stringify(history));
        }

        // æ·»åŠ è¨˜éŒ„
        function addHistoryRecord(label, color) {
            const history = loadHistory();
            const now = new Date();
            const timeStr = `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}:${now.getSeconds().toString().padStart(2, '0')}`;
            const dateStr = `${now.getFullYear()}-${(now.getMonth() + 1).toString().padStart(2, '0')}-${now.getDate().toString().padStart(2, '0')}`;

            history.unshift({
                label: label,
                color: color,
                time: timeStr,
                date: dateStr,
                timestamp: now.getTime(),
                protected: false // é è¨­ä¸å—ä¿è­·
            });

            // æœ€å¤šä¿ç•™ 100 ç­†è¨˜éŒ„ï¼ˆä¸åŒ…æ‹¬å—ä¿è­·çš„ï¼‰
            if (history.length > 100) {
                // åªåˆªé™¤ä¸å—ä¿è­·çš„è¨˜éŒ„
                for (let i = history.length - 1; i >= 0; i--) {
                    if (!history[i].protected) {
                        history.splice(i, 1);
                        break;
                    }
                }
            }

            saveHistory(history);
            renderHistory();
        }

        // æ¸²æŸ“æ­·å²è¨˜éŒ„
        function renderHistory() {
            const history = loadHistory();
            const historyDisplay = document.getElementById('historyDisplay');

            if (history.length === 0) {
                historyDisplay.innerHTML = '<p class="text-gray-500 text-sm text-center py-4">å°šç„¡è¨˜éŒ„</p>';
                return;
            }

            let html = '';
            history.forEach((record, index) => {
                const protectedClass = record.protected ? 'bg-yellow-50 border-yellow-300' : '';
                const protectIcon = record.protected ? 'âœ“' : 'â—‹';
                const protectColor = record.protected ? 'text-green-600' : 'text-gray-400';

                html += `
                    <div class="p-3 border border-gray-200 rounded-lg hover:bg-gray-50 transition ${protectedClass}" data-index="${index}">
                        <div class="flex items-center justify-between mb-2">
                            <span class="inline-block px-3 py-1 rounded text-white font-semibold text-sm" style="background-color: ${record.color};">
                                ${record.label}
                            </span>
                            <span class="text-xs text-gray-500">${record.date} ${record.time}</span>
                        </div>
                        <div class="flex items-center justify-end gap-2 mt-2">
                            <button class="protect-btn px-2 py-1 text-sm rounded transition ${protectColor} hover:bg-gray-100"
                                    data-index="${index}"
                                    title="${record.protected ? 'å–æ¶ˆä¿è­·' : 'ä¿è­·æ­¤è¨˜éŒ„'}">
                                ${protectIcon}
                            </button>
                            <button class="delete-btn px-2 py-1 text-sm text-red-500 rounded hover:text-red-700 hover:bg-red-50 transition"
                                    data-index="${index}"
                                    ${record.protected ? 'disabled title="å—ä¿è­·çš„è¨˜éŒ„ç„¡æ³•åˆªé™¤"' : 'title="åˆªé™¤æ­¤è¨˜éŒ„"'}>
                                ğŸ—‘ï¸
                            </button>
                        </div>
                    </div>
                `;
            });
            historyDisplay.innerHTML = html;

            // ç¶å®šäº‹ä»¶
            historyDisplay.querySelectorAll('.delete-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const index = parseInt(e.target.dataset.index);
                    deleteHistoryRecord(index);
                });
            });

            historyDisplay.querySelectorAll('.protect-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const index = parseInt(e.target.dataset.index);
                    toggleProtectRecord(index);
                });
            });
        }

        // åˆªé™¤å–®ç­†è¨˜éŒ„
        function deleteHistoryRecord(index) {
            const history = loadHistory();
            if (index >= 0 && index < history.length) {
                if (history[index].protected) {
                    alert('æ­¤è¨˜éŒ„å·²å—ä¿è­·ï¼Œç„¡æ³•åˆªé™¤ï¼');
                    return;
                }
                if (confirm('ç¢ºå®šè¦åˆªé™¤æ­¤è¨˜éŒ„å—ï¼Ÿ')) {
                    history.splice(index, 1);
                    saveHistory(history);
                    renderHistory();
                }
            }
        }

        // åˆ‡æ›ä¿è­·ç‹€æ…‹
        function toggleProtectRecord(index) {
            const history = loadHistory();
            if (index >= 0 && index < history.length) {
                history[index].protected = !history[index].protected;
                saveHistory(history);
                renderHistory();
            }
        }

        // é‡ç½®æ­·å²è¨˜éŒ„ï¼ˆåŒ…æ‹¬å—ä¿è­·çš„è¨˜éŒ„ï¼‰
        function resetHistory() {
            if (confirm('ç¢ºå®šè¦æ¸…é™¤æ‰€æœ‰è½‰ç›¤è¨˜éŒ„å—ï¼Ÿ\nï¼ˆåŒ…æ‹¬å—ä¿è­·çš„è¨˜éŒ„ä¹Ÿæœƒè¢«æ¸…é™¤ï¼‰')) {
                localStorage.removeItem('wheelHistory');
                renderHistory();
            }
        }

        const totalDegrees = 360;
        let currentRotation = 0; // ç•¶å‰æ—‹è½‰è§’åº¦ (åº¦)
        let isSpinning = false;

        // é‡ç½®è½‰ç›¤ç‚ºåˆå§‹ç‹€æ…‹
        function resetWheel() {
            currentRotation = 0;
            canvas.style.transform = 'rotate(0deg)';
            resultDisplay.textContent = 'æŒ‰ä¸‹æŒ‰éˆ•é–‹å§‹';
            resultDisplay.className = 'min-h-[50px] w-full text-center text-2xl font-extrabold text-gray-700 p-3 rounded-lg bg-gray-100 transition-all duration-500 shadow-inner';
            isSpinning = false;
            spinButton.disabled = false;
        }

        // åˆå§‹åŒ–
        initSegments();
        drawWheel(); // ç¹ªè£½è½‰ç›¤
        resetWheel(); // ç¢ºä¿æ¯æ¬¡é–‹å•Ÿéƒ½æ˜¯æ–°çš„è¼ªç›¤

        // è¨ˆç®—é¡è‰²çš„äº®åº¦ï¼ˆç”¨æ–¼æ±ºå®šæ–‡å­—é¡è‰²ï¼‰
        function getLuminance(color) {
            const hex = color.replace('#', '');
            const r = parseInt(hex.substr(0, 2), 16) / 255;
            const g = parseInt(hex.substr(2, 2), 16) / 255;
            const b = parseInt(hex.substr(4, 2), 16) / 255;
            const luminance = 0.299 * r + 0.587 * g + 0.114 * b;
            return luminance;
        }

        // ç¹ªè£½è½‰ç›¤
        function drawWheel() {
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            const radius = Math.min(centerX, centerY) * 0.95;

            // ç¹ªè£½å¤–åœˆé™°å½±ï¼ˆæ•´é«”è½‰ç›¤é™°å½±ï¼‰
            ctx.save();
            ctx.shadowColor = 'rgba(0, 0, 0, 0.3)';
            ctx.shadowBlur = 20;
            ctx.shadowOffsetX = 0;
            ctx.shadowOffsetY = 5;
            ctx.beginPath();
            ctx.arc(centerX, centerY, radius, 0, 2 * Math.PI);
            ctx.fillStyle = 'transparent';
            ctx.fill();
            ctx.restore();

            segments.forEach((segment, index) => {
                // å°‡åº¦æ•¸è½‰æ›ç‚ºå¼§åº¦ï¼ˆCanvas arc ä½¿ç”¨å¼§åº¦ï¼‰
                // æ³¨æ„ï¼šCanvas 0åº¦åœ¨å³å´ï¼ˆ3é»é˜æ–¹å‘ï¼‰ï¼Œé †æ™‚é‡ç‚ºæ­£
                const startAngleRad = (segment.startAngleDeg * Math.PI) / 180;
                const endAngleRad = (segment.endAngleDeg * Math.PI) / 180;
                const midAngleRad = (startAngleRad + endAngleRad) / 2;

                // å‰µå»ºæ¼¸è®Šæ•ˆæœï¼ˆå¾ä¸­å¿ƒåˆ°é‚Šç·£ï¼‰
                const gradient = ctx.createRadialGradient(
                    centerX, centerY, radius * 0.3,
                    centerX, centerY, radius
                );

                // æ ¹æ“šé¡è‰²å‰µå»ºæ¼¸è®Š
                const baseColor = segment.color;
                const hex = baseColor.replace('#', '');
                const r = parseInt(hex.substr(0, 2), 16);
                const g = parseInt(hex.substr(2, 2), 16);
                const b = parseInt(hex.substr(4, 2), 16);

                // ä¸­å¿ƒè¼ƒäº®ï¼Œé‚Šç·£è¼ƒæš—
                gradient.addColorStop(0, `rgba(${Math.min(255, r + 40)}, ${Math.min(255, g + 40)}, ${Math.min(255, b + 40)}, 1)`);
                gradient.addColorStop(0.7, baseColor);
                gradient.addColorStop(1, `rgba(${Math.max(0, r - 30)}, ${Math.max(0, g - 30)}, ${Math.max(0, b - 30)}, 1)`);

                // ç¹ªè£½æ‰‡å€
                ctx.beginPath();
                ctx.moveTo(centerX, centerY);
                ctx.arc(centerX, centerY, radius, startAngleRad, endAngleRad);
                ctx.closePath();
                ctx.fillStyle = gradient;
                ctx.fill();

                // ç¹ªè£½æ‰‡å€é‚Šç•Œç·šï¼ˆç™½è‰²åˆ†éš”ç·šï¼Œæ›´æ¸…æ™°ï¼‰
                ctx.strokeStyle = 'rgba(255, 255, 255, 0.6)';
                ctx.lineWidth = 3;
                ctx.stroke();

                // ç¹ªè£½å…§åœˆé«˜å…‰æ•ˆæœï¼ˆè®“è½‰ç›¤æ›´æœ‰ç«‹é«”æ„Ÿï¼‰
                const highlightRadius = radius * 0.85;
                const highlightStartX = centerX + Math.cos(startAngleRad) * highlightRadius;
                const highlightStartY = centerY + Math.sin(startAngleRad) * highlightRadius;

                ctx.beginPath();
                ctx.moveTo(centerX, centerY);
                ctx.lineTo(highlightStartX, highlightStartY);
                ctx.strokeStyle = 'rgba(255, 255, 255, 0.3)';
                ctx.lineWidth = 2;
                ctx.stroke();

                // ç¹ªè£½æ–‡å­— (ä½æ–¼æ‰‡å€ä¸­å¿ƒ)
                const textRadius = radius * 0.70;
                const x = centerX + Math.cos(midAngleRad) * textRadius;
                const y = centerY + Math.sin(midAngleRad) * textRadius;

                // æ ¹æ“šèƒŒæ™¯é¡è‰²æ±ºå®šæ–‡å­—é¡è‰²èˆ‡æé‚Šé¡è‰²
                const luminance = getLuminance(segment.color);
                const isLightBackground = luminance > 0.5;
                const textColor = isLightBackground ? '#1a1a1a' : '#FFFFFF';
                const strokeColor = isLightBackground ? '#FFFFFF' : 'rgba(0,0,0,0.8)';

                ctx.save();
                ctx.translate(x, y);
                ctx.rotate(midAngleRad + Math.PI / 2);
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';

                // æ¸…é™¤é™°å½±è¨­å®š
                ctx.shadowColor = 'transparent';
                ctx.shadowBlur = 0;
                ctx.shadowOffsetX = 0;
                ctx.shadowOffsetY = 0;

                // ç¹ªè£½æ–‡å­—æé‚Šï¼ˆé«˜å°æ¯”æé‚Šï¼Œç¢ºä¿æ¸…æ™°åº¦ï¼‰
                ctx.strokeStyle = strokeColor;
                ctx.lineWidth = 3;
                ctx.lineJoin = 'round';
                ctx.font = 'bold 26px "Noto Sans TC", "Microsoft JhengHei", "PingFang TC", sans-serif';
                ctx.strokeText(segment.label, 0, 0);

                // ç¹ªè£½æ–‡å­—
                ctx.fillStyle = textColor;
                ctx.fillText(segment.label, 0, 0);

                ctx.restore();
            });

            // ç¹ªè£½ä¸­å¿ƒè£é£¾åœ“ï¼ˆå¤šå±¤æ¬¡è¨­è¨ˆï¼‰
            // å¤–åœˆ
            ctx.beginPath();
            ctx.arc(centerX, centerY, radius * 0.18, 0, 2 * Math.PI);
            ctx.fillStyle = '#ffffff';
            ctx.fill();
            ctx.strokeStyle = 'rgba(0, 0, 0, 0.15)';
            ctx.lineWidth = 2;
            ctx.stroke();

            // å…§åœˆï¼ˆè£é£¾ï¼‰
            ctx.beginPath();
            ctx.arc(centerX, centerY, radius * 0.12, 0, 2 * Math.PI);
            const centerGradient = ctx.createRadialGradient(centerX, centerY, 0, centerX, centerY, radius * 0.12);
            centerGradient.addColorStop(0, '#f8f9fa');
            centerGradient.addColorStop(1, '#e9ecef');
            ctx.fillStyle = centerGradient;
            ctx.fill();
            ctx.strokeStyle = 'rgba(0, 0, 0, 0.2)';
            ctx.lineWidth = 2;
            ctx.stroke();

            // ä¸­å¿ƒé»
            ctx.beginPath();
            ctx.arc(centerX, centerY, 4, 0, 2 * Math.PI);
            ctx.fillStyle = '#374151';
            ctx.fill();
        }

        // åˆå§‹åŒ–ç¹ªè£½
        drawWheel();

        /**
         * æ ¹æ“šçœŸå¯¦æ©Ÿç‡é¸æ“‡çµæœ
         */
        function selectResultByRealProbability() {
            // ä½¿ç”¨æ¨¡å¼å®šç¾©çš„æ¬Šé‡ï¼Œå¦‚æœæ²’æœ‰å‰‡ä½¿ç”¨é…ç½®ä¸­çš„çœŸå¯¦æ©Ÿç‡
            const weights = window.WHEEL_MODE
                ? window.WHEEL_MODE.real
                : config.segments.map(seg => seg.realPercent || 50); // é è¨­æˆ–å¾é…ç½®è®€å–

            const random = Math.random() * 100; // 0-100
            let cumulative = 0;

            for (let i = 0; i < config.segments.length; i++) {
                // ä½¿ç”¨æ¬Šé‡æ•¸çµ„ï¼ˆå¦‚æœå¯ç”¨ï¼‰ï¼Œå¦å‰‡ä½¿ç”¨é…ç½®çš„çœŸå¯¦æ©Ÿç‡
                const weight = weights[i] !== undefined ? weights[i] : (config.segments[i].realPercent || 0);
                cumulative += weight;
                if (random <= cumulative) {
                    return i; // è¿”å›é¸ä¸­çš„ç´¢å¼•
                }
            }
            // å¦‚æœå› ç‚ºæµ®é»æ•¸èª¤å·®æ²’é¸ä¸­ï¼Œè¿”å›æœ€å¾Œä¸€å€‹
            return config.segments.length - 1;
        }

        /**
         * è¨ˆç®—æŒ‡å®šæ‰‡å€çš„ç›®æ¨™è§’åº¦ï¼ˆæŒ‡é‡æŒ‡å‘è©²æ‰‡å€ä¸­å¿ƒï¼‰
         * Canvas è§’åº¦ç³»çµ±ï¼š0åº¦åœ¨å³å´ï¼ˆ3é»é˜ï¼‰ï¼Œé †æ™‚é‡ç‚ºæ­£
         * æŒ‡é‡åœ¨é ‚éƒ¨ï¼ˆ-90åº¦æˆ–270åº¦ï¼Œ12é»é˜æ–¹å‘ï¼‰
         * éœ€è¦è¨ˆç®—è®“è©²æ‰‡å€ä¸­å¿ƒå°æº–æŒ‡é‡çš„æ—‹è½‰è§’åº¦
         */
        function calculateTargetAngle(segmentIndex) {
            const segment = segments[segmentIndex];
            // æ‰‡å€ä¸­å¿ƒè§’åº¦ï¼ˆåº¦æ•¸ï¼Œç›¸å°æ–¼å³å´3é»é˜æ–¹å‘ï¼‰
            const centerAngleDeg = (segment.startAngleDeg + segment.endAngleDeg) / 2;

            // Canvas è§’åº¦ç³»çµ±ï¼š0åº¦åœ¨å³å´ï¼ˆ3é»é˜ï¼‰ï¼Œé †æ™‚é‡ç‚ºæ­£
            // æŒ‡é‡åœ¨é ‚éƒ¨ï¼ˆ12é»é˜æ–¹å‘ï¼‰ï¼Œå°æ‡‰ -90åº¦ï¼ˆæˆ–270åº¦ï¼‰
            // è¦è®“æ‰‡å€ä¸­å¿ƒå°æº–æŒ‡é‡ï¼Œéœ€è¦å°‡ centerAngleDeg æ—‹è½‰åˆ° -90åº¦ä½ç½®

            // è¨ˆç®—ï¼šå¦‚æœæ‰‡å€ä¸­å¿ƒåœ¨ centerAngleDegï¼ˆåº¦æ•¸ï¼Œ0åº¦åœ¨å³å´ï¼‰ï¼Œ
            // è¦è®“å®ƒå°æº–é ‚éƒ¨ï¼ˆ-90åº¦ï¼‰ï¼Œéœ€è¦æ—‹è½‰çš„è§’åº¦
            // ç›®æ¨™ï¼šcenterAngleDeg + rotation = -90åº¦
            // æ‰€ä»¥ï¼šrotation = -90 - centerAngleDeg
            // ä½† CSS rotate æ˜¯é †æ™‚é‡ï¼Œæ‰€ä»¥ï¼šrotation = 270 - centerAngleDeg
            let targetAngle = 270 - centerAngleDeg;

            // æ¨™æº–åŒ–åˆ° 0-360 ç¯„åœ
            while (targetAngle < 0) targetAngle += 360;
            while (targetAngle >= 360) targetAngle -= 360;

            return targetAngle;
        }

        /**
         * åŸ·è¡Œæ—‹è½‰å‹•ä½œï¼Œæ ¹æ“šçœŸå¯¦æ©Ÿç‡æ±ºå®šçµæœï¼Œä½†è¦–è¦ºä¸Šåœåœ¨å°æ‡‰æ‰‡å€
         */
        function spinWheel() {
            if (isSpinning) return;
            isSpinning = true;
            spinButton.disabled = true;
            resultDisplay.textContent = "è½‰ç›¤é«˜é€Ÿæ—‹è½‰ä¸­...";
            resultDisplay.className = "min-h-[50px] w-full text-center text-2xl font-extrabold text-white p-3 rounded-lg bg-gray-500 transition-all duration-500 shadow-inner";

            // 1. æ ¹æ“šçœŸå¯¦æ©Ÿç‡é¸æ“‡çµæœ
            const selectedIndex = selectResultByRealProbability();
            const selectedSegment = segments[selectedIndex];

            // 2. è¨ˆç®—ç›®æ¨™è§’åº¦ï¼ˆè®“é¸ä¸­çš„æ‰‡å€ä¸­å¿ƒå°æº–æŒ‡é‡ï¼‰
            const baseTargetAngle = calculateTargetAngle(selectedIndex);

            // å›ºå®šæ—‹è½‰åƒæ•¸
            const FIXED_ROTATIONS = 10; // å›ºå®šè½‰ 10 åœˆ
            const FIXED_DURATION = 3000; // å›ºå®š 3 ç§’

            // æ¨™æº–åŒ–ç•¶å‰è§’åº¦åˆ° 0-360 ç¯„åœ
            const normalizedCurrent = ((currentRotation % totalDegrees) + totalDegrees) % totalDegrees;

            // è¨ˆç®—éœ€è¦æ—‹è½‰çš„è§’åº¦ï¼ˆç¢ºä¿é †æ™‚é‡æ–¹å‘ï¼‰
            let rotationNeeded = baseTargetAngle - normalizedCurrent;
            if (rotationNeeded < 0) {
                rotationNeeded += totalDegrees; // ç¢ºä¿æ˜¯æ­£æ•¸ï¼ˆé †æ™‚é‡ï¼‰
            }

            // å›ºå®šæ–¹å‘ï¼šç¸½æ˜¯é †æ™‚é‡æ—‹è½‰å›ºå®šåœˆæ•¸
            const finalRotation = currentRotation + (FIXED_ROTATIONS * totalDegrees) + rotationNeeded;

            // è¨­å®šå›ºå®šçš„éæ¸¡æ™‚é–“å’Œç·©å‹•å‡½æ•¸ï¼ˆç¢ºä¿æ¯æ¬¡æ—‹è½‰é€Ÿåº¦ä¸€è‡´ï¼‰
            canvas.style.transition = `transform ${FIXED_DURATION}ms cubic-bezier(0.17, 0.67, 0.12, 0.99)`;
            canvas.style.transform = `rotate(${finalRotation}deg)`;

            setTimeout(() => {
                isSpinning = false;
                spinButton.disabled = false;
                currentRotation = finalRotation % totalDegrees; // æ›´æ–°ç•¶å‰è§’åº¦

                // é¡¯ç¤ºçµæœä¸¦è¨˜éŒ„
                showResult(selectedSegment.label, selectedSegment.color);
                addHistoryRecord(selectedSegment.label, selectedSegment.color);

            }, FIXED_DURATION);
        }

        function showResult(resultLabel, resultColor) {
            // å°‡ hex é¡è‰²è½‰æ›ç‚º RGB ç”¨æ–¼èƒŒæ™¯
            const hex = resultColor.replace('#', '');
            const r = parseInt(hex.substr(0, 2), 16);
            const g = parseInt(hex.substr(2, 2), 16);
            const b = parseInt(hex.substr(4, 2), 16);

            resultDisplay.textContent = `çµæœæ˜¯... ${resultLabel}ï¼`;
            resultDisplay.style.backgroundColor = `rgba(${r}, ${g}, ${b}, 0.9)`;
            resultDisplay.className = "min-h-[50px] w-full text-center text-2xl font-extrabold text-white p-3 rounded-lg transition-all duration-500 shadow-2xl";
        }

        // é‡æ–°è¼‰å…¥é…ç½®ä¸¦æ›´æ–°è½‰ç›¤
        function reloadConfig() {
            const newConfig = loadConfig();
            const configChanged = JSON.stringify(newConfig) !== JSON.stringify(config);

            if (configChanged) {
                console.log('ğŸ”„ æª¢æ¸¬åˆ°é…ç½®è®ŠåŒ–ï¼Œé‡æ–°è¼‰å…¥...');
                config = newConfig;
                initSegments();
                drawWheel();
                updateOptionsDisplay();
                updateTitleAndDescription();
                resetWheel(); // é…ç½®æ›´æ–°æ™‚é‡ç½®è½‰ç›¤
            }
        }

        // ç›£è½é…ç½®è®ŠåŒ–ï¼ˆç•¶å¾Œå°æ›´æ–°é…ç½®æ™‚ - è·¨æ¨™ç±¤é ï¼‰
        window.addEventListener('storage', (e) => {
            if (e.key === 'wheelConfig') {
                console.log('ğŸ“¦ æ”¶åˆ° storage äº‹ä»¶ï¼Œé…ç½®å·²æ›´æ–°');
                reloadConfig();
            }
        });

        // ç›£è½è‡ªå®šç¾©é…ç½®æ›´æ–°äº‹ä»¶ï¼ˆåŒé é¢å…§æ›´æ–°ï¼‰
        window.addEventListener('wheelConfigUpdated', (e) => {
            console.log('ğŸ”„ æ”¶åˆ°é…ç½®æ›´æ–°äº‹ä»¶');
            reloadConfig();
        });

        // å®šæœŸæª¢æŸ¥é…ç½®è®ŠåŒ–ï¼ˆåŒé é¢å…§æ›´æ–°ï¼‰
        setInterval(() => {
            reloadConfig();
        }, 300); // æ”¹ç‚º 300ms æª¢æŸ¥ä¸€æ¬¡ï¼Œæ›´åŠæ™‚

        // ç•¶é é¢é‡æ–°å¯è¦‹æ™‚ï¼ˆå¾å¾Œå°è¿”å›ï¼‰ï¼Œç«‹å³æª¢æŸ¥é…ç½®
        document.addEventListener('visibilitychange', () => {
            if (!document.hidden) {
                // é é¢è®Šç‚ºå¯è¦‹æ™‚ï¼Œç«‹å³é‡æ–°è¼‰å…¥é…ç½®
                console.log('ğŸ‘ï¸ é é¢å¯è¦‹ï¼Œæª¢æŸ¥é…ç½®æ›´æ–°...');
                reloadConfig();
            }
        });

        // ç•¶é é¢ç²å¾—ç„¦é»æ™‚ï¼ˆåˆ‡æ›æ¨™ç±¤é è¿”å›ï¼‰ï¼Œç«‹å³æª¢æŸ¥é…ç½®
        window.addEventListener('focus', () => {
            console.log('ğŸ¯ é é¢ç²å¾—ç„¦é»ï¼Œæª¢æŸ¥é…ç½®æ›´æ–°...');
            reloadConfig();
        });

        // ç›£è½ Firebase é…ç½®è¼‰å…¥
        window.addEventListener('firebaseConfigLoaded', (event) => {
            const firebaseConfig = event.detail;
            if (firebaseConfig && firebaseConfig.segments) {
                config = firebaseConfig;
                initSegments();
                resetWheel();
            }
        });

        // é›²ç«¯åˆ†äº«æŒ‰éˆ•äº‹ä»¶
        document.getElementById('cloudShareBtn').addEventListener('click', async () => {
            const btn = document.getElementById('cloudShareBtn');
            btn.disabled = true;
            btn.innerText = "å„²å­˜ä¸­...";

            try {
                if (typeof window.cloudShareWheel === 'function') {
                    const shareUrl = await window.cloudShareWheel(config);
                    document.getElementById('shareUrlInput').value = shareUrl;
                    document.getElementById('shareArea').classList.remove('hidden');
                } else {
                    alert('é›²ç«¯åŠŸèƒ½æœªå•Ÿç”¨ï¼Œè«‹æª¢æŸ¥ Firebase é…ç½®');
                }
            } catch (e) {
                console.error('åˆ†äº«å¤±æ•—:', e);
                alert('åˆ†äº«å¤±æ•—ï¼š' + e.message);
            } finally {
                btn.disabled = false;
                btn.innerText = "ç”Ÿæˆåˆ†äº«é€£çµ";
            }
        });

        // è¤‡è£½é€£çµåŠŸèƒ½
        document.getElementById('copyBtn').addEventListener('click', () => {
            const input = document.getElementById('shareUrlInput');
            input.select();
            document.execCommand('copy');
            const btn = document.getElementById('copyBtn');
            const originalText = btn.innerText;
            btn.innerText = 'å·²è¤‡è£½ï¼';
            setTimeout(() => { btn.innerText = originalText; }, 2000);
        });

        // äº‹ä»¶ç›£è½
        spinButton.addEventListener('click', spinWheel);
        document.getElementById('resetHistoryBtn').addEventListener('click', resetHistory);

        // åˆå§‹åŒ–æ­·å²è¨˜éŒ„é¡¯ç¤º
        renderHistory();

        // è®“è½‰ç›¤åœ¨è¦–çª—å¤§å°æ”¹è®Šæ™‚ä¿æŒæ­£ç¢ºçš„å°ºå¯¸
        window.addEventListener('resize', () => {
            // åœ¨é€™è£¡æˆ‘å€‘ä¾è³´ CSS W-full/H-full å’Œ aspect-ratio ä¾†è™•ç†éŸ¿æ‡‰æ€§ï¼Œ
            // åªéœ€è¦é‡æ–°ç¹ªè£½ç¢ºä¿æ–‡å­—æ¸…æ™°ã€‚
            // å¯¦éš› Canvas å°ºå¯¸åœ¨ HTML ä¸­å›ºå®šç‚º 400x400ï¼Œä½†æœƒè¢« CSS ç¸®æ”¾ã€‚
            // ç‚ºäº†ç°¡åŒ–ï¼Œæˆ‘å€‘åªåœ¨åˆå§‹åŒ–æ™‚ç¹ªè£½ä¸€æ¬¡ï¼Œå¦‚æœéœ€è¦æ›´ç²¾ç¢ºçš„éŸ¿æ‡‰å¼ç¹ªåœ–ï¼Œ
            // å‰‡éœ€è¦æ ¹æ“šå¯¦éš›æ¸²æŸ“å¤§å°èª¿æ•´ `canvas.width/height` å’Œç¹ªåœ–åƒæ•¸ã€‚
        });

    </script>
</body>
</html>
