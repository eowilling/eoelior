<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <script src="firebase-config.js"></script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>eoElior | ç©å…·ç›’å­</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Noto+Sans+TC:wght@300;400;500;700&display=swap');

        :root {
            --bg-dark: #0f172a;
            --card-bg: rgba(30, 41, 59, 0.7);
            --accent-primary: #6366f1;
            --accent-secondary: #a855f7;
        }

        body {
            font-family: 'Inter', 'Noto Sans TC', sans-serif;
            background-color: var(--bg-dark);
            color: #f8fafc;
            background-image:
                radial-gradient(circle at 20% 20%, rgba(99, 102, 241, 0.15) 0%, transparent 25%),
                radial-gradient(circle at 80% 80%, rgba(168, 85, 247, 0.15) 0%, transparent 25%);
            min-height: 100vh;
        }

        .glass-card {
            background: var(--card-bg);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .glass-card:hover {
            transform: translateY(-5px);
            border-color: rgba(99, 102, 241, 0.5);
            box-shadow: 0 10px 30px -10px rgba(0, 0, 0, 0.5);
        }

        .search-input:focus {
            box-shadow: 0 0 0 2px rgba(99, 102, 241, 0.4);
        }

        .category-tab.active {
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            color: white;
        }

        .gradient-text {
            background: linear-gradient(135deg, #818cf8, #c084fc);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        #adminPanel {
            transition: transform 0.3s ease-in-out, opacity 0.3s ease-in-out;
        }
    </style>
</head>
<body class="p-4 md:p-8">
    <div class="max-w-6xl mx-auto">
        <!-- Header Section -->
        <header class="mb-12 text-center md:text-left flex flex-col md:flex-row md:items-end justify-between gap-6">
            <div>
                <h1 class="text-4xl md:text-5xl font-bold mb-2">
                    <span class="gradient-text">eoElior</span> çš„ç©å…·ç›’å­
                </h1>
                <p class="text-slate-400 text-lg">æ‰“ç£¨ç”Ÿæ´»çš„å°ç©å…·ï¼Œè¨˜éŒ„æˆé•·çš„æ¯ä¸€å°æ­¥ã€‚</p>
            </div>
            <div class="flex items-center gap-4 justify-center md:justify-end">
                <div class="text-right">
                    <p class="text-xs text-slate-500 uppercase tracking-widest">ç´¯ç©è¨ªå®¢</p>
                    <p id="visitorCount" class="text-2xl font-bold text-indigo-400">---</p>
                </div>
                <div class="h-10 w-[1px] bg-slate-700 hidden sm:block"></div>
                <div class="text-right">
                    <p class="text-xs text-slate-500 uppercase tracking-widest flex items-center justify-end gap-1">
                        è³‡æ–™åº«ç‹€æ…‹
                        <button id="toggleAdmin" class="text-slate-600 hover:text-indigo-400 transition-colors">
                            <i class="fa-solid fa-gear text-[10px]"></i>
                        </button>
                    </p>
                    <p class="text-sm font-medium text-emerald-400 flex items-center justify-end gap-2">
                        <span id="dbStatusDot" class="relative flex h-2 w-2">
                            <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-emerald-400 opacity-75"></span>
                            <span class="relative inline-flex rounded-full h-2 w-2 bg-emerald-500"></span>
                        </span>
                        <span id="dbStatusText">é€£ç·šä¸­...</span>
                    </p>
                </div>
            </div>
        </header>

        <!-- Admin Control Panel -->
        <div id="adminPanel" class="hidden glass-card rounded-2xl p-6 mb-10 border-indigo-500/30">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-xl font-bold flex items-center gap-2 text-indigo-300">
                    <i class="fa-solid fa-shield-halved"></i> ç©å…·ç›’åƒæ•¸èª¿æ•™
                </h2>
                <button id="closeAdmin" class="text-slate-500 hover:text-white"><i class="fa-solid fa-xmark"></i></button>
            </div>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <div class="space-y-4">
                    <label class="block text-sm font-medium text-slate-400 uppercase tracking-wider">è¦†å¯«è¨ªå®¢ç¸½æ•¸</label>
                    <div class="flex gap-2">
                        <input type="number" id="overrideCountInput"
                            class="flex-1 bg-slate-800/80 border border-slate-700 rounded-xl px-4 py-2 text-white focus:outline-none focus:border-indigo-500">
                        <button id="syncCountBtn" class="bg-indigo-600 hover:bg-indigo-500 text-white px-4 py-2 rounded-xl transition-all font-medium flex items-center gap-2">
                            <i class="fa-solid fa-cloud-arrow-up text-xs"></i> åŒæ­¥
                        </button>
                    </div>
                    <p class="text-xs text-slate-500 italic">åœ¨æ­¤ä¿®æ”¹æœƒç›´æ¥è¦†è“‹é›²ç«¯ä¸Šçš„æ•¸æ“šã€‚</p>
                </div>
                <div class="bg-slate-900/50 rounded-xl p-4 border border-slate-800">
                    <p class="text-xs text-slate-500 uppercase mb-2">DB é‹ä½œæ—¥èªŒ</p>
                    <div id="adminLog" class="text-[10px] font-mono text-slate-400 h-20 overflow-y-auto space-y-1">
                        <div>> æº–å‚™å°±ç·’...</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Search & Filters -->
        <div class="mb-10 space-y-6">
            <div class="relative max-w-2xl mx-auto md:mx-0">
                <i class="fa-solid fa-magnifying-glass absolute left-4 top-1/2 -translate-y-1/2 text-slate-500"></i>
                <input type="text" id="searchInput" placeholder="æœå°‹ç©å…·åç¨±..."
                    class="w-full bg-slate-800/50 border border-slate-700 rounded-2xl py-4 pl-12 pr-4 text-white placeholder-slate-500 focus:outline-none focus:border-indigo-500 search-input transition-all">
            </div>

            <div class="flex gap-2 overflow-x-auto no-scrollbar pb-2" id="filterTabs">
                <button class="category-tab active px-6 py-2 rounded-full border border-slate-700 text-slate-300 whitespace-nowrap transition-all hover:border-slate-500" data-category="all">å…¨éƒ¨</button>
                <button class="category-tab px-6 py-2 rounded-full border border-slate-700 text-slate-300 whitespace-nowrap transition-all hover:border-slate-500" data-category="productivity">ç”Ÿç”¢åŠ›</button>
                <button class="category-tab px-6 py-2 rounded-full border border-slate-700 text-slate-300 whitespace-nowrap transition-all hover:border-slate-500" data-category="image">åœ–åƒè™•ç†</button>
                <button class="category-tab px-6 py-2 rounded-full border border-slate-700 text-slate-300 whitespace-nowrap transition-all hover:border-slate-500" data-category="pro">å°ˆæ¥­å·¥å…·</button>
                <button class="category-tab px-6 py-2 rounded-full border border-slate-700 text-slate-300 whitespace-nowrap transition-all hover:border-slate-500" data-category="entertainment">éŠæˆ²å¨›æ¨‚</button>
            </div>
        </div>

        <!-- Tools Grid -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-16" id="toolsGrid">
            <!-- (ä¿æŒå·¥å…·å¡ç‰‡ä»£ç¢¼ä¸è®Š) -->
            <div class="tool-card glass-card rounded-2xl p-6 flex flex-col group" data-category="productivity" data-name="æµç¨‹åœ–å·¥å…·">
                <div class="flex justify-between items-start mb-4">
                    <div class="w-12 h-12 rounded-xl bg-blue-500/20 flex items-center justify-center text-blue-400 text-2xl group-hover:scale-110 transition-transform"><i class="fa-solid fa-diagram-project"></i></div>
                    <span class="px-2 py-1 rounded text-[10px] font-bold uppercase tracking-wider bg-slate-700 text-slate-300">Beta</span>
                </div>
                <h3 class="text-xl font-bold mb-2">æµç¨‹åœ–å·¥å…·</h3>
                <p class="text-slate-400 text-sm mb-6 flex-grow">è¦–è¦ºåŒ–æµç¨‹åœ–ç¹ªè£½å·¥å…·ã€‚</p>
                <a href="FlowChart/FlowChat.html" target="_blank" class="mt-auto inline-flex items-center gap-2 text-indigo-400 font-medium hover:gap-3 transition-all">é–‹å•Ÿå·¥å…· <i class="fa-solid fa-arrow-right text-xs"></i></a>
            </div>
            <!-- (çœç•¥å…¶ä»–å¡ç‰‡ä»¥ç¯€çœç©ºé–“ï¼Œèˆ‡å‰ä¸€ç‰ˆæœ¬å®Œå…¨ä¸€è‡´) -->
             <div class="tool-card glass-card rounded-2xl p-6 flex flex-col group" data-category="pro" data-name="é«˜éµæ¶ç¥¨åŠ©æ‰‹">
                <div class="flex justify-between items-start mb-4">
                    <div class="w-12 h-12 rounded-xl bg-red-500/20 flex items-center justify-center text-red-400 text-2xl group-hover:scale-110 transition-transform"><i class="fa-solid fa-train-subway"></i></div>
                </div>
                <h3 class="text-xl font-bold mb-2">é«˜éµæ¶ç¥¨åŠ©æ‰‹</h3>
                <p class="text-slate-400 text-sm mb-6 flex-grow">å°ç£é«˜éµè¨‚ç¥¨è¼”åŠ©å·¥å…·ã€‚</p>
                <a href="IRS/THSR_BookingTool.html" target="_blank" class="mt-auto inline-flex items-center gap-2 text-indigo-400 font-medium hover:gap-3 transition-all">é–‹å•Ÿå·¥å…· <i class="fa-solid fa-arrow-right text-xs"></i></a>
            </div>
            <div class="tool-card glass-card rounded-2xl p-6 flex flex-col group" data-category="entertainment" data-name="æ•¸ç¨éŠæˆ²">
                <div class="flex justify-between items-start mb-4">
                    <div class="w-12 h-12 rounded-xl bg-emerald-500/20 flex items-center justify-center text-emerald-400 text-2xl group-hover:scale-110 transition-transform"><i class="fa-solid fa-puzzle-piece"></i></div>
                </div>
                <h3 class="text-xl font-bold mb-2">æ•¸ç¨éŠæˆ²</h3>
                <p class="text-slate-400 text-sm mb-6 flex-grow">å®Œæ•´çš„æ•¸ç¨æŒ‘æˆ°ç³»çµ±ã€‚</p>
                <a href="sudo/index.html" target="_blank" class="mt-auto inline-flex items-center gap-2 text-indigo-400 font-medium hover:gap-3 transition-all">é–‹å•Ÿå·¥å…· <i class="fa-solid fa-arrow-right text-xs"></i></a>
            </div>
            <div class="tool-card glass-card rounded-2xl p-6 flex flex-col group" data-category="entertainment" data-name="è²·ä¸è²·è½‰ç›¤">
                <div class="flex justify-between items-start mb-4">
                    <div class="w-12 h-12 rounded-xl bg-purple-500/20 flex items-center justify-center text-purple-400 text-2xl group-hover:scale-110 transition-transform"><i class="fa-solid fa-circle-notch"></i></div>
                </div>
                <h3 class="text-xl font-bold mb-2">è²·ä¸è²·è½‰ç›¤</h3>
                <p class="text-slate-400 text-sm mb-6 flex-grow">å¯è‡ªè¨‚é¸é …èˆ‡æ©Ÿç‡çš„å‘½é‹è½‰ç›¤ã€‚</p>
                <a href="buytonobuy/index.html" target="_blank" class="mt-auto inline-flex items-center gap-2 text-indigo-400 font-medium hover:gap-3 transition-all">é–‹å•Ÿå·¥å…· <i class="fa-solid fa-arrow-right text-xs"></i></a>
            </div>
        </div>

        <footer class="mt-24 pt-8 border-t border-slate-800 text-center">
            <p class="text-slate-500 text-sm mb-2">eoElior Â© 2026 - é¡˜ä½ çš„ç”Ÿæ´»å¦‚åŒä»£ç¢¼èˆ¬å„ªé›…</p>
        </footer>
    </div>

    <!-- Firebase SDKs -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, getDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // ==========================================
        // ğŸ› ï¸ ç©å…·ç›’è³‡æ–™åº«åƒæ•¸é…ç½®ä¸­å¿ƒ
        // ==========================================
        const TOY_BOX_CONFIG = {
            appId: typeof __app_id !== 'undefined' ? __app_id : 'elior-toy-box-v1', // é€™è£¡æ˜¯ App è­˜åˆ¥ç¢¼
            startBase: 2147483, // é€™æ˜¯åˆå§‹è¨ªå®¢æ•¸åŸºæº–
            statsPath: 'stats/visitors' // è³‡æ–™åº«è·¯å¾‘
        };

        // Firebase é…ç½® - å¦‚æœæ²’æœ‰å¤–éƒ¨å®šç¾©ï¼Œä½¿ç”¨é è¨­å€¼
        let firebaseConfig;
        try {
            if (typeof __firebase_config !== 'undefined' && __firebase_config) {
                firebaseConfig = typeof __firebase_config === 'string' ? JSON.parse(__firebase_config) : __firebase_config;
            } else {
                // é è¨­é…ç½®ï¼ˆå¦‚æœæ²’æœ‰å¤–éƒ¨å®šç¾©ï¼‰
                firebaseConfig = {
                    projectId: "studio-2298218799-c99fe",
                    appId: "1:848457307119:web:d0c416db3468efb9ef5c1a",
                    apiKey: "AIzaSyDDgQUZH5N1IaNR2-CeOIHCQjccsJEYD5s",
                    authDomain: "studio-2298218799-c99fe.firebaseapp.com",
                    messagingSenderId: "848457307119"
                };
            }
        } catch (e) {
            console.error('Firebase é…ç½®è§£æå¤±æ•—:', e);
            // ä½¿ç”¨é è¨­é…ç½®
            firebaseConfig = {
                projectId: "studio-2298218799-c99fe",
                appId: "1:848457307119:web:d0c416db3468efb9ef5c1a",
                apiKey: "AIzaSyDDgQUZH5N1IaNR2-CeOIHCQjccsJEYD5s",
                authDomain: "studio-2298218799-c99fe.firebaseapp.com",
                messagingSenderId: "848457307119"
            };
        }
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // UI ç¶å®š
        const visitorCountEl = document.getElementById('visitorCount');
        const dbStatusText = document.getElementById('dbStatusText');
        const adminPanel = document.getElementById('adminPanel');
        const adminLog = document.getElementById('adminLog');
        const overrideInput = document.getElementById('overrideCountInput');

        let currentUser = null;

        const addLog = (msg) => {
            const time = new Date().toLocaleTimeString();
            adminLog.innerHTML += `<div class="py-0.5 border-b border-slate-800/50">[${time}] ${msg}</div>`;
            adminLog.scrollTop = adminLog.scrollHeight;
        };

        // å•Ÿå‹•èº«ä»½é©—è­‰
        const initAuth = async () => {
            try {
                if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                    await signInWithCustomToken(auth, __initial_auth_token);
                } else {
                    await signInAnonymously(auth);
                }
            } catch (err) {
                dbStatusText.innerText = "é©—è­‰å¤±æ•—";
                addLog("!! é©—è­‰éŒ¯èª¤: " + err.message);
            }
        };

        onAuthStateChanged(auth, (user) => {
            if (user && !currentUser) {
                currentUser = user;
                dbStatusText.innerText = "å·²é€£ç·š";
                addLog("è³‡æ–™åº«é€£ç·šæˆåŠŸ (UID: " + user.uid.substring(0,8) + "...)");
                handleVisitorLogic();
            }
        });

        async function handleVisitorLogic() {
            if (!currentUser) return;
            const visitorDocRef = doc(db, 'artifacts', TOY_BOX_CONFIG.appId, 'public', 'data', 'stats', 'visitors');

            try {
                const snap = await getDoc(visitorDocRef);
                let count = snap.exists() ? snap.data().count : TOY_BOX_CONFIG.startBase;

                // é€²å…¥é é¢è‡ªå‹• +1
                count += 1;
                await setDoc(visitorDocRef, { count: count }, { merge: true });

                // å³æ™‚ç›£è½
                onSnapshot(visitorDocRef, (doc) => {
                    if (doc.exists()) {
                        const cloudCount = doc.data().count;
                        visitorCountEl.innerText = cloudCount.toLocaleString();
                        overrideInput.value = cloudCount;
                    }
                });
            } catch (err) {
                addLog("!! è³‡æ–™å­˜å–å—é™: " + err.message);
            }
        }

        // ç®¡ç†å“¡æŒ‰éˆ•äº‹ä»¶
        document.getElementById('toggleAdmin').onclick = () => adminPanel.classList.toggle('hidden');
        document.getElementById('closeAdmin').onclick = () => adminPanel.classList.add('hidden');

        document.getElementById('syncCountBtn').onclick = async () => {
            const btn = document.getElementById('syncCountBtn');
            const newValue = parseInt(overrideInput.value);
            if (isNaN(newValue)) return;

            btn.disabled = true;
            btn.innerHTML = '<i class="fa-solid fa-spinner animate-spin"></i>';

            try {
                const ref = doc(db, 'artifacts', TOY_BOX_CONFIG.appId, 'public', 'data', 'stats', 'visitors');
                await setDoc(ref, { count: newValue }, { merge: true });
                addLog("å·²æ‰‹å‹•èª¿æ•´é›²ç«¯è¨ªå®¢æ•¸ç‚º: " + newValue);
            } catch (err) {
                addLog("!! å¯«å…¥å¤±æ•—: " + err.message);
            } finally {
                btn.disabled = false;
                btn.innerHTML = '<i class="fa-solid fa-cloud-arrow-up text-xs"></i> åŒæ­¥';
            }
        };

        initAuth();

        // æœå°‹èˆ‡éæ¿¾é‚è¼¯
        const searchInput = document.getElementById('searchInput');
        const toolCards = document.querySelectorAll('.tool-card');
        const filterTabs = document.querySelectorAll('.category-tab');

        const filterTools = () => {
            const term = searchInput.value.toLowerCase();
            const activeCat = document.querySelector('.category-tab.active').dataset.category;
            toolCards.forEach(card => {
                const matchesSearch = card.dataset.name.toLowerCase().includes(term);
                const matchesCat = activeCat === 'all' || card.dataset.category === activeCat;
                card.style.display = (matchesSearch && matchesCat) ? 'flex' : 'none';
            });
        };

        searchInput.addEventListener('input', filterTools);
        filterTabs.forEach(tab => tab.addEventListener('click', () => {
            filterTabs.forEach(t => t.classList.remove('active'));
            tab.classList.add('active');
            filterTools();
        }));
    </script>
</body>
</html>
