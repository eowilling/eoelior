<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script>
        // æ ¹æ“šè¢å¹•è§£æåº¦è‡ªå‹•åˆ¤æ–·è¨­å‚™é¡å‹
        function isMobile() {
            return window.innerWidth <= 768;
        }

        function isTablet() {
            return window.innerWidth > 768 && window.innerWidth <= 1024;
        }

        function isLargeScreen() {
            return window.innerWidth > 1920;
        }

        // å‹•æ…‹èª¿æ•´viewportå’Œæ¨£å¼
        function adjustForScreenSize() {
            const meta = document.querySelector('meta[name="viewport"]');
            if (!meta) return;

            const width = window.innerWidth;
            const root = document.documentElement;

            // ç§»é™¤æ‰€æœ‰è¨­å‚™é¡å‹class
            root.classList.remove('is-mobile', 'is-tablet', 'is-desktop', 'is-large');

            if (width <= 768) {
                // æ‰‹æ©Ÿ
                meta.setAttribute('content', 'width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes');
                root.classList.add('is-mobile');
                root.style.fontSize = '14px';
            } else if (width <= 1024) {
                // å¹³æ¿
                meta.setAttribute('content', 'width=device-width, initial-scale=1.0');
                root.classList.add('is-tablet');
                root.style.fontSize = '15px';
            } else if (width <= 1920) {
                // æ¨™æº–æ¡Œé¢
                root.classList.add('is-desktop');
                root.style.fontSize = '16px';
            } else {
                // å¤§è¢å¹•
                root.classList.add('is-large');
                root.style.fontSize = '18px';
            }
        }

        // åˆå§‹åŒ–èª¿æ•´
        (function () {
            try {
                adjustForScreenSize();
                
                // ç›£è½è¢å¹•å¤§å°è®ŠåŒ–
                window.addEventListener('resize', function() {
                    clearTimeout(window.resizeTimer);
                    window.resizeTimer = setTimeout(adjustForScreenSize, 250);
                });
                
                // ç›£è½æ—‹è½‰
                window.addEventListener('orientationchange', function() {
                    setTimeout(adjustForScreenSize, 100);
                });
            } catch (_) {
                // ignore errors
            }
        })();
    </script>
    <title>å½¢å¼æ›†</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ğŸ“…</text></svg>">
    <!-- Firebase é…ç½®ï¼ˆå¿…é ˆåœ¨ Firebase SDK ä¹‹å‰è¼‰å…¥ï¼‰ -->
    <script src="firebase-config.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/lunar-javascript@1.6.12/lunar.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #00f2ff;
            --secondary: #7000ff;
            --accent: #ff0055;
            --bg: #050510;
            --card-bg: rgba(20, 20, 35, 0.6);
            --gold: #ffd700;
            --warning: #ff9900;
            --glass: rgba(255, 255, 255, 0.05);
            --neon-glow: 0 0 10px var(--primary), 0 0 20px var(--primary);
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background: radial-gradient(circle at center, #1a1a2e 0%, #000 100%);
            background-attachment: fixed;
            color: #fff;
        }
        
        /* ç§‘æŠ€é¢¨æ ¼ç¶²æ ¼èƒŒæ™¯ */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background:
                linear-gradient(rgba(0, 242, 255, 0.03) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 242, 255, 0.03) 1px, transparent 1px);
            background-size: 50px 50px;
            pointer-events: none;
            z-index: -1;
        }
        
        /* ç§‘æŠ€é¢¨æ—¥æ›†æ ¼å­ - éŸ¿æ‡‰å¼èª¿æ•´ï¼ˆå¢å¤§æ ¼å­ä»¥åˆ©ç”¨æ›´å¤šç©ºé–“ï¼‰ */
        .calendar-day {
            min-height: 95px;
            transition: all 0.3s ease;
            background: var(--card-bg);
            border: 1px solid rgba(0, 242, 255, 0.2);
            backdrop-filter: blur(10px);
        }
        
        /* æ‰‹æ©Ÿ - è¼ƒå°çš„æ ¼å­ */
        @media (max-width: 640px) {
            .calendar-day {
                min-height: 75px;
            }
        }
        
        /* å¹³æ¿ - ä¸­ç­‰æ ¼å­ */
        @media (min-width: 641px) and (max-width: 1024px) {
            .calendar-day {
                min-height: 90px;
            }
        }
        
        /* æ¨™æº–æ¡Œé¢ - é©ä¸­æ ¼å­ */
        @media (min-width: 1025px) and (max-width: 1920px) {
            .calendar-day {
                min-height: 98px;
            }
        }
        
        /* å¤§è¢å¹• - è¼ƒå¤§çš„æ ¼å­ */
        @media (min-width: 1921px) {
            .calendar-day {
                min-height: 120px;
            }
        }
        
        .calendar-day:hover {
            background: rgba(0, 242, 255, 0.1);
            transform: translateY(-2px);
            box-shadow: 0 0 15px rgba(0, 242, 255, 0.3);
            border-color: var(--primary);
        }
        
        /* é€±å…­ - é’è‰²å…‰æšˆ */
        .calendar-day.saturday {
            background: rgba(0, 242, 255, 0.05);
            border-color: rgba(0, 242, 255, 0.3);
        }
        .calendar-day.saturday:hover {
            background: rgba(0, 242, 255, 0.15);
            box-shadow: 0 0 20px rgba(0, 242, 255, 0.5);
        }
        
        /* é€±æ—¥ - ç´…è‰²å…‰æšˆ */
        .calendar-day.sunday {
            background: rgba(255, 0, 85, 0.05);
            border-color: rgba(255, 0, 85, 0.3);
        }
        .calendar-day.sunday:hover {
            background: rgba(255, 0, 85, 0.15);
            box-shadow: 0 0 20px rgba(255, 0, 85, 0.5);
        }
        
        /* åœ‹å®šå‡æ—¥ - ç´«è‰²å…‰æšˆ */
        .calendar-day.holiday {
            background: rgba(112, 0, 255, 0.1);
            border-color: var(--secondary) !important;
        }
        .calendar-day.holiday:hover {
            background: rgba(112, 0, 255, 0.2);
            box-shadow: 0 0 20px rgba(112, 0, 255, 0.6);
        }
        
        /* å·²è§£é–æ—¥æœŸ - é‡‘è‰²å…‰æšˆ */
        .calendar-day.unlocked {
            background: rgba(255, 215, 0, 0.1);
            border-color: var(--gold) !important;
        }
        .calendar-day.unlocked:hover {
            background: rgba(255, 215, 0, 0.2);
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.6);
        }
        
        /* ä»Šå¤© - é’è‰²éœ“è™¹ */
        .calendar-day.today {
            border-color: var(--primary) !important;
            background: rgba(0, 242, 255, 0.15);
            box-shadow: var(--neon-glow);
        }
        
        .calendar-day.has-todos {
            background: rgba(255, 153, 0, 0.1);
            border-color: var(--warning);
        }
        
        /* é–é ­åœ–ç¤ºå‹•ç•« */
        .lock-icon {
            animation: lockPulse 2s ease-in-out infinite;
        }
        @keyframes lockPulse {
            0%, 100% { opacity: 0.6; }
            50% { opacity: 1; }
        }
        
        /* è§£é–å‹•ç•« */
        .unlock-animation {
            animation: unlockScale 0.5s ease-out;
        }
        @keyframes unlockScale {
            0% { transform: scale(0.8); opacity: 0; }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); opacity: 1; }
        }
        
        /* é‡‘å¥å°å¡æ¨£å¼ */
        .quote-card {
            background: linear-gradient(135deg, #fef3e2 0%, #e8f5f0 100%);
            border: 3px solid #fb923c;
            box-shadow: 0 10px 30px rgba(251, 146, 60, 0.2);
            animation: cardAppear 0.5s ease-out;
        }
        @keyframes cardAppear {
            0% { transform: scale(0.9) translateY(20px); opacity: 0; }
            100% { transform: scale(1) translateY(0); opacity: 1; }
        }
        
        /* å°ç£ç¯€æ…¶æ¨™è¨˜ */
        .holiday-badge {
            background: linear-gradient(135deg, #7000ff 0%, #a000ff 100%);
            animation: badgeBounce 1s ease-in-out infinite;
            box-shadow: 0 0 10px rgba(112, 0, 255, 0.5);
        }
        @keyframes badgeBounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-3px); }
        }
        
        .todo-item {
            transition: all 0.2s;
        }
        .todo-item:hover {
            background-color: #f9fafb;
        }
        .todo-item.completed {
            background: linear-gradient(135deg, #d1fae5 0%, #a7f3d0 100%);
            border-color: #10b981;
        }
        .todo-item.completed:hover {
            background: linear-gradient(135deg, #a7f3d0 0%, #6ee7b7 100%);
        }
        .todo-item.failed {
            background: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%);
            border-color: #9ca3af;
            opacity: 0.7;
        }
        .todo-item.failed:hover {
            background: linear-gradient(135deg, #e5e7eb 0%, #d1d5db 100%);
        }

        /* æ‰‹æ©Ÿè§£æåº¦æ¨¡å¼ */
        @media (max-width: 768px) {
            html.is-mobile body {
                overflow-x: hidden;
            }
            
            /* æ¸›å°‘å…§è· */
            #evedayAppRoot {
                padding: 0.75rem !important;
            }
            
            /* æœˆæ›†æ¨™é¡Œèª¿æ•´ */
            #currentMonthYear {
                font-size: 1.5rem !important;
            }
        }
        
        /* å¹³æ¿è§£æåº¦æ¨¡å¼ */
        @media (min-width: 769px) and (max-width: 1024px) {
            html.is-tablet #evedayAppRoot {
                padding: 1.5rem !important;
            }
        }
        
        /* å¤§è¢å¹•æ¨¡å¼ */
        @media (min-width: 1921px) {
            html.is-large #evedayAppRoot {
                max-width: 2000px;
                margin: 0 auto;
            }
            
            html.is-large .calendar-day {
                font-size: 1.1rem;
            }
        };
    </style>
</head>
<body class="bg-gray-50">
    <div id="evedayAppRoot" class="min-h-screen p-2 sm:p-3 md:p-4 lg:p-4 xl:p-5">
        <div class="w-full mx-auto">
        <!-- Header -->
            <header class="mb-2 sm:mb-3 lg:mb-4">
                <div class="text-center">
                    <!-- é–‹ç™¼è€…æ¨¡å¼æŒ‡ç¤ºå™¨å·²ç§»å‹•åˆ°å¾…è¾¦äº‹é …çª—å£ -->
                </div>
        </header>

            <!-- ç‰ˆé¢ï¼šæ‰‹æ©Ÿä¸€é å¼ï¼ˆå‚ç›´ï¼‰ï¼Œæ¡Œé¢å·¦å³å¼ï¼ŒéŸ¿æ‡‰å¼é–“è· -->
            <div class="flex flex-col lg:flex-row gap-3 lg:gap-4 xl:gap-5">
                <!-- å·¦å´/ä¸Šæ–¹ï¼šæœˆæ›† -->
                <div class="w-full lg:flex-[2] lg:min-w-0">
                    <div class="rounded-xl shadow-lg p-2 sm:p-2.5 md:p-3 lg:p-3" style="background: var(--card-bg); border: 1px solid rgba(0, 242, 255, 0.3);">
                        <!-- æœˆæ›†æ§åˆ¶ -->
                        <div class="text-center mb-1.5">
                            <div class="flex justify-between items-center mb-0.5">
                                <button onclick="changeMonth(-1)" class="p-1.5 sm:p-2 rounded-lg transition" style="background: rgba(0, 242, 255, 0.1); color: var(--primary);" title="ä¸Šå€‹æœˆ">
                                    <svg class="w-5 h-5 sm:w-6 sm:h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                                    </svg>
                                </button>
                                <h2 class="text-2xl sm:text-3xl md:text-4xl lg:text-3xl xl:text-4xl font-bold cursor-pointer select-none" style="color: var(--primary);" id="currentMonthYear" title="é›™æ“Šåˆ‡æ›å…¨è¢å¹•æ¨¡å¼"></h2>
                                <button onclick="changeMonth(1)" class="p-1.5 sm:p-2 rounded-lg transition" style="background: rgba(0, 242, 255, 0.1); color: var(--primary);" title="ä¸‹å€‹æœˆ">
                                    <svg class="w-5 h-5 sm:w-6 sm:h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                                    </svg>
                                </button>
                            </div>
                            <div class="text-xs sm:text-sm cursor-pointer select-none" style="color: var(--primary); opacity: 0.7;" id="calendarTitle" ondblclick="toggleDeveloperMode()" title="é›™æ“Šé€²å…¥é–‹ç™¼è€…æ¨¡å¼">å½¢å¼æ›†</div>
                        </div>

                        <!-- æ˜ŸæœŸæ¨™é¡Œ -->
                        <div class="grid grid-cols-7 gap-0.5 sm:gap-0.5 md:gap-1 mb-1.5 text-xs sm:text-sm md:text-base">
                            <div class="text-center font-semibold py-1 sm:py-1.5 md:py-2" style="color: var(--primary);">æ—¥</div>
                            <div class="text-center font-semibold py-1 sm:py-1.5 md:py-2" style="color: var(--primary);">ä¸€</div>
                            <div class="text-center font-semibold py-1 sm:py-1.5 md:py-2" style="color: var(--primary);">äºŒ</div>
                            <div class="text-center font-semibold py-1 sm:py-1.5 md:py-2" style="color: var(--primary);">ä¸‰</div>
                            <div class="text-center font-semibold py-1 sm:py-1.5 md:py-2" style="color: var(--primary);">å››</div>
                            <div class="text-center font-semibold py-1 sm:py-1.5 md:py-2" style="color: var(--primary);">äº”</div>
                            <div class="text-center font-semibold py-1 sm:py-1.5 md:py-2" style="color: var(--primary);">å…­</div>
                    </div>

                        <!-- æœˆæ›†ç¶²æ ¼ -->
                        <div id="calendarGrid" class="grid grid-cols-7 gap-0.5 sm:gap-0.5 md:gap-1 xl:gap-1.5">
                            <!-- æœˆæ›†å…§å®¹å°‡ç”± JavaScript ç”Ÿæˆ -->
                        </div>
                    </div>
                </div>

                <!-- å³å´/ä¸‹æ–¹ï¼šé¸ä¸­æ—¥æœŸçš„å¾…è¾¦äº‹é … -->
                <div class="w-full lg:flex-[1] lg:min-w-0 space-y-4 lg:space-y-6">
                    <!-- é¸ä¸­æ—¥æœŸçš„å¾…è¾¦äº‹é …å€å¡Šï¼ˆæ•´åˆèªéŒ„é¡¯ç¤ºï¼‰ -->
                    <div class="rounded-xl shadow-lg p-2 sm:p-3 md:p-4 lg:p-6" style="background: var(--card-bg); border: 1px solid rgba(0, 242, 255, 0.3);">
                        <div class="mb-3 sm:mb-4">
                            <div class="flex justify-between items-start mb-2">
                                <div class="flex-1">
                                    <h3 class="text-lg sm:text-xl font-bold" style="color: var(--primary);" id="selectedDateTitle">
                                    é¸æ“‡æ—¥æœŸ
                                    </h3>
                                </div>
                                <!-- ä½¿ç”¨è€…å’Œè¨­å®š -->
                                <div class="flex items-center gap-1 sm:gap-2">
                                    <span id="devModeIndicator" class="hidden text-red-500 font-bold text-xs cursor-pointer px-2 py-1 rounded" style="background: rgba(255, 0, 0, 0.1); border: 1px solid rgba(255, 0, 0, 0.3);" onclick="toggleDeveloperMode()" title="é»æ“Šé—œé–‰é–‹ç™¼è€…æ¨¡å¼">DEV</span>
                                    <div class="flex items-center gap-1 px-1.5 sm:px-2 py-1 rounded text-xs sm:text-sm" style="background: rgba(0, 242, 255, 0.1); border: 1px solid rgba(0, 242, 255, 0.2);">
                                        <span id="firebaseStatusDot" class="w-1.5 h-1.5 rounded-full" style="background: #ef4444;" title="Firebase æœªé€£æ¥"></span>
                                        <span class="text-xs" style="color: var(--primary);" id="currentUserDisplayName">Loading...</span>
                                    </div>
                                    <button onclick="openSettingsModal()" 
                                            class="p-1.5 rounded transition"
                                            style="background: rgba(0, 242, 255, 0.1); border: 1px solid rgba(0, 242, 255, 0.3); color: var(--primary);"
                                            title="è¨­å®š">
                                        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"></path>
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                        </svg>
                                    </button>
                                </div>
                            </div>
            </div>

                        <!-- æ¯æ—¥èªéŒ„é¡¯ç¤ºå€åŸŸï¼ˆæ•´åˆåœ¨æ­¤ï¼‰ -->
                        <div id="dailyQuoteCard" class="mb-4">
                            <!-- æ¯æ—¥èªéŒ„å…§å®¹å°‡ç”± JavaScript ç”Ÿæˆ -->
                        </div>

                        <!-- å¾…è¾¦äº‹é …åˆ—è¡¨ -->
                        <div id="todoList" class="space-y-2 mb-4 min-h-[200px]">
                            <p class="text-gray-400 text-sm text-center py-8">è«‹é¸æ“‡æ—¥æœŸæŸ¥çœ‹å¾…è¾¦äº‹é …</p>
                </div>

                        <!-- æ–°å¢å¾…è¾¦äº‹é …æŒ‰éˆ•ï¼ˆé è¨­é¡¯ç¤ºï¼‰ -->
                        <div id="addTodoButton" class="hidden">
                            <button onclick="toggleAddTodoForm()" 
                                    class="w-full py-3 rounded-lg transition font-semibold flex items-center justify-center gap-2"
                                    style="background: rgba(0, 242, 255, 0.1); border: 2px dashed rgba(0, 242, 255, 0.3); color: var(--primary); hover:background: rgba(0, 242, 255, 0.2);">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                                </svg>
                                <span>æ–°å¢å¾…è¾¦äº‹é …</span>
                            </button>
                        </div>

                        <!-- æ–°å¢å¾…è¾¦äº‹é …è¡¨å–®ï¼ˆé»æ“Šå¾Œé¡¯ç¤ºï¼‰ -->
                        <div id="addTodoForm" class="hidden">
                            <div class="border-t pt-4 mt-4" style="border-color: rgba(0, 242, 255, 0.2);">
                                <div class="flex items-center justify-between mb-3">
                                    <h4 class="font-semibold" style="color: var(--primary);">æ–°å¢å¾…è¾¦äº‹é …</h4>
                                    <button onclick="toggleAddTodoForm()" class="text-gray-400 hover:text-gray-200">
                                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                                        </svg>
                                    </button>
                                </div>
                                <input type="text"
                                       id="newTodoInput"
                                       placeholder="è¼¸å…¥å¾…è¾¦äº‹é …..."
                                       class="w-full px-4 py-2 rounded-lg focus:ring-2 focus:border-blue-500 mb-2"
                                       style="background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(0, 242, 255, 0.3); color: #ffffff; focus:ring-color: var(--primary);">
                                <div class="mb-2">
                                    <label class="block text-xs mb-1" style="color: rgba(0, 242, 255, 0.7);">æé†’æ™‚é–“ï¼ˆé¸å¡«ï¼‰</label>
                                    <input type="time"
                                           id="todoTimeInput"
                                           class="w-full px-4 py-2 rounded-lg focus:ring-2 focus:border-blue-500"
                                           style="background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(0, 242, 255, 0.3); color: #ffffff; color-scheme: dark;">
                                </div>
                                <button onclick="addTodo()"
                                        class="w-full py-2 rounded-lg transition font-semibold"
                                        style="background: linear-gradient(135deg, #00f2ff 0%, #0080ff 100%); color: #0a0e27; hover:opacity: 0.9;">
                                    â• æ–°å¢
                                </button>
                    </div>
                </div>
            </div>

                    <!-- æ‰€æœ‰å¾…è¾¦äº‹é …æ—¥æœŸåˆ—è¡¨å€å¡Šï¼ˆç¨ç«‹å€å¡Šï¼Œåªåœ¨æ¡Œé¢æ¨¡å¼é¡¯ç¤ºï¼‰ -->
                    <div class="rounded-xl shadow-lg p-3 sm:p-6 hidden lg:block" style="background: var(--card-bg); border: 1px solid rgba(0, 242, 255, 0.3);">
                        <h4 class="font-semibold mb-4 flex items-center justify-between text-lg cursor-pointer select-none" 
                            style="color: var(--primary);"
                            ondblclick="toggleAllTodosExpanded()"
                            title="é›™æ“Šå±•é–‹/æ”¶åˆ">
                            <span class="flex items-center">
                                <span class="mr-2">ğŸ“‹</span> æ‰€æœ‰å¾…è¾¦äº‹é …
                            </span>
                            <svg id="allTodosToggleIcon" class="w-5 h-5 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                            </svg>
                        </h4>
                        <div id="allTodosContent" class="space-y-2 max-h-[400px] overflow-y-auto hidden">
                            <!-- å¾…è¾¦äº‹é …æ—¥æœŸåˆ—è¡¨å°‡ç”± JavaScript ç”Ÿæˆ -->
                    </div>
                    </div>
                    </div>
                </div>
            </div>

    <!-- API Key è¨­ç½® Modal -->
    <div id="apiKeyModal" class="fixed inset-0 bg-gray-900 bg-opacity-90 flex items-center justify-center p-4 z-50 hidden">
        <div class="rounded-xl shadow-2xl w-full max-w-md p-6" style="background: var(--card-bg); border: 2px solid var(--primary); box-shadow: 0 0 30px rgba(0, 242, 255, 0.3);">
            <h3 class="text-2xl font-bold mb-4" style="color: var(--primary); text-shadow: 0 0 10px var(--primary);">ğŸ”‘ è¨­ç½® Gemini API Key</h3>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium mb-2" style="color: var(--primary);">Gemini API Key</label>
                    <input type="password" id="geminiApiKeyInput" placeholder="è¼¸å…¥æ‚¨çš„ Gemini API Key..."
                           class="w-full px-4 py-2 rounded-lg"
                           style="background: rgba(0, 242, 255, 0.1); border: 1px solid var(--primary); color: var(--primary);">
                    <p class="text-xs text-gray-400 mt-2">ç”¨æ–¼ç”ŸæˆèªéŒ„å¡ç‰‡åœ–ç‰‡ï¼ˆå¯é¸ï¼‰</p>
                </div>
                <div class="flex gap-3">
                    <button onclick="saveApiKey()"
                            class="flex-1 py-2 rounded-lg font-semibold transition"
                            style="background: var(--primary); color: #000;">
                        ä¿å­˜
                    </button>
                    <button onclick="closeApiKeyModal()"
                            class="flex-1 py-2 rounded-lg font-semibold transition"
                            style="background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.3); color: #fff;">
                        å–æ¶ˆ
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- è§£é–æ—¥æœŸ Modal -->
    <div id="unlockDateModal" class="fixed inset-0 bg-gray-900 bg-opacity-90 flex items-center justify-center p-4 z-50 hidden">
        <div class="rounded-xl shadow-2xl w-full max-w-md p-6" style="background: var(--card-bg); border: 2px solid var(--gold); box-shadow: 0 0 30px rgba(255, 215, 0, 0.3);">
            <h3 class="text-2xl font-bold mb-4" style="color: var(--gold); text-shadow: 0 0 10px var(--gold);">ğŸ”“ è§£é–æ—¥æœŸ</h3>
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium mb-2" style="color: var(--gold);">è«‹è¼¸å…¥æ—¥æœŸï¼ˆæ ¼å¼ï¼šMMDDï¼‰</label>
                    <input type="text" id="unlockDateInput" placeholder="è¼¸å…¥æ—¥æœŸ"
                           maxlength="4"
                           class="w-full px-4 py-2 rounded-lg text-center text-2xl font-bold tracking-widest"
                           style="background: rgba(255, 215, 0, 0.1); border: 1px solid var(--gold); color: var(--gold);">
                </div>
                <div class="flex gap-3">
                    <button onclick="confirmUnlockDate()"
                            class="flex-1 py-2 rounded-lg font-semibold transition"
                            style="background: var(--gold); color: #000;">
                        è§£é–
                    </button>
                    <button onclick="closeUnlockModal()"
                            class="flex-1 py-2 rounded-lg font-semibold transition"
                            style="background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.3); color: #fff;">
                        å–æ¶ˆ
                    </button>
                </div>
                <p id="unlockErrorMsg" class="text-red-500 text-sm text-center hidden"></p>
            </div>
        </div>
    </div>

    <!-- æ–°å¢ä½¿ç”¨è€… Modal -->
    <div id="addUserModal" class="fixed inset-0 bg-gray-900 bg-opacity-90 flex items-center justify-center p-4 z-50 hidden">
        <div class="rounded-xl shadow-2xl w-full max-w-md p-6" style="background: var(--card-bg); border: 2px solid var(--primary); box-shadow: 0 0 30px rgba(0, 242, 255, 0.3);">
            <h3 class="text-2xl font-bold mb-4" style="color: var(--primary); text-shadow: 0 0 10px var(--primary);">æ–°å¢ä½¿ç”¨è€…</h3>
                <div class="space-y-4">
                        <div>
                    <label class="block text-sm font-medium mb-2" style="color: var(--primary);">ä½¿ç”¨è€…åç¨±</label>
                    <input type="text" id="newUserNameInput" placeholder="è¼¸å…¥ä½¿ç”¨è€…åç¨±"
                           class="w-full px-4 py-2 rounded-lg"
                           style="background: rgba(0, 242, 255, 0.1); border: 1px solid var(--primary); color: var(--primary);">
                        </div>
                <div class="flex gap-3">
                    <button onclick="addNewUser()"
                            class="flex-1 py-2 rounded-lg font-semibold transition"
                            style="background: var(--primary); color: #000;">
                        æ–°å¢
                    </button>
                    <button onclick="closeAddUserModal()"
                            class="flex-1 py-2 rounded-lg font-semibold transition"
                            style="background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255, 255, 255, 0.3); color: #fff;">
                        å–æ¶ˆ
                    </button>
                        </div>
                    </div>
                </div>
    </div>

    <!-- è¨­å®š Modal -->
    <div id="settingsModal" class="fixed inset-0 bg-gray-900 bg-opacity-90 flex items-center justify-center p-2 sm:p-4 z-50 hidden overflow-y-auto">
        <div class="rounded-xl shadow-2xl w-full max-w-[95vw] sm:max-w-md md:max-w-lg p-4 sm:p-6 my-4" style="background: var(--card-bg); border: 1px solid rgba(0, 242, 255, 0.5); max-height: 95vh; overflow-y-auto;">
            <div class="flex justify-between items-center mb-4 sm:mb-6">
                <h3 class="text-xl sm:text-2xl font-bold" style="color: var(--primary);">âš™ï¸ è¨­å®š</h3>
                <div class="flex items-center gap-2">
                    <!-- åŒ¯å‡ºè³‡æ–™ -->
                    <button onclick="exportUserData(); closeSettingsModal();" 
                            class="p-2 rounded-lg hover:bg-opacity-20 transition" 
                            style="color: var(--secondary); background: rgba(112, 0, 255, 0.1); border: 1px solid rgba(112, 0, 255, 0.5);"
                            title="åŒ¯å‡ºè³‡æ–™">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/>
                        </svg>
                    </button>
                    <!-- èªéŒ„è¨­å®š -->
                    <button id="quotesManagerButtonTop" onclick="window.location.href='quotes-uploader.html'" 
                            class="p-2 rounded-lg hover:bg-opacity-20 transition hidden" 
                            style="color: #ffa500; background: rgba(255, 165, 0, 0.1); border: 1px solid rgba(255, 165, 0, 0.5);"
                            title="èªéŒ„è¨­å®š">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"/>
                        </svg>
                    </button>
                    <!-- é‡ç½®æ•¸æ“š -->
                    <button id="settingsResetButtonTop" onclick="closeSettingsModal(); setTimeout(openResetModal, 300);" 
                            class="p-2 rounded-lg hover:bg-opacity-20 transition hidden" 
                            style="color: var(--accent); background: rgba(255, 0, 85, 0.1); border: 1px solid rgba(255, 0, 85, 0.5);"
                            title="é‡ç½®æ‰€æœ‰æ•¸æ“š">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                        </svg>
                    </button>
                    <!-- é—œé–‰æŒ‰éˆ• -->
                    <button onclick="closeSettingsModal()" class="p-2 rounded-lg hover:bg-opacity-20 transition" style="color: var(--primary); background: rgba(0, 242, 255, 0.1);">
                        <svg class="w-5 h-5 sm:w-6 sm:h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                        </svg>
                    </button>
                </div>
            </div>
            <div class="space-y-3 sm:space-y-4">
                <!-- ä½¿ç”¨è€…åç¨±è¨­å®š -->
                <div class="p-3 sm:p-4 rounded-lg" style="background: rgba(0, 242, 255, 0.05); border: 1px solid rgba(0, 242, 255, 0.2);">
                    <label class="block text-xs sm:text-sm font-semibold mb-2" style="color: var(--primary);">ä½¿ç”¨è€…åç¨±</label>
                    <div class="flex flex-col sm:flex-row gap-2">
                        <input type="text" id="settingsUserNameInput" 
                               class="flex-1 px-3 py-2 rounded-lg text-sm"
                               style="background: rgba(0, 0, 0, 0.3); border: 1px solid var(--primary); color: var(--primary);"
                               placeholder="è¼¸å…¥ä½¿ç”¨è€…åç¨±">
                        <button onclick="saveUserNameFromSettings()"
                                class="px-4 py-2 rounded-lg font-semibold transition text-sm whitespace-nowrap"
                                style="background: var(--primary); color: #000;">
                            ğŸ’¾ ä¿å­˜
                        </button>
                    </div>
                </div>

                <!-- æœˆæ›†åç¨±è¨­å®š -->
                <div class="p-3 sm:p-4 rounded-lg" style="background: rgba(0, 242, 255, 0.05); border: 1px solid rgba(0, 242, 255, 0.2);">
                    <label class="block text-xs sm:text-sm font-semibold mb-2" style="color: var(--primary);">æœˆæ›†åç¨±</label>
                    <div class="flex flex-col sm:flex-row gap-2">
                        <input type="text" id="calendarTitleInput" 
                               class="flex-1 px-3 py-2 rounded-lg text-sm"
                               style="background: rgba(0, 0, 0, 0.3); border: 1px solid var(--primary); color: var(--primary);"
                               placeholder="è¼¸å…¥æœˆæ›†åç¨±">
                        <button onclick="saveCalendarTitle()"
                                class="px-4 py-2 rounded-lg font-semibold transition text-sm whitespace-nowrap"
                                style="background: var(--primary); color: #000;">
                            ğŸ’¾ ä¿å­˜
                        </button>
                    </div>
                </div>

                <!-- é¡¯ç¤ºæ¨¡å¼è¨­å®š -->
                <div class="p-3 sm:p-4 rounded-lg" style="background: rgba(0, 242, 255, 0.05); border: 1px solid rgba(0, 242, 255, 0.2);">
                    <label class="block text-xs sm:text-sm font-semibold mb-2" style="color: var(--primary);">é¡¯ç¤ºæ¨¡å¼</label>
                    <div class="flex items-center justify-between">
                        <span class="text-xs sm:text-sm" style="color: var(--primary);">æœˆæ›†å…¨è¢å¹•æ¨¡å¼</span>
                        <label class="relative inline-flex items-center cursor-pointer">
                            <input type="checkbox" id="fullscreenModeToggle" onchange="toggleFullscreenMode(this.checked)" class="sr-only peer">
                            <div class="w-11 h-6 rounded-full peer peer-focus:ring-2 peer-focus:ring-cyan-300 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all" style="background: rgba(0, 242, 255, 0.3);"></div>
                        </label>
                    </div>
                </div>

                <!-- ä¸»é¡Œè¨­å®š -->
                <div class="p-3 sm:p-4 rounded-lg" style="background: rgba(0, 242, 255, 0.05); border: 1px solid rgba(0, 242, 255, 0.2);">
                    <label class="block text-xs sm:text-sm font-semibold mb-2" style="color: var(--primary);">ä¸»é¡Œ</label>
                    <select id="themeSelector" onchange="changeTheme(this.value)"
                            class="w-full px-3 py-2 rounded-lg text-sm"
                            style="background: rgba(0, 0, 0, 0.3); border: 1px solid var(--primary); color: var(--primary);">
                        <option value="cyberpunk">ğŸŒƒ è³½åšé¾å…‹ (é è¨­)</option>
                        <option value="ocean">ğŸŒŠ æµ·æ´‹è—</option>
                        <option value="forest">ğŸŒ² æ£®æ—ç¶ </option>
                        <option value="sunset">ğŸŒ… æ—¥è½æ©™</option>
                        <option value="purple">ğŸ’œ å¤¢å¹»ç´«</option>
                        <option value="dark">ğŸŒ‘ ç´”é»‘</option>
                    </select>
                </div>

                <!-- é€šçŸ¥è¨­å®š -->
                <div class="p-3 sm:p-4 rounded-lg" style="background: rgba(0, 242, 255, 0.05); border: 1px solid rgba(0, 242, 255, 0.2);">
                    <label class="block text-xs sm:text-sm font-semibold mb-2" style="color: var(--primary);">é€šçŸ¥è¨­å®š</label>
                    <div class="flex items-center justify-between mb-2">
                        <span class="text-xs sm:text-sm" style="color: var(--primary);">å•Ÿç”¨é€šçŸ¥</span>
                        <label class="relative inline-flex items-center cursor-pointer">
                            <input type="checkbox" id="notificationToggle" onchange="toggleNotifications(this.checked)" class="sr-only peer">
                            <div class="w-11 h-6 rounded-full peer peer-focus:ring-2 peer-focus:ring-cyan-300 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:rounded-full after:h-5 after:w-5 after:transition-all" style="background: rgba(0, 242, 255, 0.3);"></div>
                        </label>
                    </div>
                    <p class="text-xs" style="color: var(--primary); opacity: 0.6;">å…è¨±ç¶²é ç™¼é€æé†’é€šçŸ¥</p>
                </div>
                
                <!-- ç‰ˆæœ¬è™Ÿï¼ˆé€£é»ä¸‰æ¬¡é–‹å•Ÿé–‹ç™¼è€…æ¨¡å¼ï¼‰ -->
                <div class="text-center mt-4">
                    <span id="versionText" class="text-xs text-gray-500 cursor-pointer select-none" onclick="handleVersionClick()" title="é€£çºŒé»æ“Šä¸‰æ¬¡é–‹å•Ÿé–‹ç™¼è€…æ¨¡å¼">v2.0.0</span>
                </div>
            </div>
        </div>
    </div>

    <!-- é‡ç½®ç¢ºèª Modal -->
    <div id="resetModal" class="fixed inset-0 bg-gray-900 bg-opacity-75 flex items-center justify-center p-4 z-50 hidden">
        <div class="rounded-xl shadow-2xl w-full max-w-md p-6" style="background: var(--card-bg); border: 1px solid rgba(255, 0, 85, 0.5);">
            <h3 class="text-2xl font-bold mb-4" style="color: var(--accent);">âš ï¸ é‡ç½®æ‰€æœ‰æ•¸æ“š</h3>
            <div class="space-y-4">
                <div class="rounded-lg p-4" style="background: rgba(255, 0, 85, 0.1); border: 1px solid rgba(255, 0, 85, 0.3);">
                    <p class="text-sm font-semibold mb-2" style="color: var(--accent);">æ­¤æ“ä½œå°‡æ¸…é™¤ï¼š</p>
                    <ul class="text-sm space-y-1 list-disc list-inside" style="color: var(--accent);">
                        <li>æ‰€æœ‰ä½¿ç”¨è€…çš„å¾…è¾¦äº‹é …</li>
                        <li>æ‰€æœ‰ä½¿ç”¨è€…çš„è§£é–è¨˜éŒ„</li>
                        <li>æ‰€æœ‰ä½¿ç”¨è€…çš„æ¯æ—¥èªéŒ„</li>
                        <li>æ‰€æœ‰è‡ªè¨‚ä½¿ç”¨è€…ï¼ˆä¿ç•™é»˜èªä½¿ç”¨è€…ï¼‰</li>
                    </ul>
                    <p class="text-sm font-semibold mt-3" style="color: var(--accent);">âš ï¸ æ­¤æ“ä½œç„¡æ³•å¾©åŸï¼</p>
                </div>
                <div class="flex gap-3">
                    <button onclick="confirmReset()"
                            class="flex-1 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition font-semibold">
                        ç¢ºèªé‡ç½®
                    </button>
                    <button onclick="closeResetModal()"
                            class="flex-1 py-2 bg-gray-300 text-gray-800 rounded-lg hover:bg-gray-400 transition font-semibold">
                        å–æ¶ˆ
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ç‹€æ…‹ç®¡ç†
        let currentDate = new Date();
        let selectedDate = null;
        let currentUserId = localStorage.getItem('currentUserId') || 'default';
        let users = JSON.parse(localStorage.getItem('users') || '["default"]');
        let todos = {};

        // é–‹ç™¼è€…æ¨¡å¼
        let developerMode = localStorage.getItem('developerMode') === 'true';

        // 2026å¹´å°ç£ç¯€æ…¶èˆ‡å…¬çœ¾å‡æœŸ
        // 2026å¹´å°ç£ç¯€æ—¥èˆ‡å‡æœŸï¼ˆå·²æ ¸å°æ­£ç¢ºæ—¥æœŸï¼‰
        const taiwanHolidays2026 = {
            // å›ºå®šåœ‹å®šå‡æ—¥
            '2026-01-01': { name: 'å…ƒæ—¦', emoji: 'ğŸŠ', type: 'public' },
            '2026-02-28': { name: 'å’Œå¹³ç´€å¿µæ—¥', emoji: 'ğŸ•Šï¸', type: 'public' },
            '2026-04-04': { name: 'å…’ç«¥ç¯€', emoji: 'ğŸˆ', type: 'public' },
            '2026-04-05': { name: 'æ¸…æ˜ç¯€', emoji: 'ğŸŒ¸', type: 'public' },
            '2026-05-01': { name: 'å‹å‹•ç¯€', emoji: 'ğŸ’¼', type: 'public' },
            '2026-10-10': { name: 'åœ‹æ…¶æ—¥', emoji: 'ğŸ‡¹ğŸ‡¼', type: 'public' },
            
            // 2026å¹´è¾²æ›†æ˜¥ç¯€ï¼ˆ2æœˆ16æ—¥é™¤å¤•ï¼Œ2æœˆ17æ—¥åˆä¸€ï¼‰
            '2026-02-16': { name: 'è¾²æ›†é™¤å¤•', emoji: 'ğŸ®', type: 'public' },
            '2026-02-17': { name: 'æ˜¥ç¯€åˆä¸€', emoji: 'ğŸ§§', type: 'public' },
            '2026-02-18': { name: 'æ˜¥ç¯€åˆäºŒ', emoji: 'ğŸ§§', type: 'public' },
            '2026-02-19': { name: 'æ˜¥ç¯€åˆä¸‰', emoji: 'ğŸ§§', type: 'public' },
            '2026-02-20': { name: 'æ˜¥ç¯€åˆå››', emoji: 'ğŸ§§', type: 'public' },
            '2026-02-21': { name: 'æ˜¥ç¯€åˆäº”', emoji: 'ğŸ§§', type: 'public' },
            
            // 2026å¹´ç«¯åˆç¯€ï¼ˆ6æœˆ3æ—¥ï¼‰
            '2026-06-03': { name: 'ç«¯åˆç¯€', emoji: 'ğŸ¥Ÿ', type: 'public' },
            
            // 2026å¹´ä¸­ç§‹ç¯€ï¼ˆ9æœˆ15æ—¥ï¼‰
            '2026-09-15': { name: 'ä¸­ç§‹ç¯€', emoji: 'ğŸŒ•', type: 'public' },
            
            // 2026å¹´é›™åé€£å‡
            '2026-10-09': { name: 'åœ‹æ…¶é€£å‡', emoji: 'ğŸ‡¹ğŸ‡¼', type: 'public' },
            
            // å…¶ä»–ç‰¹æ®Šç¯€æ—¥
            '2026-02-14': { name: 'è¥¿æ´‹æƒ…äººç¯€', emoji: 'ğŸ’', type: 'special' },
            '2026-03-14': { name: 'ç™½è‰²æƒ…äººç¯€', emoji: 'ğŸ¤', type: 'special' },
            '2026-05-10': { name: 'æ¯è¦ªç¯€', emoji: 'ğŸ’', type: 'special' },
            '2026-08-08': { name: 'çˆ¶è¦ªç¯€', emoji: 'ğŸ‘¨', type: 'special' },
            '2026-10-25': { name: 'é‡é™½ç¯€', emoji: 'ğŸ‚', type: 'traditional' },
            '2026-10-31': { name: 'è¬è–ç¯€', emoji: 'ğŸƒ', type: 'special' },
            '2026-12-24': { name: 'å¹³å®‰å¤œ', emoji: 'ğŸ„', type: 'special' },
            '2026-12-25': { name: 'è–èª•ç¯€', emoji: 'ğŸ…', type: 'special' }
        };

        // æª¢æŸ¥æ—¥æœŸæ˜¯å¦ç‚ºç¯€æ…¶
        function getHolidayInfo(dateKey) {
            return taiwanHolidays2026[dateKey] || null;
        }

        // ç²å–ç¯€æ—¥ç°¡ç¨±ï¼ˆç”¨æ–¼æœˆæ›†é¡¯ç¤ºï¼‰
        function getHolidayShortName(holidayName) {
            const shortNames = {
                'è¥¿æ´‹æƒ…äººç¯€': 'æƒ…äººç¯€',
                'ç™½è‰²æƒ…äººç¯€': 'ç™½è‰²æƒ…äººç¯€',
                'å’Œå¹³ç´€å¿µæ—¥': 'å’Œå¹³ç´€å¿µ',
                'è¾²æ›†é™¤å¤•': 'é™¤å¤•',
                'æ˜¥ç¯€åˆä¸€': 'æ˜¥ç¯€',
                'æ˜¥ç¯€åˆäºŒ': 'åˆäºŒ',
                'æ˜¥ç¯€åˆä¸‰': 'åˆä¸‰',
                'æ˜¥ç¯€åˆå››': 'åˆå››',
                'æ˜¥ç¯€åˆäº”': 'åˆäº”',
                'åœ‹æ…¶é€£å‡': 'åœ‹æ…¶å‡',
                'é‡é™½ç¯€': 'é‡é™½',
                'è¬è–ç¯€': 'è¬è–',
                'å¹³å®‰å¤œ': 'å¹³å®‰å¤œ',
                'æ¯è¦ªç¯€': 'æ¯è¦ªç¯€',
                'çˆ¶è¦ªç¯€': 'çˆ¶è¦ªç¯€'
            };
            return shortNames[holidayName] || holidayName;
        }

        // ä½¿ç”¨è€…ç®¡ç†
        function initUsers() {
            // å¦‚æœç•¶å‰ä½¿ç”¨è€…å­˜åœ¨ä½†ä¸åœ¨åˆ—è¡¨ä¸­ï¼ŒåŠ å…¥åˆ—è¡¨
            if (currentUserId && !users.includes(currentUserId)) {
                users.push(currentUserId);
                saveUsers();
            }
            
            // å¦‚æœæ²’æœ‰ä½¿ç”¨è€…ä¸”æ²’æœ‰ç•¶å‰ä½¿ç”¨è€…ï¼Œå‰µå»ºé è¨­ä½¿ç”¨è€…
            if (users.length === 0 && !currentUserId) {
                users = ['default'];
                currentUserId = 'default';
                saveUsers();
                saveCurrentUser();
            }

            // è¼‰å…¥ç•¶å‰ä½¿ç”¨è€…çš„å¾…è¾¦äº‹é …
            loadUserTodos();

            // æ›´æ–°ä½¿ç”¨è€…åç¨±è¼¸å…¥æ¡†
            updateCurrentUserNameInput();
        }

        function updateCurrentUserNameInput() {
            const userNameInput = document.getElementById('currentUserNameInput');
            if (userNameInput) {
                userNameInput.value = currentUserId;
            }
            // åŒæ™‚æ›´æ–°é¡¯ç¤ºåç¨±
            updateUserDisplay();
        }

        // æ›´æ–°ä½¿ç”¨è€…é¡¯ç¤ºåç¨±
        function updateUserDisplay() {
            const displayName = document.getElementById('currentUserDisplayName');
            if (displayName) {
                displayName.textContent = currentUserId;
            }
        }

        // ä¿å­˜ç•¶å‰ä½¿ç”¨è€…åç¨±ï¼ˆå¦‚æœåç¨±æ”¹è®Šï¼Œæœƒå‰µå»ºæ–°çš„ä½¿ç”¨è€…ï¼‰
        function saveCurrentUserName() {
            const userNameInput = document.getElementById('currentUserNameInput');
            const newUserName = userNameInput.value.trim();

            if (!newUserName) {
                alert('ä½¿ç”¨è€…åç¨±ä¸èƒ½ç‚ºç©º');
                return;
            }

            if (newUserName === currentUserId) {
                alert('ä½¿ç”¨è€…åç¨±æ²’æœ‰æ”¹è®Š');
                return;
            }

            // ä¿å­˜ç•¶å‰ä½¿ç”¨è€…çš„è³‡æ–™
                saveUserTodos();

            // æª¢æŸ¥æ˜¯å¦å·²æœ‰é€™å€‹ä½¿ç”¨è€…
            if (!users.includes(newUserName)) {
                // å‰µå»ºæ–°ä½¿ç”¨è€…
                users.push(newUserName);
                saveUsers();
            }

            // åˆ‡æ›åˆ°æ–°ä½¿ç”¨è€…
            currentUserId = newUserName;
                saveCurrentUser();

                // è¼‰å…¥æ–°ä½¿ç”¨è€…çš„è³‡æ–™
                loadUserTodos();

                // æ¸…é™¤é¸ä¸­ç‹€æ…‹
                selectedDate = null;
                document.getElementById('selectedDateTitle').textContent = 'é¸æ“‡æ—¥æœŸ';
                document.getElementById('todoList').innerHTML = '<p class="text-gray-400 text-sm text-center py-8">è«‹é¸æ“‡æ—¥æœŸæŸ¥çœ‹å¾…è¾¦äº‹é …</p>';
                document.getElementById('addTodoForm').classList.add('hidden');

                // é‡æ–°æ¸²æŸ“
                renderCalendar();
            renderAllTodosList();
            renderDailyQuote();
            // åŒæ­¥æ‰€æœ‰å·²è§£é–çš„èªéŒ„åˆ°å¾…è¾¦äº‹é …
            syncAllQuotesToTodos().then(() => {
                renderCalendar();
                renderAllTodosList();
            });

            alert('ä½¿ç”¨è€…åç¨±å·²ä¿å­˜ï¼');
        }

        // åŒ¯å‡ºç•¶å‰ä½¿ç”¨è€…çš„æ—¥æ›†è³‡æ–™
        function exportUserData() {
            const userData = {
                userId: currentUserId,
                exportDate: new Date().toISOString(),
                todos: todos,
                dailyQuotes: loadDailyQuotes(),
                unlockedDates: loadUnlockedDates(),
                usedQuotes: getUsedQuotes(),
                usedThemes: getUsedThemes()
            };

            const json = JSON.stringify(userData, null, 2);
            const blob = new Blob([json], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `${currentUserId}_æ—¥æ›†è³‡æ–™_${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);

            alert(`âœ… ${currentUserId} çš„æ—¥æ›†è³‡æ–™å·²åŒ¯å‡ºï¼`);
        }

        function loadUserTodos() {
            const todosKey = `todos_${currentUserId}`;
            todos = JSON.parse(localStorage.getItem(todosKey) || '{}');
            renderAllTodosList(); // è¼‰å…¥ä½¿ç”¨è€…è³‡æ–™å¾Œæ›´æ–°åˆ—è¡¨
        }

        function saveUserTodos() {
            const todosKey = `todos_${currentUserId}`;
            localStorage.setItem(todosKey, JSON.stringify(todos));
        }

        function saveUsers() {
            localStorage.setItem('users', JSON.stringify(users));
        }

        function saveCurrentUser() {
            localStorage.setItem('currentUserId', currentUserId);
        }

        // switchUser å‡½æ•¸å·²ç§»é™¤ï¼Œæ”¹ç”¨ saveCurrentUserName

        function openAddUserModal() {
            document.getElementById('addUserModal').classList.remove('hidden');
            document.getElementById('newUserNameInput').value = '';
            document.getElementById('newUserNameInput').focus();
        }

        function closeAddUserModal() {
            document.getElementById('addUserModal').classList.add('hidden');
        }

        function addNewUser() {
            const input = document.getElementById('newUserNameInput');
            const userName = input.value.trim();

            if (!userName) {
                alert('è«‹è¼¸å…¥ä½¿ç”¨è€…åç¨±');
                return;
            }

            if (users.includes(userName)) {
                alert('æ­¤ä½¿ç”¨è€…åç¨±å·²å­˜åœ¨');
                return;
            }

            // æ–°å¢ä½¿ç”¨è€…
            users.push(userName);
            saveUsers();

            // åˆ‡æ›åˆ°æ–°ä½¿ç”¨è€…
            currentUserId = userName;
            saveCurrentUser();
            todos = {};
            saveUserTodos();

            // æ›´æ–° UI
            updateCurrentUserNameInput();
            renderCalendar();
            renderAllTodosList(); // æ›´æ–°æ‰€æœ‰å¾…è¾¦äº‹é …åˆ—è¡¨
            renderDailyQuote().catch(err => console.error('æ¸²æŸ“èªéŒ„å¤±æ•—:', err)); // æ›´æ–°æ¯æ—¥èªéŒ„
            closeAddUserModal();

            // æ¸…é™¤é¸ä¸­ç‹€æ…‹
            selectedDate = null;
            document.getElementById('selectedDateTitle').textContent = 'é¸æ“‡æ—¥æœŸ';
            document.getElementById('todoList').innerHTML = '<p class="text-gray-400 text-sm text-center py-8">è«‹é¸æ“‡æ—¥æœŸæŸ¥çœ‹å¾…è¾¦äº‹é …</p>';
            document.getElementById('addTodoForm').classList.add('hidden');
        }

        // è¨­å®š Modal åŠŸèƒ½
        function openSettingsModal() {
            const modal = document.getElementById('settingsModal');
            const input = document.getElementById('settingsUserNameInput');
            const calendarTitleInput = document.getElementById('calendarTitleInput');
            const themeSelector = document.getElementById('themeSelector');
            const fullscreenToggle = document.getElementById('fullscreenModeToggle');
            const notificationToggle = document.getElementById('notificationToggle');
            
            input.value = currentUserId;
            
            // è¼‰å…¥ç•¶å‰æœˆæ›†åç¨±
            const currentTitle = localStorage.getItem('calendarTitle') || 'å½¢å¼æ›†';
            calendarTitleInput.value = currentTitle;
            
            // è¼‰å…¥ç•¶å‰ä¸»é¡Œè¨­å®š
            const currentTheme = localStorage.getItem('appTheme') || 'cyberpunk';
            themeSelector.value = currentTheme;
            
            // è¼‰å…¥å…¨è¢å¹•æ¨¡å¼ç‹€æ…‹
            if (fullscreenToggle) {
                fullscreenToggle.checked = isFullscreenMode;
            }
            
            // è¼‰å…¥é€šçŸ¥è¨­å®š
            if (notificationToggle) {
                notificationToggle.checked = notificationsEnabled;
            }
            
            modal.classList.remove('hidden');
        }

        function closeSettingsModal() {
            document.getElementById('settingsModal').classList.add('hidden');
        }

        function saveUserNameFromSettings() {
            const input = document.getElementById('settingsUserNameInput');
            const newUserId = input.value.trim();
            if (newUserId === '') {
                alert('è«‹è¼¸å…¥ä½¿ç”¨è€…åç¨±');
                return;
            }
            currentUserId = newUserId;
            localStorage.setItem('currentUserId', currentUserId);
            updateUserDisplay();
            alert('ä½¿ç”¨è€…åç¨±å·²ä¿å­˜');
        }

        // æœˆæ›†åç¨±åŠŸèƒ½
        function saveCalendarTitle() {
            const input = document.getElementById('calendarTitleInput');
            const newTitle = input.value.trim();
            if (newTitle === '') {
                alert('è«‹è¼¸å…¥æœˆæ›†åç¨±');
                return;
            }
            localStorage.setItem('calendarTitle', newTitle);
            updateCalendarTitle();
            alert('æœˆæ›†åç¨±å·²ä¿å­˜');
        }

        function updateCalendarTitle() {
            const customTitle = localStorage.getItem('calendarTitle') || '';
            const titleElement = document.getElementById('calendarTitle');
            
            if (titleElement) {
                if (customTitle && customTitle !== 'å½¢å¼æ›†') {
                    titleElement.textContent = customTitle;
                } else {
                    titleElement.textContent = 'å½¢å¼æ›†';
                }
            }
            
            // æ›´æ–°ç¶²é æ¨™é¡Œ
            if (customTitle && customTitle !== 'å½¢å¼æ›†') {
                document.title = 'å½¢å¼æ›† - ' + customTitle;
            } else {
                document.title = 'å½¢å¼æ›†';
            }
        }

        // Firebase é€£æ¥ç‹€æ…‹æ›´æ–°
        function updateFirebaseStatus(connected) {
            const statusDot = document.getElementById('firebaseStatusDot');
            if (statusDot) {
                if (connected) {
                    statusDot.style.background = '#10b981'; // ç¶ è‰²
                    statusDot.title = 'Firebase å·²é€£æ¥';
                } else {
                    statusDot.style.background = '#ef4444'; // ç´…è‰²
                    statusDot.title = 'Firebase æœªé€£æ¥';
                }
            }
        }

        // å…¨è¢å¹•æ¨¡å¼åŠŸèƒ½
        let isFullscreenMode = false;
        function toggleFullscreenMode(enabled) {
            isFullscreenMode = enabled;
            localStorage.setItem('fullscreenMode', enabled.toString());
            
            const todoPanel = document.querySelector('.w-full.lg\\:flex-\\[1\\]');
            if (todoPanel) {
                if (enabled) {
                    todoPanel.classList.add('hidden');
                } else {
                    todoPanel.classList.remove('hidden');
                }
            }
        }

        function loadFullscreenMode() {
            const saved = localStorage.getItem('fullscreenMode');
            isFullscreenMode = saved === 'true';
            const toggle = document.getElementById('fullscreenModeToggle');
            if (toggle) {
                toggle.checked = isFullscreenMode;
            }
            if (isFullscreenMode) {
                toggleFullscreenMode(true);
            }
        }

        // åˆ‡æ›æ–°å¢å¾…è¾¦äº‹é …è¡¨å–®
        function toggleAddTodoForm() {
            const form = document.getElementById('addTodoForm');
            const button = document.getElementById('addTodoButton');
            
            if (form.classList.contains('hidden')) {
                form.classList.remove('hidden');
                button.classList.add('hidden');
                // è‡ªå‹•èšç„¦åˆ°è¼¸å…¥æ¡†
                document.getElementById('newTodoInput').focus();
            } else {
                form.classList.add('hidden');
                button.classList.remove('hidden');
                // æ¸…ç©ºè¼¸å…¥
                document.getElementById('newTodoInput').value = '';
                document.getElementById('todoTimeInput').value = '';
            }
        }

        // åˆ‡æ›æ‰€æœ‰å¾…è¾¦äº‹é …å±•é–‹/æ”¶åˆ
        let allTodosExpanded = false;
        function toggleAllTodosExpanded() {
            const content = document.getElementById('allTodosContent');
            const icon = document.getElementById('allTodosToggleIcon');
            
            allTodosExpanded = !allTodosExpanded;
            
            if (allTodosExpanded) {
                content.classList.remove('hidden');
                icon.style.transform = 'rotate(180deg)';
            } else {
                content.classList.add('hidden');
                icon.style.transform = 'rotate(0deg)';
            }
        }

        // é€šçŸ¥åŠŸèƒ½
        let notificationsEnabled = false;
        async function toggleNotifications(enabled) {
            if (enabled) {
                if ('Notification' in window) {
                    const permission = await Notification.requestPermission();
                    if (permission === 'granted') {
                        notificationsEnabled = true;
                        localStorage.setItem('notificationsEnabled', 'true');
                        alert('âœ… é€šçŸ¥å·²å•Ÿç”¨ï¼');
                    } else {
                        document.getElementById('notificationToggle').checked = false;
                        alert('âŒ éœ€è¦é€šçŸ¥æ¬Šé™æ‰èƒ½ä½¿ç”¨æ­¤åŠŸèƒ½');
                    }
                } else {
                    alert('âŒ æ‚¨çš„ç€è¦½å™¨ä¸æ”¯æ´é€šçŸ¥åŠŸèƒ½');
                    document.getElementById('notificationToggle').checked = false;
                }
            } else {
                notificationsEnabled = false;
                localStorage.setItem('notificationsEnabled', 'false');
            }
        }

        function loadNotificationSettings() {
            const saved = localStorage.getItem('notificationsEnabled');
            notificationsEnabled = saved === 'true';
            const toggle = document.getElementById('notificationToggle');
            if (toggle) {
                toggle.checked = notificationsEnabled;
            }
        }

        function scheduleNotification(todo, dateKey, time) {
            if (!notificationsEnabled) return;
            
            const [year, month, day] = dateKey.split('-').map(Number);
            const [hours, minutes] = time.split(':').map(Number);
            const notificationTime = new Date(year, month - 1, day, hours, minutes);
            const now = new Date();
            const delay = notificationTime.getTime() - now.getTime();
            
            if (delay > 0) {
                setTimeout(() => {
                    if ('Notification' in window && Notification.permission === 'granted') {
                        new Notification('ğŸ“… å½¢å¼æ›†æé†’', {
                            body: todo,
                            icon: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><text y=".9em" font-size="90">ğŸ“…</text></svg>',
                            tag: `todo-${dateKey}-${Date.now()}`
                        });
                    }
                }, delay);
                
                // ä¿å­˜æé†’åˆ°localStorage
                const reminders = JSON.parse(localStorage.getItem('todoReminders') || '{}');
                if (!reminders[dateKey]) reminders[dateKey] = [];
                reminders[dateKey].push({ todo, time: notificationTime.toISOString() });
                localStorage.setItem('todoReminders', JSON.stringify(reminders));
            }
        }

        // ä¸»é¡Œåˆ‡æ›åŠŸèƒ½
        const themes = {
            cyberpunk: {
                primary: '#00f2ff',
                secondary: '#7000ff',
                accent: '#ff0055',
                gold: '#ffd700',
                cardBg: 'rgba(13, 13, 35, 0.8)',
                warning: '#ff9900'
            },
            ocean: {
                primary: '#00d9ff',
                secondary: '#0080ff',
                accent: '#00ffaa',
                gold: '#ffdd00',
                cardBg: 'rgba(10, 25, 47, 0.8)',
                warning: '#ff7700'
            },
            forest: {
                primary: '#00ff88',
                secondary: '#00aa55',
                accent: '#88ff00',
                gold: '#ffcc00',
                cardBg: 'rgba(15, 30, 20, 0.8)',
                warning: '#ffaa00'
            },
            sunset: {
                primary: '#ff6b35',
                secondary: '#f7931e',
                accent: '#ff0080',
                gold: '#ffd700',
                cardBg: 'rgba(30, 20, 25, 0.8)',
                warning: '#ff5500'
            },
            purple: {
                primary: '#b24bf3',
                secondary: '#8b5cf6',
                accent: '#ec4899',
                gold: '#fbbf24',
                cardBg: 'rgba(20, 15, 35, 0.8)',
                warning: '#f59e0b'
            },
            dark: {
                primary: '#ffffff',
                secondary: '#888888',
                accent: '#666666',
                gold: '#aaaaaa',
                cardBg: 'rgba(0, 0, 0, 0.9)',
                warning: '#999999'
            }
        };

        function changeTheme(themeName) {
            const theme = themes[themeName];
            if (!theme) return;
            
            const root = document.documentElement;
            root.style.setProperty('--primary', theme.primary);
            root.style.setProperty('--secondary', theme.secondary);
            root.style.setProperty('--accent', theme.accent);
            root.style.setProperty('--gold', theme.gold);
            root.style.setProperty('--card-bg', theme.cardBg);
            root.style.setProperty('--warning', theme.warning);
            
            // å„²å­˜ä¸»é¡Œè¨­å®š
            localStorage.setItem('appTheme', themeName);
            
            // é‡æ–°æ¸²æŸ“æœˆæ›†ä»¥æ‡‰ç”¨æ–°é¡è‰²
            renderCalendar();
        }

        // åˆå§‹åŒ–æ™‚è¼‰å…¥ä¸»é¡Œ
        function loadTheme() {
            const savedTheme = localStorage.getItem('appTheme') || 'cyberpunk';
            changeTheme(savedTheme);
        }

        // ç‰ˆæœ¬è™Ÿé»æ“Šè™•ç†ï¼ˆé€£é»ä¸‰æ¬¡é–‹å•Ÿé–‹ç™¼è€…æ¨¡å¼ï¼‰
        let versionClickCount = 0;
        let versionClickTimer = null;
        function handleVersionClick() {
            versionClickCount++;
            
            if (versionClickTimer) {
                clearTimeout(versionClickTimer);
            }
            
            versionClickTimer = setTimeout(() => {
                versionClickCount = 0;
            }, 1000);
            
            if (versionClickCount >= 3) {
                versionClickCount = 0;
                if (versionClickTimer) {
                    clearTimeout(versionClickTimer);
                }
                toggleDeveloperMode();
            }
        }

        // é‡ç½®åŠŸèƒ½
        function openResetModal() {
            document.getElementById('resetModal').classList.remove('hidden');
        }

        function closeResetModal() {
            document.getElementById('resetModal').classList.add('hidden');
        }

        function confirmReset() {
            // æ¸…é™¤æ‰€æœ‰ä½¿ç”¨è€…çš„å¾…è¾¦äº‹é …
            const allKeys = Object.keys(localStorage);
            allKeys.forEach(key => {
                if (key.startsWith('todos_')) {
                    localStorage.removeItem(key);
                }
                if (key.startsWith('unlockedDates_')) {
                    localStorage.removeItem(key);
                }
                if (key.startsWith('dailyQuotes_')) {
                    localStorage.removeItem(key);
                }
                if (key === 'dailyQuotes_list') {
                    localStorage.removeItem(key);
                }
                if (key.startsWith('usedQuotes_')) {
                    localStorage.removeItem(key);
                }
                if (key.startsWith('usedThemes_')) {
                    localStorage.removeItem(key);
                }
            });

            // é‡ç½®ä½¿ç”¨è€…åˆ—è¡¨ï¼ˆä¿ç•™é»˜èªä½¿ç”¨è€…ï¼‰
            users = ['default'];
            saveUsers();

            // é‡ç½®ç•¶å‰ä½¿ç”¨è€…
            currentUserId = 'default';
            saveCurrentUser();

            // é‡ç½®å¾…è¾¦äº‹é …
            todos = {};
            saveUserTodos();

            // é‡ç½®é¸ä¸­æ—¥æœŸ
            selectedDate = null;

            // é—œé–‰ Modal
            closeResetModal();

            // é‡æ–°åˆå§‹åŒ–ä¸¦æ¸²æŸ“
            initUsers();
            renderCalendar();
            renderTodos();
            renderAllTodosList();
            renderDailyQuote().catch(err => console.error('æ¸²æŸ“èªéŒ„å¤±æ•—:', err));

            alert('âœ… æ‰€æœ‰æ•¸æ“šå·²é‡ç½®ï¼');
        }

        // æ”¯æ´ Enter éµæ–°å¢ä½¿ç”¨è€…
        document.getElementById('newUserNameInput')?.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                addNewUser();
            }
        });

        // æœˆä»½åç¨±
        const monthNames = ['ä¸€æœˆ', 'äºŒæœˆ', 'ä¸‰æœˆ', 'å››æœˆ', 'äº”æœˆ', 'å…­æœˆ', 'ä¸ƒæœˆ', 'å…«æœˆ', 'ä¹æœˆ', 'åæœˆ', 'åä¸€æœˆ', 'åäºŒæœˆ'];
        const dayNames = ['æ—¥', 'ä¸€', 'äºŒ', 'ä¸‰', 'å››', 'äº”', 'å…­'];

        // æ¯æ—¥èªéŒ„æ•¸æ“šåº«
        // å¾ quotes-data.html è¼‰å…¥èªéŒ„åˆ—è¡¨
        let dailyQuotesLoaded = false;
        let dailyQuotesData = [];

        // å¾ quotes-data.html è¼‰å…¥èªéŒ„
        function loadQuotesFromFile() {
            return new Promise((resolve, reject) => {
                if (dailyQuotesLoaded) {
                    resolve(dailyQuotesData);
                    return;
                }

                // ä½¿ç”¨ iframe è¼‰å…¥ quotes-data.html
                const iframe = document.createElement('iframe');
                iframe.style.display = 'none';
                iframe.src = 'quotes-data.html';

                iframe.onload = function() {
                    try {
                        const quotesWindow = iframe.contentWindow;
                        if (quotesWindow && quotesWindow.DAILY_QUOTES_LIST) {
                            dailyQuotesData = quotesWindow.DAILY_QUOTES_LIST;
                            dailyQuotesLoaded = true;
                            document.body.removeChild(iframe);
                            resolve(dailyQuotesData);
                        } else {
                            // å¦‚æœè¼‰å…¥å¤±æ•—ï¼Œä½¿ç”¨é»˜èªèªéŒ„
                            dailyQuotesData = getDefaultQuotes();
                            dailyQuotesLoaded = true;
                            document.body.removeChild(iframe);
                            resolve(dailyQuotesData);
                        }
                    } catch (e) {
                        console.error('è¼‰å…¥èªéŒ„å¤±æ•—:', e);
                        // ä½¿ç”¨é»˜èªèªéŒ„
                        dailyQuotesData = getDefaultQuotes();
                        dailyQuotesLoaded = true;
                        document.body.removeChild(iframe);
                        resolve(dailyQuotesData);
                    }
                };

                iframe.onerror = function() {
                    console.error('ç„¡æ³•è¼‰å…¥ quotes-data.html');
                    dailyQuotesData = getDefaultQuotes();
                    dailyQuotesLoaded = true;
                    if (iframe.parentNode) {
                        document.body.removeChild(iframe);
                    }
                    resolve(dailyQuotesData);
                };

                document.body.appendChild(iframe);

                // è¨­ç½®è¶…æ™‚ï¼Œå¦‚æœ 3 ç§’å…§æ²’è¼‰å…¥å®Œæˆå°±ä½¿ç”¨é»˜èªå€¼
                setTimeout(() => {
                    if (!dailyQuotesLoaded) {
                        dailyQuotesData = getDefaultQuotes();
                        dailyQuotesLoaded = true;
                        if (iframe.parentNode) {
                            document.body.removeChild(iframe);
                        }
                        resolve(dailyQuotesData);
                    }
                }, 3000);
            });
        }

        // ç²å–é»˜èªèªéŒ„ï¼ˆä½œç‚ºå‚™ç”¨ï¼‰
        function getDefaultQuotes() {
            return [
            "ä¸æœŸå¾… ä¸å‡è¨­ ä¸å¼·æ±‚\næ˜¯ä¿æŒæƒ…ç·’ç©©å®šçš„ç§˜è¨£",
            "æ²’äººèƒ½æ‰“æ“¾ä½ å…§å¿ƒçš„å¹³éœ\né™¤éä½ æ‹±æ‰‹ç›¸è®“",
            "åˆ¥å¸Œæœ›åˆ¥ç›¼æœ›\nåˆ¥æŒ‡æœ› å°±ä¸æœƒå¤±æœ›",
            "å‹‡æ•¢å°±æ˜¯\næŠŠåšè‡ªå·±ç•¶æˆæ—¥å¸¸",
            "é€™ä¸€è·¯å¾ˆé›£\nä½†é‚„æ˜¯æ’éä¾†äº†",
            "å¦‚æœä¸æ˜¯é€™å€‹\nå°±ä¸€å®šæœ‰æ›´å¥½çš„",
            "ä¸è¦å› ç‚ºç¾å¯¦ç”Ÿæ´»çš„ç…©èº\nè€Œæ”¾æ£„æ„Ÿè¦ºçš„èƒ½åŠ›",
            "å­¸æœƒè‡ªæ„›\nå°±ä¸æ€•è¢«æ‰“æ•—",
            "çµ•å°ä¸è¦åœ¨ç³Ÿç³•çš„é‚£å¤©\næšè¨€æ”¾æ£„",
            "é¦–å…ˆä½ è¦é–‹å¿ƒ\nå…¶æ¬¡éƒ½æ˜¯å…¶æ¬¡",
            "I am because you are\næˆ‘å­˜åœ¨ æ˜¯å› ç‚ºä½ ",
            "Let it be\nTo be or not to be",
            "å¦‚æœæ–¹å‘éŒ¯äº†\nåœæ­¢å°±æ˜¯æœ€å¤§çš„é€²æ­¥",
            "ä½ æ‹¼å‘½é€—ç¬‘çš„äºº\nçµ‚ç©¶æ¯”ä¸é",
            "å‡ºç”Ÿä¸è©²è¢«å˜²ç¬‘\nå¤¢æƒ³ä¸è©²è¢«ç¾æ¥",
            "å¤¢æƒ³ä¸æœƒé€ƒèµ° \né€ƒèµ°çš„ä¸€ç›´éƒ½æ˜¯è‡ªå·±",
            "æƒ…æ³ä¸æœƒè®Šå¾—æ›´å¥½\nä½†ä¹Ÿè®Šå¾—æ›´ä¸ä¸€æ¨£äº†",
            "åªè¦æ´»å¾—å¤ ä¹… ç”Ÿå‘½çš„é•·åº¦\nå°±æœƒç¨€é‡‹éŒ¯èª¤çš„æ¿ƒåº¦",
            "äººç”Ÿæœ‰å…©ç¨®äº‹ ä¸€ç¨®æ˜¯å¥½äº‹\nå¦ä¸€ç¨®æ˜¯ä¸çŸ¥é“å¥½åœ¨å“ªçš„äº‹",
            "ç«¹ç±ƒæ‰“æ°´ä¸€å ´ç©º\nè‡³å°‘ç«¹ç±ƒä¹¾æ·¨äº†",
            "å…ˆé–‹å£ è¢«æ‹’çµ•äº†å†èªª\nè¨˜å¾—å…ˆåšå€‹åƒåœ¾å‡ºä¾†",
            "ä¸è¦å®³æ€•ä¸‰åˆ†é˜ç†±åº¦\nè‡³å°‘æœƒæœ‰ä¸‰åˆ†é˜æ”¶ç©«",
            "æ¨æ˜¯ç”Ÿç”¢åŠ›\næ„› åªèƒ½ç”Ÿç”¢",
            "æˆé•·ä¸æ˜¯è®“æ‰€æœ‰äººå–œæ­¡ä½ \nè€Œæ˜¯å­¸æœƒæ¥å—æœ‰äººä¸å–œæ­¡ä½ ",
            "æœ‰äº›äººèƒ½å¤ å…±å­˜å·²ç¶“å¾ˆå¥½\nç¡¬è¦ç›¸è™•å°±æ˜¯å¥¢æ±‚",
            "æ‡‚äº‹è½èµ·ä¾†æ˜¯ç¨±è®š\nä½†å…¶å¯¦æ˜¯è¦æˆ‘å€‘å—å§”å±ˆ",
            "æ†‚é¬±çš„æ ¹æœ¬\næ˜¯å¤±å»è‡ªæˆ‘",
            "å¿ƒå¤ªç´¯çš„æ™‚å€™\nå…ˆåŸè«’è‡ªå·±",
            "ç›¡æƒ…ç”Ÿæ´»\nåšéçš„äº‹æƒ…éƒ½ä¸è¦å¾Œæ‚”",
            "ç¡å‰åŸè«’ä¸€åˆ‡\né†’ä¾†ä¾¿æ˜¯é‡ç”Ÿ",
            "GoogleMapä¸æœƒè²¬å‚™ä½ \næ‰€ä»¥ä½ ä¹Ÿåˆ¥è²¬å‚™ä½ è‡ªå·±",
            "ä¸å¿…æ€¥è‘—è®“åŠªåŠ›ç«‹åˆ»è¦‹æ•ˆ\nä¹Ÿä¸å¿…äº‹äº‹éƒ½åšåˆ°å®Œç¾",
            "ä¸éœ€è¦çˆ­å¼·å¥½å‹\nåªè¦æ´»å‡ºç²¾å½©",
            "æ²’æœ‰æ†‚æ„çš„æ™‚å€™\nå°±æ˜¯æœ€å¥½çš„æ™‚å€™",
            "æŠŠç—›è‹¦æ”¾å›ä»–è©²å»çš„ä½ç½®\näººç”Ÿæœ‰å¾ˆå¤šå€¼å¾—æœŸå¾…çš„äº‹",
            "æ²’æœ‰äººä¸€ç›´åœ¨çœ‹ä½ \næ´»è‘—ä¸éœ€è¦æœ‰ä»»ä½•åŒ…è¢±",
            "ç…§é¡§å¥½è‡ªå·±\nå°±æ˜¯æˆå®¶äº†",
            "ä¸‰æ€è€Œå¾Œè¡Œ\nå†ï¼Œæ–¯å¯çŸ£",
            "è¦å˜›å¤§çˆ†ç‚¸\nè¦å˜›ä¸€èµ·æ­»",
            "å‡¡äº‹å…ˆå»åš\néç¨‹åœ¨ç¸«ç¸«è£œè£œ",
            "å‘¨åœåµé›œçš„è²éŸ³\nçœŸçš„æ²’æœ‰é‚£éº¼é‡è¦",
            "ä¸è¦å› ç‚ºåˆ¥äººçš„çœ‹æ³•\nå½±éŸ¿è‡ªå·±çš„æƒ…ç·’",
            "æ¯ä¸€å¤©æ¯ä¸€å€‹å±¤é¢\næˆ‘éƒ½è¶Šä¾†è¶Šå¥½",
            "åœ¨å¥½èµ·ä¾†ä¹‹å‰\nå…ˆæ¥å—è‡ªå·±ç„¡èƒ½ç‚ºåŠ›",
            "åˆ¥æŒ‡æœ›ä»»ä½•äºº\nè«‹å¥½å¥½æ„›è‡ªå·±",
            "å…¬å¹³çš„æ˜¯\næˆ‘å€‘çš„å¤±å»éƒ½æ˜¯å°ç­‰çš„",
            "ä»€éº¼éƒ½ç„¡æ‰€è¬‚\næ‰æ˜¯æ”¯é›¢ç ´ç¢",
            "ä¸æœƒå› ç‚ºä½ å–„è‰¯å°±å°ä½ æº«æŸ”\nè¨˜å¾—å°è‡ªå·±æº«æŸ”ä¸€é»",
            "æ‹è‘—ä¸€è¢‹åƒåœ¾ \nå°±æœƒéŒ¯éå¾ˆå¤šçš„ç¦®ç‰©",
            "æ²’æœ‰ä»€éº¼æ”¾ä¸ä¸‹\næƒ³å¾—å¤ªå¤šåªæœƒè®“äººç”Ÿæ›´ç´¯",
            "å®‰æ…°ä¸¦é¼“å‹µæ‰€æœ‰äºº\nå”¯ç¨ä¸è‚¯æ”¾éè‡ªå·±",
            "å­¸æœƒæº«æŸ”ä»¥å¾…\næ¥ç´ä¸å®Œç¾çš„è‡ªå·±",
            "æ¸…è€…è‡ªæ¸…\nä¸éœ€è¦å‘ä»»ä½•äººè§£é‡‹",
            "æˆ‘ç¶“æ­·é»‘æš—\nä½†æˆ‘ä¿æŒæ¸…æ¾ˆåˆå¿ƒ",
            "èª°éƒ½å¯ä»¥ä¸å–œæ­¡ä½ \nä½†ä½ è‡ªå·±ä¸å¯ä»¥",
            "äººç¸½è¦åš¥ä¸‹äº›å§”å±ˆ\næ¥è‘—éš»å­—ä¸æçš„å‘å‰èµ°",
            "è‹¥ç„¡æ³•æ”¹è®Šç¾ç‹€\né‚£å°±äº«å—ç•¶ä¸‹",
            "é€™åªæ˜¯ç³Ÿç³•çš„ä¸€å¤©\næ²’ä»€éº¼å¤§ä¸äº†",
            "äººç”Ÿé™¤äº†ç”Ÿæ­»\nå…¶ä»–éƒ½æ˜¯å°äº‹",
            "æˆ‘å€‘éƒ½ä¸ç”¨æ”¹\nä¸èˆ’æœçš„é—œä¿‚å°±æ–·é–‹",
            "å¤©é»‘å¯ä»¥çŸ¯æƒ…\nå¤©äº®å°±å¾—æ‹¼å‘½",
            "æˆå¹´äººçš„æœ€å¤§æˆå°±\næ˜¯å…‹åˆ¶ç³¾æ­£ä»–äººçš„æ…¾æœ›",
            "ä½ æ¯”ä½ è‡ªå·±æƒ³åƒçš„é‚„è¦å‹‡æ•¢\nåˆ¥å› ä»–äººçš„è©±è€Œè®“è‡ªå·±é»¯æ·¡",
            "é€™å€‹ä¸–ç•Œä¸ç¼ºå°‘æˆåŠŸçš„äºº\næˆ‘å€‘éœ€è¦æ›´å¤šçš„è¬›æ•…äº‹",
            "é•·å¤§å§ï¼\né€™å€‹ä¸–ç•Œä¸æ˜¯ä½ çš„è€æ¯è¦ªã€‚",
            "æ‚²è§€é€šå¸¸ä¸æ„å‘³è‘—ç”Ÿæ´»è‰±é›£å’Œç–²æ†Š\nè€Œæ˜¯ç„¡æ³•æ§åˆ¶çš„æƒ³åƒã€‚",
            "ç•¶å‘½é‹è¦æ±‚ä½ é€†é¢¨é£›ç¿”æ™‚\nå¸Œæœ›ä½ ä¸è¦é¸æ“‡éš¨æ³¢é€æµã€‚",
            "èƒ½å¾æš´é¢¨é›¨ä¸­èµ°å‡ºä¾†çš„äºº\nå¾ä¾†ä¸æ˜¯å› ç‚ºæœ‰æŠŠå‚˜ã€‚",
            "æˆ‘å€‘æ²’æœ‰åšéŒ¯ä»€éº¼\nä½†æˆ‘å€‘è¼¸äº†ã€‚",
            "åªæœ‰ç¶“éæ·±åˆ»çš„æ•™è¨“\næ‰èƒ½æ˜ç™½é€™å¥è©±çš„æ„ç¾©ã€‚",
            "çæƒœä½ ä½æ½®çš„æ™‚å€™\nä½ æœƒçœ‹åˆ°å¾ˆå¤šçœŸç›¸ã€‚",
            "ç…§äº®ç”Ÿå‘½çš„ä¸æ˜¯ç¾æ™¯\nè€Œæ˜¯ä¸€å€‹å¥½çš„å¸Œæœ›ã€‚",
            "ç„¡è«–å¦‚ä½•ï¼Œæ­²æœˆæ¼«é•·\nä½†å€¼å¾—ç­‰å¾…ã€‚",
            "ç¦éŒ®è‡ªå·±\næ˜¯ä¸€å€‹æ¨™ç±¤ï¼Œä¸€å€‹åè¦‹ã€‚",
            "å¿ƒæ°£æ˜¯ä¸å¯å†ç”Ÿä¹‹ç‰©\nçæƒœ",
            "è®“ç”Ÿå‘½å¦‚å¤èŠ±èˆ¬çµ¢éº—\næ­»äº¡å¦‚ç§‹è‘‰èˆ¬éœç¾ã€‚",
            "åœ¨è®Šå¥½ä¹‹å‰\näº‹æƒ…ç¸½æœƒè®Šå¾—æ›´ç³Ÿã€‚",
            "å®ƒç¸½æ˜¯æœƒç™¼å…‰çš„\nå³ä½¿æ²’æœ‰å¤ªé™½ã€‚",
            "è®“è‡ªå·±è®Šå¾—æ›´å¥½\nè®“è‡ªå·±å¿«æ¨‚ã€‚",
            "ä¸è¦ç‚ºä¸é‡è¦çš„äººå’Œäº‹æ“å¿ƒ\né•·æœŸå¿ƒçµã€‚",
            "æ­»äº¡\nåªæ˜¯å¦ä¸€å ´å‰å¤§çš„å†’éšªã€‚",
            "äººç”Ÿç„¡éå°±æ˜¯å…©ç¨®çµæœ\nå¯ç¬‘ä¸”æœ‰æ•ˆã€‚",
            "äººç”Ÿå°±æ˜¯é€™æ¨£\nç„¡è«–æ€éº¼èµ°ï¼Œç¸½æœƒæœ‰éºæ†¾ã€‚",
            "ç•¶ä¸‹å¡è¶³å¤ å¿«çš„æ™‚å€™\nå±•é–‹ç¿…è†€ï¼Œå…‹æœå›°é›£ã€‚",
            "åŠæ™‚é†’æ‚Ÿ\nä¹Ÿé¡˜æ„ä»˜å‡ºä¸€åˆ‡ã€‚",
            "æ²’æœ‰äººæœƒæ°¸é æ„›ä½ \nä½†ç¸½æœƒæœ‰äººæ„›ä½ ã€‚",
            "é¢¨åœåœ¨çª—é‚Š\nå‘Šè¨´ä½ è¦æ„›é€™å€‹ä¸–ç•Œã€‚",
            "åˆ¥äººçš„çœ‹æ³•åƒ…åƒ…æ˜¯çœ‹æ³•\næ²’æœ‰äººæ¯”ä½ è‡ªå·±æ›´æ‡‚å¾—åšè‡ªå·±ã€‚",
            "åœ¨äººç”Ÿä¸­\næ²’æœ‰ä¸€å®šè¦å¯¦ç¾çš„ç›®æ¨™ã€‚",
            "æ¯ä¸€å€‹é›¨å¤©ä¹‹å¾Œéƒ½æ˜¯æ™´å¤©\né¢¨æš´éå¾Œæœƒæœ‰å½©è™¹ã€‚",
            "å‹‡æ•¢é¢å°\nè¿æ¥ä¸‹ä¸€å€‹æŒ‘æˆ°ã€‚",
            "è·Œå€’äº†æ²’é—œä¿‚\nå†ç«™èµ·ä¾†å°±å¥½ï¼Œæˆ–è€…å°±èººè‘—å§ã€‚",
            "å¦‚æœä½ ä¸çŸ¥é“å¦‚ä½•ä¼‘æ¯\næ€éº¼çŸ¥é“å¦‚ä½•å‰é€²ã€‚",
            "æ”¾éé€™æ¢å°æºªå§\né‚„æœ‰æ›´ç¾çš„å±±å·ã€‚",
            "å¦‚æœäººç”Ÿæ˜¯ä¸€åˆ—ç«è»Š\nè»Šç¥¨å°±æ˜¯ç¶“æ­·ã€‚",
            "ä¸è¦å› ç‚ºåˆ¥äºº\nè€Œå½±éŸ¿è‡ªå·±çš„å¿ƒæƒ…ã€‚",
            "å¹¸ç¦æ˜¯ä¸€ç¨®ä¿®è¡Œ\nä½†å®ƒä¸æ˜¯äººç”Ÿçš„å”¯ä¸€ã€‚",
            "çœŸæ­£çš„å¹¸ç¦\næ˜¯åŠªåŠ›çˆ¬ä¸Šå±±å·”ã€‚",
            "æˆ‘æ˜¯å¤©ç©º\nå®¹ç´ä»»ä½•ä¸€æœµé›²ã€‚",
            "ç”Ÿæ´»ç¹¼çºŒ\nè¶…è¶Šå¿ƒæƒ…ä¹‹å¤–ã€‚",
            "å‘Šåˆ¥é‚£äº›å¿ƒç—›\nå‰©ä¸‹çš„äººç”Ÿæ¯ä¸€åˆ»éƒ½å€¼å¾—æ¿€å‹•ã€‚",
            "äººç”Ÿæ²’æœ‰æ¨™æº–ç­”æ¡ˆ\nçæƒœç•¶ä¸‹å°±æ˜¯æœ€å¥½çš„ç­”æ¡ˆã€‚",
            "ç¶“æ­·é¢¨é›¨\næ‰èƒ½åœ¨å‹•ç›ªä¸­ä¿æŒå¹³éœã€‚",
            "ç´¯äº†ï¼Œèªªæ˜åˆåœ¨ä¸Šå¡è·¯ä¸Šäº†ã€‚\né›£äº†ï¼Œèªªæ˜æˆ‘å€‘åœ¨é€²æ­¥ã€‚",
            "åœ¨æ²’æœ‰äººåœ¨æ„çš„åœ°æ–¹\nåœ¨èšå…‰ç‡ˆä¸‹å‡ºç¾ã€‚",
            "ç©å¾—é–‹å¿ƒ\nå»ä¹Ÿæ‚²å‚·ã€‚",
            "é•·å¤§\næ˜¯äººå¿…é ˆç¶“æ­·çš„ä¸€å ´è…çˆ›ã€‚",
            "å¿˜è¨˜æ˜¯ä¸€å€‹éƒ¨åˆ†çš„è¤‡æ•¸è©\næˆ‘é¨™è‡ªå·±å¿˜äº†ï¼Œä½†å…¶å¯¦é‚„è¨˜å¾—ã€‚",
            "ä¸çŸ¥é“æˆ‘è¦å»å“ªè£¡\nä½†æˆ‘å·²ç¶“åœ¨è·¯ä¸Šäº†ã€‚",
            "å³ä½¿å¤§å®¶éƒ½ä¸æ”¾åœ¨å¿ƒä¸Š\næˆ‘é‚„æ˜¯æˆ‘ã€‚",
            "é›²æƒ³è¡£è£³èŠ±æƒ³å®¹\næ˜¥é¢¨æ‹‚æª»éœ²è¯æ¿ƒã€‚",
            "ä½ åœ¨æ„ä»€éº¼\nä»€éº¼å°±æœƒæŠ˜ç£¨ä½ ã€‚",
            "æ²’æœ‰äººä¸åœ¨åŠªåŠ›\nåªæ˜¯æ²’å–Šå‡ºç—›è‹¦ã€‚",
            "æœ‰å¥½çš„å¿ƒæ…‹\næ‰èƒ½æœ‰å¥½çš„ç‹€æ…‹ã€‚",
            "ä¸€åˆ‡éƒ½æœƒçµæŸ\næˆ‘çš„ç…©æƒ±ç„¡ç›¡ã€‚",
            "æœ€é»‘æš—çš„æ™‚åˆ»\nç¸½æœƒæœ‰ä¸€çµ²å…‰äº®ã€‚",
            "æ“ºè„«ä¸å¿…è¦çš„å…§ç–š\nä¸è¦å§”å±ˆè‡ªå·±å»è¨å¥½åˆ¥äººã€‚",
            "æ¥å—è‡ªå·±æ¯å€‹éšæ®µçš„æ¨£å­\nåŠªåŠ›èˆ‡è‡ªå·±å’Œè§£ã€‚",
            "åŠªåŠ›æˆç‚ºå€¼å¾—è¢«æ„›çš„äºº\nè€Œä¸æ˜¯å¼·è¿«åˆ¥äººæ„›ä¸Šè‡ªå·±ç³Ÿç³•çš„ä¸€é¢ã€‚",
            "è¨±å¤šäº‹æƒ…éƒ½æ˜¯å€‹äººé¸æ“‡\nä½ å¿…é ˆå–œæ­¡é‚£å€‹åšå‡ºé¸æ“‡çš„è‡ªå·±ã€‚",
            "çŸ¥é“ä½ ä¸å®Œç¾\næ¥å—ä½ ä¸å®Œç¾ã€‚",
            "æ‰¾ä¸åˆ°è¦èµ°çš„è·¯\né‚£å°±å…ˆèµ°çœ¼å‰çš„è·¯å§ã€‚",
            "ä½ ä¸¦ä¸ç¼ºä¹æ­£èƒ½é‡\nåªæ€•è‡ªå·±ä¸å¤ å¼·å¤§ã€‚",
            "èµ°å¾—æ…¢æ²’é—œä¿‚\nåªè¦ä½ ä¸åœä¸‹ä¾†ã€‚",
            "ä¸è¦è®“ç•¶å‰çš„éºæ†¾\næˆç‚ºæœªä¾†ç”Ÿæ´»çš„å˜†æ¯ã€‚",
            "æˆ‘æ˜¯éš»çƒé¾œ\næˆ‘ä¸æƒ³æ‰“æ•—å…”å­ï¼Œæˆ‘åªæƒ³å–œæ­¡æˆ‘è‡ªå·±ã€‚",
            "è¢«å¿½è¦–çš„æ„Ÿè¦º\nçœŸçš„å¾ˆé›£å—ã€‚",
            "æ²’æœ‰äººæœƒç„¡ç·£ç„¡æ•…æ¶ˆå¤±\nåªæœ‰ä¸æƒ³è¯ç¹«çš„äººã€‚",
            "ç•¶ç”Ÿæ´»éƒ½æ˜¯ä¸Šå¡è·¯çš„æ™‚å€™\né‚£æ‰æœƒé€™éº¼åƒåŠ›ã€‚",
            "å³ä½¿èµ°å¾—è¹£è·š\nä¹Ÿè¦åŠªåŠ›å‰è¡Œã€‚",
            "åšè‡ªå·±\nä¹Ÿå¯ä»¥æ´»å¾—å¾ˆç²¾å½©ã€‚",
            "å¥½å¥½æ´»è‘—ï¼Œå¥½å¥½å‘Šåˆ¥\né‚£å°±æ˜¯å¹¸ç¦ã€‚",
            "å¦‚æœæ˜å¤©é‚„åœ¨\nä»Šå¤©æˆ‘å€‘èƒ½ä¸èƒ½é‡æ–°é–‹å§‹ï¼Ÿ",
            "ç•¶ä½ åšè‡ªå·±çš„æ™‚å€™\nçœŸçš„ä¸æ‡‰è©²æœŸå¾…è¢«å–œæ­¡ã€‚",
            "ä¸æ˜¯çœŸçš„æƒ³æ­»\nåªæ˜¯ä¸çŸ¥é“å¦‚ä½•æ´»ä¸‹å»ã€‚",
            "åšè‡ªå·±\nå› ç‚ºåˆ¥äººå·²ç¶“è¢«åšéäº†ã€‚",
            "å¤šä¸€åˆ†\nå°±æ˜¯å¤šä¸€åˆ†ã€‚",
            "ä¸è¦è¸®èµ·è…³å°–å»æ„›\né€™åªæœƒè®“ç‹—åƒå±ã€‚",
            "èˆ‡ä½ ç„¡é—œçš„äº‹\nå»æ˜¯åˆ¥äººä¸€ç”Ÿçš„ç—›è‹¦ã€‚",
            "ç•¶ä½ é¸æ“‡é€™æ¢è·¯\nå¦ä¸€æ¢è·¯ä¸Šçš„é¢¨æ™¯å°±èˆ‡ä½ ç„¡é—œäº†ã€‚",
            "æ‰€è¬‚ä½èª¿\nå°±æ˜¯ä¸éœ²ç—•è·¡çš„é«˜èª¿ã€‚",
            "æ¥å—è‡ªå·±å¹³å‡¡çš„æ¨£å­\nç„¶å¾Œç›¡åŠ›åšåˆ°ä¸ä¸€æ¨£ã€‚",
            "å¹¸ç¦ä¸æ˜¯ç¾¨æ…•åˆ¥äºº\nè€Œæ˜¯æ´»å¾—åƒè‡ªå·±ã€‚",
            "æ”¾æ‰‹å§\nä¸è¦å†åŸ·è‘—äº†ã€‚",
            "ä¸è¦å®³æ€•å‰æ–¹çš„é»‘æš—\nä½ æ­£åœ¨æ•£ç™¼å…‰èŠ’ã€‚",
            "æ­£ç¾©æˆ–è¨±æœƒé²åˆ°\nä½†æ°¸ä¸ç¼ºå¸­ã€‚",
            "é›–ç„¶ä»Šå¤©çš„åŠªåŠ›å¾ˆè‰±è¾›ï¼Œ\nä½†é‚£äº›éƒ½æ˜¯ä¾†è‡ªæœªä¾†çš„ç¦®ç‰©ã€‚",
            "ä½ åªæœƒå¹´è¼•ä¸€æ¬¡\nå»äº«å—ä½ çš„é’æ˜¥å§ã€‚",
            "ç”Ÿå‘½å°±æ˜¯ä¸æ–·é‡è¦‹\nåˆä¸æ–·åˆ†åˆ¥çš„éç¨‹",
            "æ™‚é–“æ¯”çœ¼ç›\næ›´èƒ½çœ‹æ¸…ä¸€äº›æ±è¥¿",
            "é†’ä¾†\næ–¹çŸ¥æ˜¯å¤¢",
            "è·¯ä¸Šç¸½æœ‰é™°å½±\nä½†æŠ¬é ­ç¸½èƒ½è¦‹å…‰",
            "æœ‰å¿ƒè€…æœ‰æ‰€ç´¯\nç„¡å¿ƒè€…ç„¡æ‰€è¬‚",
            "ä¸è¦é¨™è‡ªå·±åŠªåŠ›éäº†\nå°±æœƒé•·å‡ºç¿…è†€",
            "è‡ªæˆ‘æ„Ÿå‹•çš„ä»˜å‡º \næ—¢å±éšªåˆæ„šè ¢",
            "ç››ä¸ç››é–‹ \nèŠ±éƒ½æ˜¯èŠ±",
            "æ—¢ç„¶å»ä¸äº†é æ–¹\nå°±æ„Ÿå—æ²¿è·¯çš„é¢¨æ™¯",
            "å»å¹å¹é¢¨å§\nèƒ½æ¸…é†’ï¼Œæ„Ÿå†’ä¹Ÿæ²’é—œä¿‚",
            "äººç”Ÿæ˜¯ç”¨ä¾†é«”é©—çš„\nä¸æ˜¯ç”¨ä¾†æ¼”ç¹¹å®Œç¾çš„",
            "åŠ æ²¹ä¸è¦æ”¾æ£„ \nç¾åœ¨å®³æ€•æ˜¯å› ç‚ºæ²’æœ‰åšå¥½",
            "åˆ¥å°è‡ªå·±å¤±æœ›\nä½ åªæ˜¯å¤ªæƒ³æŠŠäº‹æƒ…åšå¥½",
            "ç´¯äº†å°±æ…¢æ…¢èµ°\nå¶çˆ¾åœä¸‹ä¾†æ²’é—œä¿‚",
            "éƒ½è¦é«˜è™•ç›¸è¦‹\næµ·è£¡çš„ç¾æ€éº¼åƒè§€",
            "å¸Œæœ›ä½ åˆ¥æœ‰å£“åŠ›\näººç”Ÿä¸æ˜¯ç«¶æŠ€",
            "æ²’æœ‰äº‹äº‹å¦‚æ„\nåªèƒ½é †å…¶å¿ƒæ„",
            "å¤§å¤šæ²’æœ‰æ­£ç¢ºç­”æ¡ˆ\nåªæœ‰é©åˆè‡ªå·±çš„è§£ç­”",
            "çµ¦è‡ªå·±ä¸€å°ç¿…è†€\nå¼·è¿«è‡ªå·±å­¸æœƒé£›ç¿”",
            "æˆ‘æ˜¯å¤§æµ·\nèˆ‡æ³¢æ¿¤å…±å­˜",
            "å¥½å¥½è¨˜å¾— \nè‡ªå·±åŠªåŠ›æ™‚çš„æ¨£å­",
            "ä¸æ‰“é–‹çš„é–‹é–€\nå†æ•²å°±ä¸ç¦®è²Œäº†",
            "å·²æ­¡å–œä¹‹å¿ƒ\nåº¦å¹³æ—¥ä¹‹æ—¥",
            "å…ˆåŠªåŠ›å„ªç§€\nå†å¤§æ–¹æ“æœ‰",
            "æ™‚é–“ä¾†ä¸åŠç´°ç®—\néå¾€ä¾†ä¸åŠæƒ³çœ‹",
            "ä¸ç”¨å¾ˆå²å®³æ‰é–‹å§‹\nè¦å…ˆé–‹å§‹æ‰æœƒå¾ˆå²å®³",
            "æ®ºä¸æ­»ä½ çš„\nçµ‚æœƒä½¿ä½ å¼·å¤§",
            "éºæ†¾çš„åé¢ä¸æ˜¯å®Œç¾\nè€Œæ˜¯æ‡‚å¾—æ”¾ä¸‹",
            "é€™å€‹ä¸–ç•Œä¸ç¾å¥½\nä½†ç¸½æœ‰äººå®ˆè­·è‘—ä½ ",
            "åè¦‹\næ˜¯ç„¡æ³•åƒ­è¶Šçš„é«˜ç‰†",
            "ç”Ÿæ´»éœ€è¦ç…™ç«\nä¹Ÿéœ€è¦éœéœçš„ç¾å¥½",
            "é€™å€‹ä¸–ç•Œæœ¬ä¾†å°±ä¸å¥½\nä½†ï¼Œä½ è¦è¨˜å¾—ï¼Œä½ å¾ˆå¥½",
            "æœ‰äº›ç…©æƒ±ï¼Œä¸Ÿæ‰äº†\næ‰æœ‰é›²æ·¡é¢¨è¼•çš„æ©Ÿæœƒ",
            "å¦‚æœæ²’æœ‰èººè´çš„å‘½\né‚£å°±ç«™èµ·ä¾†å¥”è·‘å§",
            "æ¯å¤©éƒ½åœ¨å­¸ç¿’æ”¾æ‰‹\næ´»åœ¨ç•¶ä¸‹å°±åˆ¥å®³æ€•å¤±å»",
            "è¬èˆ¬çš†æ˜¯å‘½\nåŠé»ä¸ç”±äºº",
            "é¢¨é›¨äººç”Ÿ\nçµ¦è‡ªå·±ä¸€å€‹å¾®ç¬‘",
            "å³ä¾¿å¾ˆå …å¼·\nä¹Ÿä¸ä»£è¡¨ä¸æœƒå—å‚·",
            "æ’­ç¨®ç¾å¥½å¸Œæœ›\næ”¶ç©«å¹¸ç¦æ™‚å…‰",
            "æ²’æœ‰æœŸå¾…çš„æ—¥å­\nåè€Œé †é †åˆ©åˆ©",
            "å­¸æœƒç™¼ç¾è‡ªå·±çš„å¥½\nåˆ¥æŠŠé‡è¦çš„è‡ªå·±ç•¶ä½œéš±å½¢äºº",
            "å¤§éƒ¨åˆ†çš„äººä¸æœƒæ„Ÿè¬ä½ çš„å–„è‰¯\né™¤äº†å¾—å¯¸é€²å°ºé‚„æ˜¯å¾—å¯¸é€²å°º",
            "æ´»æˆä¸€åº§å­¤å³¶\nä¹Ÿè¦æœ‰å±¬æ–¼è‡ªå·±çš„ç¾å¥½",
            "æ²’å¿…è¦é«”è«’æ‰€æœ‰äºº\næœ‰äº›äººä¹Ÿä¸æœƒé«”è«’ä½ ",
            "äººç”Ÿæ²’æœ‰ç™½èµ°çš„è·¯\næ¯ä¸€æ­¥éƒ½ç®—æ•¸",
            "æ²’æœ‰éä¸å»çš„å\nåªæœ‰è½‰ä¸éçš„å¿µ",
            "å¦‚æœå…”å­éƒ½æ‹¼å‘½å¥”è·‘ \nçƒé¾œè©²æ€éº¼è¾¦ï¼Ÿ",
            "ä¸èƒ½èˆ‡ä¹‹ç‚ºæ•µ\nä¾¿èˆ‡ä¹‹ç‚ºä¼",
            "æœ‰æ™‚å¾Œä¹Ÿæƒ³å•\næ˜¯ä¸æ˜¯é€™æ¨£å°±å¥½",
            "æ²’ä»€éº¼å¥½å¾Œæ‚”çš„\nå³ä½¿å¯ä»¥å†ä¾†ä¸€æ¬¡",
            "ä½ åœä¸‹è…³æ­¥çš„æ™‚å€™\nä¸–ç•Œä¸¦ä¸æœƒåœä¸‹ä¾†ç­‰ä½ ",
            "ç¾åœ¨çš„å …æŒ\næ˜¯ç‚ºäº†è®“æœªä¾†æœ‰æ›´å¤šé¸æ“‡",
            "ä¸ç”¨å¤ªèªçœŸçš„æ´»è‘—\nå°å¾—èµ·è‡ªå·±å°±å¥½",
            "å¯§å¯è®“äººè¨å­çœŸå¯¦çš„ä½ \nä¹Ÿå¥½éè®“åˆ¥äººæ„›ä¸Šè™›å½çš„è‡ªå·±",
            "æ¡åœ¨æ‰‹è£¡çš„é¢¨ç®\nä¹Ÿæœƒçªç„¶æ–·äº†ç·š",
            "ä½ æ‰€ç¶“æ­·çš„ä¸€åˆ‡\néƒ½æœƒéå»",
            "ç…§é¡§å¥½è‡ªå·±\næ‰æ˜¯æœ€è² è²¬ä»»çš„ç”Ÿæ´»æ–¹å¼",
            "å­¸æœƒè‡ªå˜²\næˆ‘å€‘éƒ½ä¸å®Œç¾",
            "èµ·å¾—æ™š\nå°±è¦æ›´åŠªåŠ›",
            "åˆ¥åœ¨æ©Ÿå ´ç­‰èˆ¹\nåªæœƒç­‰åˆ°å¾—å¯¸é€²å°º",
            "å¯§è‚¯å¤©çœŸçš„å“­\nä¹Ÿä¸é¡˜ç„¡æ¥çš„ç¬‘",
            "æ—¢ç„¶æ”¾ä¸ä¸‹\nå°±å…ˆæ“±è‘—å§",
            "æ€å¿µçš„è²éŸ³å¾ˆè¼•\nä½†æˆ‘å€‘éƒ½è½å¾—åˆ°",
            "é›–ç„¶äººç”Ÿå……æ»¿éºæ†¾\nä½†ä¹Ÿå› æ­¤æ›´ç¾å¥½",
            "äººç”Ÿé›£é¡Œä¸€å†å‡ºç¾\néƒ½æ˜¯ç‚ºäº†è€ƒé©—ä½ æœ‰æ²’æœ‰æ”¹è®Š",
            "ä¸é¡˜æ„ç¨®èŠ±\næ˜¯ä¸é¡˜æ„çœ‹åˆ°ä»–å‡‹é›¶",
            "å–œæ˜¯åˆè¦‹æ­¡\næ„›æ˜¯ä¹…ä¸å­",
            "æƒ³æ”¹è®Š\nä»€éº¼æ™‚å€™éƒ½ä¸æ™š",
            "ä¸è¦è¦ºå¾—è·¯é€”é™é \nå›é ­éƒ½æ˜¯ä½ å …æŒçš„è¶³è·¡",
            "æ—©é¤åº—æ²’æœ‰è³£æ™šä¸Šçš„\næƒ³è²·çš„äººï¼Œæ—©ä¸Šå°±ä¾†äº†",
            "æ”¾å¹³å¿ƒæ…‹ å·å·å²å®³\nè¬äº‹ç›¡å¯æœŸå¾…",
            "æœ‰ä¸€ç¨®è°æ˜ å«åšå‚»\næœ‰ä¸€ç¨®å‚» å«è‡ªä½œè°æ˜",
            "æœ€å¥½çš„è²´äºº\nå°±æ˜¯åŠªåŠ›çš„è‡ªå·±",
            "å·§å…‹åŠ›è®Šå·§å…‹åŠ›ä¹‹å‰\néƒ½æ˜¯è‹¦çš„",
            "æ²’æœ‰ç†±å¿±\nä¸–é–“ä¾¿ç„¡é€²æ­¥",
            "æ²’æœ‰äººèƒ½ç¨è‡ªå …å¼·\næˆ‘å€‘éƒ½è¦å¹«åŠ©æ‰€æ„›çš„äºº",
            "ä½ æˆç‚ºä»€éº¼\nå°±æœƒå¸å¼•ä»€éº¼",
            "ç•¶ä½ æ‰¾åˆ°è‡ªå·±\nå…¨ä¸–ç•Œéƒ½æœƒä¾†æ„›ä½ ",
            "åªè¦ä½ é¡˜æ„åŠªåŠ›\næœ€å£çš„çµæœä¹Ÿåªæ˜¯å¤§å™¨æ™šæˆ",
            "å¦‚æœä½ æƒ³æ”€ç™»é«˜å³°\nåˆ¥æŠŠå½©è™¹ç•¶ä½œéšæ¢¯ï¼Œæœƒæ‘”æ­»",
            "æŠŠç°¡å–®å¼„è¤‡é›œæ˜¯æ‰¾éº»ç…©\næŠŠè¤‡é›œå¼„ç°¡å–®æ‰æ˜¯æœ¬äº‹",
            "ç¨ç«‹çš„éç¨‹å¾ˆè¾›è‹¦  ä½†èµ°éé€™æ®µè·¯\nç²å¾—çš„æ±è¥¿ä¹Ÿä¸€å®šæ¯”åˆ¥äººå¤š",
            "äººç”Ÿè·¯ä¸Šæ­»ä¸äº†äººçš„ï¼Œ\néƒ½æ˜¯æ“¦å‚·ã€‚",
            "é–‹å§‹è¿·èŒ«çš„æ™‚å€™ä¸è¦é€ƒé¿\né‚£æ˜¯è§£æ±ºéº»ç…©çš„é–‹å§‹",
            "æ²’å¿…è¦å»åšç¬¬ä¸€\nä½†å¿…é ˆå»åšå”¯ä¸€",
            "è®“æœ‹å‹ä½ä¼°ä½ çš„å„ªé»\nè®“æ•µäººé«˜ä¼°ä½ çš„ç¼ºé»",
            "æˆ‘æœ›è‘—è‡ªå·±ä¼¸å‡ºçš„æ‰‹\nç–‘æƒ‘èƒ½æˆç‚ºèª°çš„æ•‘è´–",
            "ç·´ç¿’è‡ªå·±çš„å¿«æ¨‚\nä¸è¦è·Ÿåˆ¥äººæ¯”è¼ƒ",
            "å¦‚æœæ²’è¦‹éå¤ªé™½\næˆ‘æœ¬å¯ä»¥å¿å—é»‘æš—",
            "å“­ä¸æ˜¯å …å¼·\nå¿ä½ä¸å“­æ‰æ˜¯æˆé•·",
            "åšå°çš„äº‹æƒ…\næ¯”æŠŠäº‹æƒ…åšå°æ›´é‡è¦",
            "å±¬æ–¼ä½ çš„å°±çæƒœ\nä¸æ˜¯ä½ çš„å°±åˆ¥è¦",
            "ä¸€å€‹ä¸äº†è§£è‡ªå·±çš„äºº\nå¾ˆé›£å¾—åˆ°è‡ªå·±æƒ³è¦çš„æ±è¥¿",
            "ç…½å‹•çš„è©±èªå¿…å®šå¥½è½\nèª£è¡Šçš„èªè¨€å¿…èƒ½æˆé•·",
            "æˆç‚ºè‡ªå·±å–œæ­¡çš„æ¨£å­å§ï¼\nä¸è¦æ”¾æ£„éå¾€çš„åŠªåŠ›ã€‚",
            "è¨‚å€‹ç›®æ¨™\nå‘Šè¨´è‡ªå·±èƒ½è¡Œçš„",
            "æœªç›¡å…¨åŠ›ï¼Œ\né™¤äº†è‡ªå·±åˆèƒ½æ€ªèª°ï¼Ÿ",
            "æ‰€æœ‰çœ‹ä¼¼ç¾å¥½çš„\néƒ½ç¶“æ­·éæˆ–è€…æ­£åœ¨ç¶“æ­·è‘—ä¸ç¾å¥½ã€‚",
            "ä¸æ˜¯æ‰€æœ‰ç¢ç‰‡éƒ½èƒ½æ‹¼æ¹Š\nå°±åƒé‚£äº›æ˜¨å¤©ç„¡æ³•é‡æ–°æ“æœ‰",
            "æƒ³å¿µé›¢æˆ‘å¦‚æ­¤ä¹‹è¿‘\næ‰ç™¼ç¾ä½ å¤šé™ä¸å¯åŠ",
            "ä½ è¦çµ¦åœ¨ èº«é‚Šçš„äººæ©Ÿæœƒ\nä»–å€‘æ‰æœƒå‘Šè¨´ä½ ï¼Œä½ å€¼å¾—",
            "æº«å©‰çš„æ†æ†«ä¾†æ•²é–€\nå†åšçš„éµé–€ä¹Ÿç¸½æœƒæ‰“é–‹",
            "ç¾å¯¦ä¸­å£äººä¸æœƒæ˜¯å·«å©†æ¨£\nå¥½äººä¹Ÿä¸æœƒå¯«åœ¨è‡‰ä¸Š",
            "ä½ ä¸ç”¨å°é€™å€‹ä¸–ç•Œå¤ªæ²®å–ª\nå› ç‚ºä½ ä¸€å®šä¹Ÿæ›¾ç¶“å‚·å®³éä¸€äº›äºº",
            "è´ä¸ä¸€å®šæœ‰é“ç†\nè¼¸è‚¯å®šæœ‰åŸå› ",
            "å“ªæœ‰ä»€éº¼è¼•æ˜“å¾—åˆ°çš„å¹¸é‹\nå¹¸é‹åªæ˜¯çµæœè€Œå·²",
            "ä½ ç›¸ä¿¡ä»€éº¼\nå°±æœƒæœå‘ä»€éº¼",
            "ç‚ºäº†èå…¥ç¤¾æœƒä¸å¾—ä¸å½è£è‡ªå·±\nå•è‡ªå·±ï¼Œæœ‰å¿…è¦å—ï¼Ÿ",
            "å¯ï¼Œå› ç‚ºä¿¡å¿µ\nä¸å¯ï¼Œå› ç‚ºä¿¡ä»°",
            "ä¸è¦æ†æ¨æ•µäºº\né‚£æœƒå½±éŸ¿ä½ çš„åˆ¤æ–·èƒ½åŠ›",
            "ææ‡¼ï¼Œæ˜¯çœ‹è¦‹ä½ ä¸ç›¸ä¿¡çš„\nä¿¡å¿µï¼Œæ˜¯ç›¸ä¿¡ä½ çœ‹ä¸è¦‹çš„",
            "ç”Ÿæ´»ä¹Ÿè¨±å¾ˆè‹¦\nä½†ä»–ä¸¦ä¸æœƒæ”¾æ£„ä½ ",
            "ä¸è¦å®ˆç€é‚£ä»½å§”å±ˆ\nå±¬æ–¼ä½ çš„å…‰èŠ’çµ‚æœƒç‚ºä½ ç¶»æ”¾",
            "I like you\nbut just like you",
            "éä¸äº†é«˜ç‰†\nçœ‹ä¸åˆ°é æ–¹",
            "è‡ªå·±ä¸å …å¼·\nå¼±çµ¦èª°çœ‹",
            "ç²¾åŠ›å¥½çš„äºº\næœƒé›†ä¸­èƒ½é‡åšé‡è¦çš„äº‹",
            "é€†æ°´è¡ŒèˆŸ\nä¸é€²å‰‡é€€",
            "ä½ ä¸éœ€è¦å¾ˆå²å®³æ‰èƒ½é–‹å§‹\nä½ éœ€è¦é–‹å§‹æ‰èƒ½å¾ˆå²å®³",
            "åªæœ‰é–‹å§‹ï¼Œ\næ‰æœ‰æ•…äº‹ã€‚",
            "å”¯æœ‰åšæ€æƒ³çš„æ—è§€è€…\næ‰èƒ½çœ‹æ¸…è‡ªå·±ã€‚",
            "ç‚ºå¼·è€…  ç©äºå¼±\næœ‰ä½™è€… ç©äºä¸è¶³",
            "è¿·è·¯çš„æ™‚å€™æ”¾ä¸‹è‡ªå°Šèˆ‡é¢å­\næ˜¯è‡ªæˆ‘æˆé•·çš„ç¬¬ä¸€æ­¥",
            "ä¸–ç•Œæ˜¯ä½ è‡ªå·±çš„\nèˆ‡ä»–äººæ¯«ç„¡é—œä¿‚",
            "å›é ­çœ‹è‡ªå·±èµ°éçš„è·¯æ‰é–‹å§‹å¾Œæ‚”\nå¾Œæ‚”æ²’èƒ½æ´»æˆè‡ªå·±æƒ³è¦çš„æ¨£å­",
            "ä¸èƒ½æ”¹è®Šæœªä¾†ï¼Œå°±æ”¹è®Šç•¶ä¸‹\nå”¯æœ‰æ”¹è®Šï¼Œæœªä¾†çš„è·¯æ‰èƒ½è¶Šæ¼¸ä¸åŒ",
            "æ¯å€‹äººéƒ½å¸Œæœ›å–„æƒ¡æœ‰å ±\nä½†æ²’äººæƒ³è¦å¼„é«’è‡ªå·±çš„æ‰‹ï¼Œäººé–“ã€‚",
            "ä½ å¿…é ˆæ‰¾åˆ°ä½ æ‰€æ„›çš„æ±è¥¿\nä¸åƒ…æ˜¯å·¥ä½œã€æˆ€æ„›ï¼Œäº¦æ˜¯ç”Ÿæ´»",
            "è™•ç„¡ç‚ºä¹‹äº‹\nè¡Œä¸è¨€ä¹‹æ•™",
            "å°è‡ªå·±å¥½ä¸€é»\né‚£æ˜¯æœƒè·Ÿä½ æœ€ä¹…çš„äºº",
            "é€™äººé–“çœŸçš„ä¸å€¼å¾—\nä½†ä½   è¶…å€¼å¾—ã€‚",
            "çŸ¥é“å’Œåšåˆ°æ˜¯å…©ç¢¼äº‹\nåˆ¥ç¸½æ˜¯æ•·è¡è‘—å›ç­”ä¾†æ©è—è‡ªå·±çš„ç„¡èƒ½",
            "ä½ ç¾åœ¨ç„¦æ…®çš„äº‹æƒ…\nå¾Œä¾†ä¸€ä»¶éƒ½æ²’æœ‰ç™¼ç”Ÿï¼Œå‘Šè¨´æœªä¾†çš„æˆ‘",
            "ä¸–ç•Œä¹‹å¤§ ä½•å¾è™•\nä¸–ç•Œä¸å° ä½•è‹¦å¾",
            "æ—¥å­è‹¦äº†\né€£é»‘å’–å•¡æœ‰é»æ˜¯ç”œçš„",
            "è‹±é›„è·¯éæ™‚ç¸½æœƒæœ‰äººæ‹æ‰‹\næˆ‘åªæƒ³ç•¶é‚£å€‹æ‹æ‰‹çš„äººï¼Œä¸æƒ³ç•¶è‹±é›„",
            "ä½ çš„ç”Ÿæ´»ï¼Œéœ€è¦é»å„€å¼æ„Ÿ\nå¯ä»¥å¾ˆè¬›ç©¶ä¹Ÿå¯ä»¥å¾ˆéš¨ä¾¿ã€‚",
            "è¦æ‡‚å¾—çŸ¥è€Œä¸è¨€\nå› ç‚ºè¨€å¤šå¿…å¤±",
            "ç›¡æƒ…ç”Ÿæ´»\nåšéçš„æ¯ä»¶äº‹æƒ…éƒ½åˆ¥å¾Œæ‚”",
            "å¦‚æœä½ æ²’æœ‰å®Œç¾çš„äººç”Ÿ\né‚£å°±è‡ªå·±å‰µé€ å§",
            "åšå¥½ç•¶å‰é»æ»´ å­¸æœƒå­¸ç¿’\nç›¸ä¿¡äººé–“çœŸå–„ç¾",
            "äººç”Ÿç¸½æœƒé‡åˆ°è¨±å¤šå•é¡Œ\nå¦‚æœåªæœƒæŠ±æ€¨ï¼Œé‚£é‚„çœŸæ˜¯å»¢ç‰©ã€‚",
            "ç”Ÿæ´»æ˜¯é¢é¡å­\nä½ å°ä»–ç¬‘ï¼Œä»–ä¾¿ç¬‘ã€‚ ä½ å“­ï¼Œä»–å“­ã€‚",
            "å†æ€éº¼ä¸é–‹å¿ƒï¼Œç§’é‡é‚„æ˜¯å†èµ°\näººç”Ÿè¦è·Ÿæ™‚é–“è³½è·‘ï¼Œåˆ¥é¬§è„¾æ°£ã€‚"
        ];
        }

        // ä¿å­˜èªéŒ„åˆ—è¡¨åˆ° localStorage
        function saveDailyQuotesList(quotes) {
            localStorage.setItem('dailyQuotes_list', JSON.stringify(quotes));
        }

        // ç²å–èªéŒ„åˆ—è¡¨ï¼ˆå¾ quotes-data.html è¼‰å…¥ï¼‰
        async function getDailyQuotes() {
            if (!dailyQuotesLoaded) {
                await loadQuotesFromFile();
            }
            return dailyQuotesData;
        }

        // ç”¨æ–¼å…¼å®¹çš„è®Šæ•¸ï¼ˆæœƒåœ¨è¼‰å…¥å¾Œæ›´æ–°ï¼‰
        let dailyQuotes = [];

        // è§£é–ç‹€æ…‹ç®¡ç†
        let unlockModalDateKey = null;
        let unlockModalDate = null;
        let geminiApiKey = localStorage.getItem('geminiApiKey') || '';

        // è¼‰å…¥è§£é–è¨˜éŒ„
        function loadUnlockedDates() {
            const key = `unlockedDates_${currentUserId}`;
            return JSON.parse(localStorage.getItem(key) || '[]');
        }

        // ä¿å­˜è§£é–è¨˜éŒ„
        function saveUnlockedDates(dates) {
            const key = `unlockedDates_${currentUserId}`;
            localStorage.setItem(key, JSON.stringify(dates));
        }

        // åˆ‡æ›é–‹ç™¼è€…æ¨¡å¼
        function toggleDeveloperMode() {
            developerMode = !developerMode;
            localStorage.setItem('developerMode', developerMode.toString());
            updateDeveloperModeIndicator();
            // æ›´æ–°é‡ç½®æŒ‰éˆ•é¡¯ç¤ºç‹€æ…‹
            updateResetButtonVisibility();
            // é‡æ–°æ¸²æŸ“æœˆæ›†ä»¥é¡¯ç¤º/éš±è—å¿«é€Ÿæ‰“å¡æŒ‰éˆ•
            renderCalendar();
            renderDailyQuote().catch(err => console.error('æ¸²æŸ“èªéŒ„å¤±æ•—:', err)); // é‡æ–°æ¸²æŸ“èªéŒ„é¡¯ç¤º
            alert(developerMode ? 'âœ… é–‹ç™¼è€…æ¨¡å¼å·²é–‹å•Ÿï¼\nç¾åœ¨å¯ä»¥ç›´æ¥æ‰“å¡ä»»ä½•æ—¥æœŸã€‚\né»æ“Šæœˆæ›†ä¸Šæ—¥æœŸå³ä¸Šè§’çš„âœ“æŒ‰éˆ•å³å¯å¿«é€Ÿæ‰“å¡ã€‚' : 'âœ… é–‹ç™¼è€…æ¨¡å¼å·²é—œé–‰ã€‚');
        }

        // æ›´æ–°é–‹ç™¼è€…æ¨¡å¼æŒ‡ç¤ºå™¨
        function updateDeveloperModeIndicator() {
            const indicator = document.getElementById('devModeIndicator');
            if (indicator) {
                if (developerMode) {
                    indicator.classList.remove('hidden');
                } else {
                    indicator.classList.add('hidden');
                }
            }
        }

        // æ›´æ–°é‡ç½®æŒ‰éˆ•å’ŒèªéŒ„è¨­å®šæŒ‰éˆ•çš„é¡¯ç¤ºç‹€æ…‹
        function updateResetButtonVisibility() {
            const resetBtn = document.getElementById('resetButton');
            const settingsResetBtn = document.getElementById('settingsResetButton');
            const settingsResetBtnTop = document.getElementById('settingsResetButtonTop');
            const quotesManagerBtn = document.getElementById('quotesManagerButton');
            const quotesManagerBtnTop = document.getElementById('quotesManagerButtonTop');
            
            if (resetBtn) {
                if (developerMode) {
                    resetBtn.classList.remove('hidden');
                } else {
                    resetBtn.classList.add('hidden');
                }
            }
            if (settingsResetBtn) {
                if (developerMode) {
                    settingsResetBtn.classList.remove('hidden');
                } else {
                    settingsResetBtn.classList.add('hidden');
                }
            }
            if (settingsResetBtnTop) {
                if (developerMode) {
                    settingsResetBtnTop.classList.remove('hidden');
                } else {
                    settingsResetBtnTop.classList.add('hidden');
                }
            }
            if (quotesManagerBtn) {
                if (developerMode) {
                    quotesManagerBtn.classList.remove('hidden');
                } else {
                    quotesManagerBtn.classList.add('hidden');
                }
            }
            if (quotesManagerBtnTop) {
                if (developerMode) {
                    quotesManagerBtnTop.classList.remove('hidden');
                } else {
                    quotesManagerBtnTop.classList.add('hidden');
                }
            }
            }
        }

        // æª¢æŸ¥æ—¥æœŸæ˜¯å¦å·²è§£é–ï¼ˆé–‹ç™¼è€…æ¨¡å¼ä¸‹ç¸½æ˜¯è¿”å› trueï¼‰
        function checkDateUnlocked(dateKey) {
            if (developerMode) return true; // é–‹ç™¼è€…æ¨¡å¼ä¸‹ç¸½æ˜¯å·²è§£é–
            const unlockedDates = loadUnlockedDates();
            return unlockedDates.includes(dateKey);
        }

        // è§£é–æ—¥æœŸ
        function unlockDate(dateKey) {
            const unlockedDates = loadUnlockedDates();
            if (!unlockedDates.includes(dateKey)) {
                unlockedDates.push(dateKey);
                saveUnlockedDates(unlockedDates);
            }
        }

        // æ‰“é–‹è§£é–å½ˆçª—
        function openUnlockModal(dateKey, date) {
            unlockModalDateKey = dateKey;
            unlockModalDate = date;
            document.getElementById('unlockDateModal').classList.remove('hidden');
            document.getElementById('unlockDateInput').value = '';
            document.getElementById('unlockDateInput').focus();
            document.getElementById('unlockErrorMsg').classList.add('hidden');
        }

        // é—œé–‰è§£é–å½ˆçª—
        function closeUnlockModal() {
            document.getElementById('unlockDateModal').classList.add('hidden');
            unlockModalDateKey = null;
            unlockModalDate = null;
        }

        // æ‰‹æ©Ÿæ¨¡å¼ï¼šæ‰“é–‹ä»Šå¤©çš„è§£é–å½ˆçª—
        function openUnlockModalForToday() {
            const todayKey = getTodayKey();
            const today = new Date();
            openUnlockModal(todayKey, today);
        }

        // ç¢ºèªè§£é–æ—¥æœŸ
        function confirmUnlockDate() {
            const input = document.getElementById('unlockDateInput');
            const inputValue = input.value.trim();
            const errorMsg = document.getElementById('unlockErrorMsg');

            // é–‹ç™¼è€…æ¨¡å¼ä¸‹å¯ä»¥è§£é–ä»»ä½•æ—¥æœŸï¼Œå¦å‰‡åªèƒ½è§£é–ç•¶å¤©
            if (!developerMode) {
            const todayKey = getTodayKey();
            if (unlockModalDateKey !== todayKey) {
                errorMsg.textContent = 'åªèƒ½è§£é–ç•¶å¤©çš„æ—¥æœŸï¼';
                errorMsg.classList.remove('hidden');
                return;
                }
            }

            if (!inputValue || inputValue.length !== 4) {
                errorMsg.textContent = 'è«‹è¼¸å…¥4ä½æ•¸å­—ï¼ˆæ ¼å¼ï¼šMMDDï¼‰';
                errorMsg.classList.remove('hidden');
                return;
            }

            // é©—è­‰è¼¸å…¥æ˜¯å¦ç‚ºæ•¸å­—
            if (!/^\d{4}$/.test(inputValue)) {
                errorMsg.textContent = 'è«‹è¼¸å…¥æœ‰æ•ˆçš„æ•¸å­—';
                errorMsg.classList.remove('hidden');
                return;
            }

            // è§£æè¼¸å…¥çš„æ—¥æœŸ
            const month = parseInt(inputValue.substring(0, 2));
            const day = parseInt(inputValue.substring(2, 4));

            // é©—è­‰æœˆä»½å’Œæ—¥æœŸ
            if (month < 1 || month > 12) {
                errorMsg.textContent = 'æœˆä»½å¿…é ˆåœ¨ 01-12 ä¹‹é–“';
                errorMsg.classList.remove('hidden');
                return;
            }

            if (day < 1 || day > 31) {
                errorMsg.textContent = 'æ—¥æœŸå¿…é ˆåœ¨ 01-31 ä¹‹é–“';
                errorMsg.classList.remove('hidden');
                return;
            }

            // é–‹ç™¼è€…æ¨¡å¼ä¸‹ä¸éœ€è¦é©—è­‰æ—¥æœŸï¼Œå¦å‰‡æª¢æŸ¥æ˜¯å¦èˆ‡ä»Šå¤©åŒ¹é…
            if (!developerMode) {
            const today = new Date();
            const todayMonth = today.getMonth() + 1;
            const todayDay = today.getDate();

            if (month !== todayMonth || day !== todayDay) {
                errorMsg.textContent = `æ—¥æœŸä¸æ­£ç¢ºï¼è«‹è¼¸å…¥ä»Šå¤©çš„æ—¥æœŸï¼š${todayMonth.toString().padStart(2, '0')}${todayDay.toString().padStart(2, '0')}`;
                errorMsg.classList.remove('hidden');
                return;
                }
            }

            // è§£é–æˆåŠŸ
            unlockDate(unlockModalDateKey);
            closeUnlockModal();

            // é‡æ–°æ¸²æŸ“æœˆæ›†
            renderCalendar();

            // è§£é–æˆåŠŸå¾Œï¼Œè‡ªå‹•é ˜å–èªéŒ„ä¸¦ç”Ÿæˆåœ–ç‰‡ï¼ˆé–‹ç™¼è€…æ¨¡å¼ä¸‹å¯ä»¥è§£é–ä»»ä½•æ—¥æœŸï¼‰
            claimDailyQuoteWithImage();
        }

        // API Key ç®¡ç†
        function openApiKeyModal() {
            document.getElementById('apiKeyModal').classList.remove('hidden');
            document.getElementById('geminiApiKeyInput').value = geminiApiKey;
            document.getElementById('geminiApiKeyInput').focus();
        }

        function closeApiKeyModal() {
            document.getElementById('apiKeyModal').classList.add('hidden');
        }

        function saveApiKey() {
            const input = document.getElementById('geminiApiKeyInput');
            geminiApiKey = input.value.trim();
            localStorage.setItem('geminiApiKey', geminiApiKey);
            closeApiKeyModal();
            alert('API Key å·²ä¿å­˜ï¼');
        }

        // æ”¯æ´ Enter éµè§£é–
        document.addEventListener('DOMContentLoaded', function() {
            const unlockInput = document.getElementById('unlockDateInput');
            if (unlockInput) {
                unlockInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        confirmUnlockDate();
                    }
                });
            }

            // é›™æ“Šå¹´æœˆæ¨™é¡Œåˆ‡æ›å…¨è¢å¹•æ¨¡å¼
            const monthYearTitle = document.getElementById('currentMonthYear');
            if (monthYearTitle) {
                monthYearTitle.addEventListener('dblclick', function() {
                    isFullscreenMode = !isFullscreenMode;
                    const toggle = document.getElementById('fullscreenModeToggle');
                    if (toggle) {
                        toggle.checked = isFullscreenMode;
                    }
                    toggleFullscreenMode(isFullscreenMode);
                });
            }
        });

        // ç²å–ä»Šæ—¥æ—¥æœŸå­—ä¸² (YYYY-MM-DD)
        function getTodayKey() {
            const today = new Date();
            return formatDateKey(today);
        }

        // IndexedDB åœ–ç‰‡å­˜å„²ç®¡ç†
        let imageDB = null;
        const DB_NAME = 'QuoteImagesDB';
        const DB_VERSION = 1;
        const STORE_NAME = 'images';

        // åˆå§‹åŒ– IndexedDB
        function initImageDB() {
            return new Promise((resolve, reject) => {
                if (imageDB) {
                    resolve(imageDB);
                    return;
                }

                const request = indexedDB.open(DB_NAME, DB_VERSION);

                request.onerror = () => {
                    console.error('IndexedDB åˆå§‹åŒ–å¤±æ•—:', request.error);
                    reject(request.error);
                };

                request.onsuccess = () => {
                    imageDB = request.result;
                    resolve(imageDB);
                };

                request.onupgradeneeded = (event) => {
                    const db = event.target.result;
                    if (!db.objectStoreNames.contains(STORE_NAME)) {
                        const objectStore = db.createObjectStore(STORE_NAME, { keyPath: 'key' });
                        objectStore.createIndex('dateKey', 'dateKey', { unique: false });
                    }
                };
            });
        }

        // å°‡åœ–ç‰‡ä¿å­˜åˆ° IndexedDB
        async function saveImageToDB(dateKey, imageBase64) {
            try {
                if (!imageBase64) return null;

                const db = await initImageDB();
                const imageKey = `${currentUserId}_${dateKey}`;

                // è½‰æ› base64 ç‚º Blob ä»¥æ¸›å°‘å­˜å„²ç©ºé–“
                const base64Data = imageBase64.startsWith('data:')
                    ? imageBase64.split(',')[1]
                    : imageBase64;

                // æ ¹æ“šæ•¸æ“šå‰ç¶´åˆ¤æ–·åœ–ç‰‡é¡å‹
                const isJPEG = base64Data.length > 0 && base64Data.charAt(0) !== 'i'; // JPEG base64 é€šå¸¸ä¸ä»¥ 'i' é–‹é ­
                const blob = await (async () => {
                    const byteCharacters = atob(base64Data);
                    const byteNumbers = new Array(byteCharacters.length);
                    for (let i = 0; i < byteCharacters.length; i++) {
                        byteNumbers[i] = byteCharacters.charCodeAt(i);
                    }
                    const byteArray = new Uint8Array(byteNumbers);
                    return new Blob([byteArray], { type: isJPEG ? 'image/jpeg' : 'image/png' });
                })();

                return new Promise((resolve, reject) => {
                    const transaction = db.transaction([STORE_NAME], 'readwrite');
                    const store = transaction.objectStore(STORE_NAME);

                    const request = store.put({
                        key: imageKey,
                        dateKey: dateKey,
                        userId: currentUserId,
                        blob: blob,
                        timestamp: Date.now()
                    });

                    request.onsuccess = () => {
                        resolve(imageKey);
                    };

                    request.onerror = () => {
                        console.error('ä¿å­˜åœ–ç‰‡åˆ° IndexedDB å¤±æ•—:', request.error);
                        reject(request.error);
                    };
                });
            } catch (error) {
                console.error('ä¿å­˜åœ–ç‰‡åˆ° IndexedDB æ™‚ç™¼ç”ŸéŒ¯èª¤:', error);
                return null;
            }
        }

        // å¾ IndexedDB è®€å–åœ–ç‰‡
        async function loadImageFromDB(imageKey) {
            try {
                if (!imageKey) return null;

                const db = await initImageDB();

                return new Promise((resolve, reject) => {
                    const transaction = db.transaction([STORE_NAME], 'readonly');
                    const store = transaction.objectStore(STORE_NAME);
                    const request = store.get(imageKey);

                    request.onsuccess = () => {
                        const result = request.result;
                        if (result && result.blob) {
                            // å°‡ Blob è½‰æ›ç‚º base64
                            const reader = new FileReader();
                            reader.onload = () => {
                                resolve(reader.result);
                            };
                            reader.onerror = () => {
                                reject(reader.error);
                            };
                            reader.readAsDataURL(result.blob);
                        } else {
                            resolve(null);
                        }
                    };

                    request.onerror = () => {
                        console.error('å¾ IndexedDB è®€å–åœ–ç‰‡å¤±æ•—:', request.error);
                        reject(request.error);
                    };
                });
            } catch (error) {
                console.error('å¾ IndexedDB è®€å–åœ–ç‰‡æ™‚ç™¼ç”ŸéŒ¯èª¤:', error);
                return null;
            }
        }

        // å¾ IndexedDB åˆªé™¤åœ–ç‰‡
        async function deleteImageFromDB(imageKey) {
            try {
                if (!imageKey) return;

                const db = await initImageDB();

                return new Promise((resolve, reject) => {
                    const transaction = db.transaction([STORE_NAME], 'readwrite');
                    const store = transaction.objectStore(STORE_NAME);
                    const request = store.delete(imageKey);

                    request.onsuccess = () => {
                        resolve();
                    };

                    request.onerror = () => {
                        console.error('å¾ IndexedDB åˆªé™¤åœ–ç‰‡å¤±æ•—:', request.error);
                        reject(request.error);
                    };
                });
            } catch (error) {
                console.error('å¾ IndexedDB åˆªé™¤åœ–ç‰‡æ™‚ç™¼ç”ŸéŒ¯èª¤:', error);
            }
        }

        // æ¸…ç†èˆŠåœ–ç‰‡ï¼ˆåŸºæ–¼æ—¥æœŸï¼‰
        async function cleanupOldImages(keepDays = 30) {
            try {
                const db = await initImageDB();
                const today = new Date();
                const cutoffDate = new Date(today);
                cutoffDate.setDate(today.getDate() - keepDays);
                const cutoffTimestamp = cutoffDate.getTime();

                return new Promise((resolve, reject) => {
                    const transaction = db.transaction([STORE_NAME], 'readwrite');
                    const store = transaction.objectStore(STORE_NAME);
                    const index = store.index('dateKey');
                    const request = index.openCursor();

                    let deletedCount = 0;

                    request.onsuccess = (event) => {
                        const cursor = event.target.result;
                        if (cursor) {
                            const item = cursor.value;
                            // è§£ææ—¥æœŸéµæˆ–ä½¿ç”¨æ™‚é–“æˆ³
                            if (item.timestamp && item.timestamp < cutoffTimestamp) {
                                cursor.delete();
                                deletedCount++;
                            } else if (item.dateKey) {
                                const [year, month, day] = item.dateKey.split('-').map(Number);
                                const itemDate = new Date(year, month - 1, day);
                                if (itemDate < cutoffDate) {
                                    cursor.delete();
                                    deletedCount++;
                                }
                            }
                            cursor.continue();
                        } else {
                            if (deletedCount > 0) {
                                console.log(`å·²æ¸…ç† ${deletedCount} å¼µèˆŠåœ–ç‰‡`);
                            }
                            resolve(deletedCount);
                        }
                    };

                    request.onerror = () => {
                        reject(request.error);
                    };
                });
            } catch (error) {
                console.error('æ¸…ç†èˆŠåœ–ç‰‡æ™‚ç™¼ç”ŸéŒ¯èª¤:', error);
                return 0;
            }
        }

        // è¼‰å…¥æ¯æ—¥èªéŒ„è¨˜éŒ„ï¼ˆå¾ localStorageï¼Œåœ–ç‰‡å¼•ç”¨å¾ IndexedDB è¼‰å…¥ï¼‰
        async function loadDailyQuotes() {
            const key = `dailyQuotes_${currentUserId}`;
            const quotesData = JSON.parse(localStorage.getItem(key) || '{}');

            // ç•°æ­¥è¼‰å…¥åœ–ç‰‡ï¼ˆå¦‚æœéœ€è¦çš„è©±ï¼‰
            // é€™è£¡å…ˆè¿”å›æ•¸æ“šçµæ§‹ï¼Œåœ–ç‰‡åœ¨é¡¯ç¤ºæ™‚å†è¼‰å…¥
            return quotesData;
        }

        // åŒæ­¥ç‰ˆæœ¬ï¼ˆç”¨æ–¼ä¸éœ€è¦ç•°æ­¥çš„åœ°æ–¹ï¼‰
        function loadDailyQuotesSync() {
            const key = `dailyQuotes_${currentUserId}`;
            return JSON.parse(localStorage.getItem(key) || '{}');
        }

        // å£“ç¸®åœ–ç‰‡æ•¸æ“šï¼ˆé™ä½è³ªé‡ä»¥æ¸›å°‘å­˜å„²ç©ºé–“ï¼‰
        function compressImageBase64(imageBase64, quality = 0.6, maxWidth = 600) {
            return new Promise((resolve, reject) => {
                if (!imageBase64 || imageBase64.trim() === '') {
                    resolve('');
                    return;
                }

                const img = new Image();
                let timeoutId;

                // è¨­ç½®è¶…æ™‚ï¼ˆ10ç§’ï¼‰
                timeoutId = setTimeout(() => {
                    reject(new Error('åœ–ç‰‡å£“ç¸®è¶…æ™‚'));
                }, 10000);

                img.onload = function() {
                    clearTimeout(timeoutId);

                    try {
                        const canvas = document.createElement('canvas');
                        const ctx = canvas.getContext('2d');

                        // è¨ˆç®—æ–°å°ºå¯¸ï¼ˆä¿æŒæ¯”ä¾‹ï¼Œé™ä½åˆ°æ›´å°çš„å°ºå¯¸ä»¥ç¯€çœç©ºé–“ï¼‰
                        let width = img.width;
                        let height = img.height;
                        if (width > maxWidth) {
                            height = (height * maxWidth) / width;
                            width = maxWidth;
                        }

                        canvas.width = width;
                        canvas.height = height;

                        // ç¹ªè£½ä¸¦å£“ç¸®
                        ctx.drawImage(img, 0, 0, width, height);

                        // è½‰æ›ç‚º JPEG æ ¼å¼ï¼ˆé€šå¸¸æ¯” PNG å°ï¼Œä½¿ç”¨è¼ƒä½çš„è³ªé‡ï¼‰
                        const compressed = canvas.toDataURL('image/jpeg', quality);
                        // ç§»é™¤ data:image/jpeg;base64, å‰ç¶´
                        resolve(compressed.split(',')[1]);
                    } catch (error) {
                        reject(error);
                    }
                };

                img.onerror = () => {
                    clearTimeout(timeoutId);
                    // å¦‚æœå£“ç¸®å¤±æ•—ï¼Œè¿”å›åŸæ•¸æ“šï¼ˆç§»é™¤å‰ç¶´ï¼‰
                    resolve(imageBase64.startsWith('data:') ? imageBase64.split(',')[1] : imageBase64);
                };

                // è™•ç† base64 åœ–ç‰‡
                const imageSrc = imageBase64.startsWith('data:')
                    ? imageBase64
                    : `data:image/png;base64,${imageBase64}`;
                img.src = imageSrc;
            });
        }

        // æ¸…ç†èˆŠçš„èªéŒ„æ•¸æ“šï¼ˆåªä¿ç•™æœ€è¿‘ N å¤©çš„å®Œæ•´æ•¸æ“šï¼Œå…¶ä»–çš„ç§»é™¤åœ–ç‰‡å¼•ç”¨ï¼‰
        async function cleanupOldQuoteData(quotesData, keepDays = 30) {
            const today = new Date();
            const cutoffDate = new Date(today);
            cutoffDate.setDate(today.getDate() - keepDays);

            const cleanedData = {};
            let removedCount = 0;

            for (const dateKey in quotesData) {
                const quote = quotesData[dateKey];
                if (!quote) continue;

                // è§£ææ—¥æœŸ
                const [year, month, day] = dateKey.split('-').map(Number);
                const quoteDate = new Date(year, month - 1, day);

                if (quoteDate >= cutoffDate) {
                    // ä¿ç•™æœ€è¿‘ N å¤©çš„å®Œæ•´æ•¸æ“š
                    cleanedData[dateKey] = quote;
                } else {
                    // ç§»é™¤èˆŠæ•¸æ“šçš„åœ–ç‰‡å¼•ç”¨ï¼Œä¸¦å¾ IndexedDB åˆªé™¤åœ–ç‰‡
                    if (quote.imageKey) {
                        try {
                            await deleteImageFromDB(quote.imageKey);
                        } catch (error) {
                            console.warn(`åˆªé™¤èˆŠåœ–ç‰‡å¤±æ•— (${dateKey}):`, error);
                        }
                    }

                    // åªä¿ç•™æ–‡å­—å’Œæ—¥æœŸ
                    cleanedData[dateKey] = {
                        quote: quote.quote,
                        date: quote.date,
                        imageKey: null,
                        hasImage: false
                    };
                    removedCount++;
                }
            }

            if (removedCount > 0) {
                console.log(`å·²æ¸…ç† ${removedCount} æ¢èˆŠèªéŒ„çš„åœ–ç‰‡æ•¸æ“š`);
            }

            return cleanedData;
        }

        // åŒæ­¥ç‰ˆæœ¬ï¼ˆç”¨æ–¼ä¸éœ€è¦ç•°æ­¥æ¸…ç†çš„å ´åˆï¼‰
        function cleanupOldQuoteDataSync(quotesData, keepDays = 30) {
            const today = new Date();
            const cutoffDate = new Date(today);
            cutoffDate.setDate(today.getDate() - keepDays);

            const cleanedData = {};
            let removedCount = 0;

            for (const dateKey in quotesData) {
                const quote = quotesData[dateKey];
                if (!quote) continue;

                const [year, month, day] = dateKey.split('-').map(Number);
                const quoteDate = new Date(year, month - 1, day);

                if (quoteDate >= cutoffDate) {
                    cleanedData[dateKey] = quote;
                } else {
                    cleanedData[dateKey] = {
                        quote: quote.quote,
                        date: quote.date,
                        imageKey: null,
                        hasImage: false
                    };
                    removedCount++;
                }
            }

            return cleanedData;
        }

        // ä¼°ç®— JSON å­—ä¸²å¤§å°ï¼ˆä»¥å­—ç¯€ç‚ºå–®ä½ï¼‰
        function estimateStorageSize(data) {
            return new Blob([JSON.stringify(data)]).size;
        }

        // ä¿å­˜æ¯æ—¥èªéŒ„è¨˜éŒ„ï¼ˆä½¿ç”¨ IndexedDB å­˜å„²åœ–ç‰‡ï¼‰
        async function saveDailyQuotes(quotesData, newDateKey = null) {
            const key = `dailyQuotes_${currentUserId}`;

            try {
                // åˆå§‹åŒ– IndexedDB
                await initImageDB();

                // å…ˆè¼‰å…¥ç¾æœ‰æ•¸æ“š
                const existingData = loadDailyQuotesSync();

                // å…ˆæ¸…ç†èˆŠæ•¸æ“š
                const cleanedExistingData = cleanupOldQuoteData(existingData, 30);

                // åˆä½µæ•¸æ“š
                const mergedData = { ...cleanedExistingData };

                // è™•ç†æ–°æ•¸æ“šæˆ–æ›´æ–°çš„æ•¸æ“š
                const processedData = {};
                for (const dateKey in quotesData) {
                    const quote = quotesData[dateKey];
                    if (!quote) continue;

                    const existingQuote = mergedData[dateKey];

                    // æª¢æŸ¥æ˜¯å¦æœ‰æ–°åœ–ç‰‡éœ€è¦ä¿å­˜åˆ° IndexedDB
                    if (quote.image && (!existingQuote || !existingQuote.imageKey || existingQuote.image !== quote.image)) {
                        // å£“ç¸®åœ–ç‰‡å¾Œä¿å­˜åˆ° IndexedDB
                        try {
                            let imageToSave = quote.image;

                            // å£“ç¸®åœ–ç‰‡
                            const imageSize = quote.image.length;
                            if (imageSize > 100000) {
                                imageToSave = await compressImageBase64(quote.image);
                            } else {
                                imageToSave = quote.image.startsWith('data:')
                                    ? quote.image.split(',')[1]
                                    : quote.image;
                            }

                            // ä¿å­˜åˆ° IndexedDB
                            const imageKey = await saveImageToDB(dateKey, imageToSave);

                            processedData[dateKey] = {
                                quote: quote.quote,
                                date: quote.date,
                                imageKey: imageKey, // åªä¿å­˜å¼•ç”¨ï¼Œä¸ä¿å­˜åœ–ç‰‡æ•¸æ“š
                                hasImage: true
                            };
                        } catch (error) {
                            console.warn(`ä¿å­˜åœ–ç‰‡åˆ° IndexedDB å¤±æ•— (${dateKey}):`, error);
                            // å¦‚æœä¿å­˜å¤±æ•—ï¼Œä»ç„¶ä¿å­˜æ–‡å­—
                            processedData[dateKey] = {
                                quote: quote.quote,
                                date: quote.date,
                                imageKey: null,
                                hasImage: false
                            };
                        }
                    } else if (existingQuote) {
                        // ä½¿ç”¨ç¾æœ‰æ•¸æ“š
                        processedData[dateKey] = existingQuote;
                    } else {
                        // åªæœ‰æ–‡å­—ï¼Œæ²’æœ‰åœ–ç‰‡
                        processedData[dateKey] = {
                            quote: quote.quote,
                            date: quote.date,
                            imageKey: null,
                            hasImage: false
                        };
                    }
                }

                // åˆä½µè™•ç†å¾Œçš„æ•¸æ“š
                const finalData = { ...mergedData, ...processedData };

                // å†æ¬¡æ¸…ç†ï¼ˆç¢ºä¿ä¸è¶…éé™åˆ¶ï¼‰
                const finalCleanedData = cleanupOldQuoteDataSync(finalData, 30);

                // æ¸…ç† IndexedDB ä¸­çš„èˆŠåœ–ç‰‡
                await cleanupOldImages(30);

                // ä¿å­˜åˆ° localStorageï¼ˆåªåŒ…å«æ–‡å­—å’Œå¼•ç”¨ï¼‰
                localStorage.setItem(key, JSON.stringify(finalCleanedData));

                console.log('èªéŒ„æ•¸æ“šå·²ä¿å­˜ï¼ˆåœ–ç‰‡å­˜å„²åœ¨ IndexedDBï¼‰');
            } catch (error) {
                console.error('ä¿å­˜èªéŒ„æ™‚ç™¼ç”ŸéŒ¯èª¤:', error);

                // å¦‚æœ IndexedDB å¤±æ•—ï¼Œå˜—è©¦ä½¿ç”¨ localStorageï¼ˆä½†ä¸æ¨è–¦ï¼Œç©ºé–“æœ‰é™ï¼‰
                try {
                    const fallbackData = {};
                    for (const dateKey in quotesData) {
                        const quote = quotesData[dateKey];
                        if (quote) {
                            fallbackData[dateKey] = {
                                quote: quote.quote,
                                date: quote.date,
                                imageKey: null,
                                hasImage: false
                            };
                        }
                    }
                    localStorage.setItem(key, JSON.stringify(fallbackData));
                    alert('âš ï¸ IndexedDB ä¸å¯ç”¨ï¼Œå·²ä¿å­˜æ–‡å­—æ•¸æ“šã€‚åœ–ç‰‡æœªä¿å­˜ã€‚');
                } catch (e) {
                    console.error('ç„¡æ³•ä¿å­˜æ•¸æ“š:', e);
                    alert('âŒ ç„¡æ³•ä¿å­˜æ•¸æ“šã€‚è«‹æª¢æŸ¥ç€è¦½å™¨å­˜å„²æ¬Šé™ã€‚');
                }
            }
        }

        // ç²å–ä»Šæ—¥èªéŒ„ï¼ˆå¦‚æœå·²é ˜å–ï¼‰
        function getTodayQuote() {
            const quotesData = loadDailyQuotes();
            const todayKey = getTodayKey();
            return quotesData[todayKey] || null;
        }

        // é ˜å–ä»Šæ—¥èªéŒ„ï¼ˆé–‹ç™¼è€…æ¨¡å¼ä¸‹ä¸éœ€è¦è§£é–ï¼‰
        function claimDailyQuote() {
            const todayKey = getTodayKey();

            // æª¢æŸ¥æ˜¯å¦å·²è§£é–ï¼ˆé–‹ç™¼è€…æ¨¡å¼ä¸‹è·³éæª¢æŸ¥ï¼‰
            if (!checkDateUnlocked(todayKey)) {
                alert('è«‹å…ˆè§£é–ä»Šå¤©çš„æ—¥æœŸï¼é»æ“Šæœˆæ›†ä¸Šçš„é–åœ–æ¨™è§£é–ã€‚\n\nğŸ’¡ æç¤ºï¼šé›™æ“Šæ¨™é¡Œå¯é–‹å•Ÿé–‹ç™¼è€…æ¨¡å¼');
                return;
            }

            claimDailyQuoteWithImage();
        }

        // é–‹ç™¼è€…æ¨¡å¼ï¼šç›´æ¥æ‰“å¡æŒ‡å®šæ—¥æœŸï¼ˆä¸éœ€è¦è§£é–ï¼‰
        async function devModeCheckin(dateKey) {
            if (!developerMode) {
                alert('è«‹å…ˆé–‹å•Ÿé–‹ç™¼è€…æ¨¡å¼ï¼ˆé›™æ“Šæ¨™é¡Œï¼‰');
                return;
            }

            // è‡ªå‹•è§£é–è©²æ—¥æœŸ
            unlockDate(dateKey);

            // ç›´æ¥ç”ŸæˆèªéŒ„
            await claimDailyQuoteForDate(dateKey);
        }

        // ç‚ºæŒ‡å®šæ—¥æœŸé ˜å–èªéŒ„ï¼ˆé–‹ç™¼è€…æ¨¡å¼å°ˆç”¨ï¼‰
        async function claimDailyQuoteForDate(dateKey) {
            const quotesData = loadDailyQuotes();

            // å¦‚æœè©²æ—¥æœŸå·²ç¶“é ˜å–éï¼Œä¸é‡è¤‡é ˜å–
            if (quotesData[dateKey] && quotesData[dateKey].image) {
                const quote = quotesData[dateKey];
                // ç¢ºä¿å·²åŠ å…¥åˆ°å¾…è¾¦äº‹é …
                if (quote.quote && quote.image) {
                    if (!todos[dateKey]) {
                        todos[dateKey] = [];
                    }
                    const exists = todos[dateKey].some(todo => {
                        if (typeof todo === 'string') return false;
                        return todo.isDailyQuote === true && todo.text === quote.quote;
                    });
                    if (!exists) {
                        await addDailyQuoteToTodos(dateKey, quote.quote, quote.image);
                    }
                }
                renderDailyQuote(dateKey).catch(err => console.error('æ¸²æŸ“èªéŒ„å¤±æ•—:', err));
                return;
            }

            // å¾æœªä½¿ç”¨çš„èªéŒ„ä¸­éš¨æ©Ÿé¸æ“‡
            const selectedQuote = await selectRandomQuote();

            // é¡¯ç¤ºè¼‰å…¥ç‹€æ…‹
            const card = document.getElementById('dailyQuoteCard');
            if (card) {
                card.innerHTML = `
                    <div class="text-center py-4">
                        <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600 mb-2"></div>
                        <p class="text-gray-600">æ­£åœ¨ç”ŸæˆèªéŒ„å¡ç‰‡...</p>
                    </div>
                `;
            }

            try {
                // ç”Ÿæˆåœ–ç‰‡
                let imageBase64 = null;
                try {
                    imageBase64 = await generateQuoteImageWithCanvas(selectedQuote, dateKey);
                } catch (error) {
                    console.warn('Canvas åœ–ç‰‡ç”Ÿæˆå¤±æ•—:', error);
                    if (geminiApiKey) {
                        try {
                            imageBase64 = await generateQuoteImageWithGemini(selectedQuote);
                        } catch (apiError) {
                            console.warn('Gemini API åœ–ç‰‡ç”Ÿæˆå¤±æ•—:', apiError);
                        }
                    }
                }

                // æº–å‚™ä¿å­˜èªéŒ„ï¼ˆåœ–ç‰‡ç¨å¾Œåœ¨ saveDailyQuotes ä¸­è™•ç†ï¼‰
                const currentQuotesData = loadDailyQuotes();
                currentQuotesData[dateKey] = {
                    quote: selectedQuote,
                    date: dateKey,
                    image: imageBase64 || null // ä¿å­˜åŸå§‹ base64ï¼Œè®“ saveDailyQuotes è™•ç†å£“ç¸®
                };
                await saveDailyQuotes(currentQuotesData, dateKey);

                // è‡ªå‹•å°‡èªéŒ„åŠ å…¥åˆ°å¾…è¾¦äº‹é …ä¸­ï¼ˆå³ä½¿æ²’æœ‰åœ–ç‰‡ä¹Ÿè¦æ·»åŠ ï¼‰
                // å¦‚æœåœ–ç‰‡ç‚º nullï¼ŒaddDailyQuoteToTodos æœƒä½¿ç”¨é è¨­é¡è‰²
                await addDailyQuoteToTodos(dateKey, selectedQuote, imageBase64 || '');

                // æ›´æ–°é¡¯ç¤º
                if (selectedDate && formatDateKey(selectedDate) === dateKey) {
                    renderDailyQuote(dateKey);
                    renderTodos(dateKey);
                } else {
                    const date = new Date(dateKey);
                    selectDate(date);
                }

                renderCalendar();
            } catch (error) {
                console.error('ç”ŸæˆèªéŒ„å¤±æ•—:', error);
                console.error('éŒ¯èª¤è©³æƒ…:', error.stack || error.message);
                // å³ä½¿å‡ºéŒ¯ï¼Œä¹Ÿå˜—è©¦ä¿å­˜èªéŒ„ï¼ˆä¸åŒ…å«åœ–ç‰‡ï¼‰
                try {
                    quotesData[dateKey] = {
                        quote: selectedQuote,
                        date: dateKey,
                        image: null
                    };
                    await saveDailyQuotes(quotesData);
                    // å˜—è©¦æ·»åŠ å¾…è¾¦äº‹é …ï¼ˆä½¿ç”¨é è¨­é¡è‰²ï¼‰
                    await addDailyQuoteToTodos(dateKey, selectedQuote, '');
                } catch (saveError) {
                    console.error('ä¿å­˜èªéŒ„ä¹Ÿå¤±æ•—:', saveError);
                }

                if (card) {
                    card.innerHTML = `
                        <div class="text-center py-4">
                            <p class="text-red-600 mb-2">åœ–ç‰‡ç”Ÿæˆå¤±æ•—</p>
                            <p class="text-xs text-gray-500 mb-3">èªéŒ„å·²ä¿å­˜ï¼Œä½†åœ–ç‰‡ç”Ÿæˆå¤±æ•—ã€‚è«‹æŸ¥çœ‹æ§åˆ¶å°äº†è§£è©³æƒ…ã€‚</p>
                            <button onclick="devModeCheckin('${dateKey}')"
                                    class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition">
                                é‡è©¦ç”Ÿæˆåœ–ç‰‡
                            </button>
                        </div>
                    `;
                }
                // é‡æ–°æ¸²æŸ“æœˆæ›†å’Œå¾…è¾¦äº‹é …
                renderCalendar();
                if (selectedDate && formatDateKey(selectedDate) === dateKey) {
                    renderDailyQuote(dateKey);
                    renderTodos(dateKey);
                }
            }
        }

        // ç²å–å·²ä½¿ç”¨çš„èªéŒ„åˆ—è¡¨
        function getUsedQuotes() {
            const key = `usedQuotes_${currentUserId}`;
            return JSON.parse(localStorage.getItem(key) || '[]');
        }

        // ä¿å­˜å·²ä½¿ç”¨çš„èªéŒ„åˆ—è¡¨
        function saveUsedQuotes(usedQuotes) {
            const key = `usedQuotes_${currentUserId}`;
            localStorage.setItem(key, JSON.stringify(usedQuotes));
        }

        // ç²å–å·²ä½¿ç”¨çš„é¡è‰²ä¸»é¡Œåˆ—è¡¨ï¼ˆæŒ‰æ—¥æœŸï¼‰
        function getUsedThemes() {
            const key = `usedThemes_${currentUserId}`;
            return JSON.parse(localStorage.getItem(key) || '{}');
        }

        // ä¿å­˜å·²ä½¿ç”¨çš„é¡è‰²ä¸»é¡Œåˆ—è¡¨
        function saveUsedThemes(usedThemes) {
            const key = `usedThemes_${currentUserId}`;
            localStorage.setItem(key, JSON.stringify(usedThemes));
        }

        // ç²å–æœªä½¿ç”¨çš„ä¸»é¡Œï¼ˆç¢ºä¿æ¯å¤©é¡è‰²ä¸é‡è¤‡ï¼‰
        function getUnusedTheme(dateKey) {
            const usedThemes = getUsedThemes();
            const allThemeNames = ['å¯§éœæ¹–é¢', 'æº«æš–æ™¨æ›¦', 'å¤¢å¹»èŠ±åœ’', 'æ¸…æ–°åŸé‡', 'å …éŸŒå±±å·’', 'æ·±é‚ƒå¤œç©º', 'æ­¡æ¨‚ç…™ç«', 'æº«æŸ”æœˆå…‰'];

            // ç²å–æ‰€æœ‰å·²ä½¿ç”¨çš„ä¸»é¡Œåç¨±
            const usedThemeNames = Object.values(usedThemes);

            // å¦‚æœæ‰€æœ‰ä¸»é¡Œéƒ½ç”¨éäº†ï¼Œé‡ç½®è¨˜éŒ„ï¼ˆä¿ç•™ä»Šå¤©çš„ï¼‰
            let availableThemes = allThemeNames.filter(name => !usedThemeNames.includes(name));
            if (availableThemes.length === 0) {
                // ä¿ç•™ä»Šå¤©çš„ä¸»é¡Œï¼Œæ¸…é™¤å…¶ä»–çš„
                const todayKey = getTodayKey();
                const todayTheme = usedThemes[todayKey];
                const newUsedThemes = {};
                if (todayTheme) {
                    newUsedThemes[todayKey] = todayTheme;
                }
                saveUsedThemes(newUsedThemes);
                availableThemes = allThemeNames.filter(name => name !== todayTheme);
            }

            // éš¨æ©Ÿé¸æ“‡ä¸€å€‹æœªä½¿ç”¨çš„ä¸»é¡Œ
            const selectedTheme = availableThemes[Math.floor(Math.random() * availableThemes.length)];

            // è¨˜éŒ„ä»Šå¤©ä½¿ç”¨çš„ä¸»é¡Œ
            usedThemes[dateKey] = selectedTheme;
            saveUsedThemes(usedThemes);

            return selectedTheme;
        }

        // é¸æ“‡ä¸€å€‹æœªä½¿ç”¨éçš„èªéŒ„ï¼ˆç¢ºä¿æ¯å¤©éƒ½ä¸ä¸€æ¨£ï¼‰
        async function selectRandomQuote() {
            const currentQuotes = await getDailyQuotes(); // æ¯æ¬¡ç²å–æœ€æ–°çš„èªéŒ„åˆ—è¡¨
            const usedQuotes = getUsedQuotes();
            const availableQuotes = currentQuotes.filter(quote => !usedQuotes.includes(quote));

            // å¦‚æœæ‰€æœ‰èªéŒ„éƒ½ç”¨éäº†ï¼Œé‡ç½®è¨˜éŒ„
            if (availableQuotes.length === 0) {
                saveUsedQuotes([]);
                return currentQuotes[Math.floor(Math.random() * currentQuotes.length)];
            }

            // å¾æœªä½¿ç”¨çš„èªéŒ„ä¸­éš¨æ©Ÿé¸æ“‡
            const randomIndex = Math.floor(Math.random() * availableQuotes.length);
            const selectedQuote = availableQuotes[randomIndex];

            // è¨˜éŒ„å·²ä½¿ç”¨çš„èªéŒ„
            usedQuotes.push(selectedQuote);
            saveUsedQuotes(usedQuotes);

            return selectedQuote;
        }

        // ä¸‹è¼‰èªéŒ„åœ–ç‰‡
        function downloadQuoteImage(imageBase64, dateKey) {
            try {
                // å°‡ base64 è½‰æ›ç‚º Blob
                const byteString = atob(imageBase64.split(',')[1]);
                const mimeString = imageBase64.split(',')[0].split(':')[1].split(';')[0];
                const ab = new ArrayBuffer(byteString.length);
                const ia = new Uint8Array(ab);
                for (let i = 0; i < byteString.length; i++) {
                    ia[i] = byteString.charCodeAt(i);
                }
                const blob = new Blob([ab], { type: mimeString });
                
                // å»ºç«‹ Blob URL
                const url = URL.createObjectURL(blob);
                
                // å»ºç«‹ä¸‹è¼‰é€£çµ
                const link = document.createElement('a');
                link.href = url;
                link.download = `æ¯æ—¥èªéŒ„_${dateKey}.png`;
                link.style.display = 'none';
                
                // è§¸ç™¼ä¸‹è¼‰
                document.body.appendChild(link);
                link.click();
                
                // æ¸…ç†
                setTimeout(() => {
                    document.body.removeChild(link);
                    URL.revokeObjectURL(url);
                }, 100);
                
                console.log(`âœ… èªéŒ„åœ–ç‰‡å·²ä¸‹è¼‰ï¼šæ¯æ—¥èªéŒ„_${dateKey}.png`);
            } catch (error) {
                console.error('ä¸‹è¼‰åœ–ç‰‡å¤±æ•—:', error);
                // å¦‚æœè‡ªå‹•ä¸‹è¼‰å¤±æ•—ï¼Œæä¾›æ‰‹å‹•ä¸‹è¼‰é¸é …
                alert('è‡ªå‹•ä¸‹è¼‰å¤±æ•—ï¼Œè«‹æ‰‹å‹•ä¿å­˜åœ–ç‰‡ã€‚');
            }
        }

        // é ˜å–èªéŒ„ä¸¦ç”Ÿæˆåœ–ç‰‡
        async function claimDailyQuoteWithImage() {
            const todayKey = getTodayKey();
            const quotesData = loadDailyQuotes();

            // å¦‚æœä»Šå¤©å·²ç¶“é ˜å–éï¼Œä¸é‡è¤‡é ˜å–
            if (quotesData[todayKey] && quotesData[todayKey].image) {
                renderDailyQuote().catch(err => console.error('æ¸²æŸ“èªéŒ„å¤±æ•—:', err));
                // ç¢ºä¿å·²åŠ å…¥åˆ°å¾…è¾¦äº‹é …ï¼ˆåªåœ¨ä¸å­˜åœ¨æ™‚æ·»åŠ ï¼‰
                const quote = quotesData[todayKey];
                if (quote.quote && quote.image) {
                    // æª¢æŸ¥æ˜¯å¦å·²ç¶“å­˜åœ¨ï¼Œé¿å…é‡è¤‡æ·»åŠ 
                    if (!todos[todayKey]) {
                        todos[todayKey] = [];
                    }
                    const exists = todos[todayKey].some(todo => {
                        if (typeof todo === 'string') return false; // å­—ä¸²æ ¼å¼ä¸å¯èƒ½æ˜¯èªéŒ„
                        return todo.isDailyQuote === true && todo.text === quote.quote;
                    });
                    if (!exists) {
                        addDailyQuoteToTodos(todayKey, quote.quote, quote.image);
                    }
                }
                return;
            }

            // å¾æœªä½¿ç”¨çš„èªéŒ„ä¸­éš¨æ©Ÿé¸æ“‡ï¼Œç¢ºä¿æ¯å¤©éƒ½ä¸ä¸€æ¨£
            const selectedQuote = await selectRandomQuote();

            // é¡¯ç¤ºè¼‰å…¥ç‹€æ…‹
            const card = document.getElementById('dailyQuoteCard');
            card.innerHTML = `
                <div class="text-center py-4">
                    <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-purple-600 mb-2"></div>
                    <p class="text-gray-600">æ­£åœ¨ç”ŸæˆèªéŒ„å¡ç‰‡...</p>
                </div>
            `;

            try {
                // ç”Ÿæˆåœ–ç‰‡ï¼ˆå„ªå…ˆä½¿ç”¨ html2canvasï¼Œå¦‚æœå¤±æ•—å‰‡å˜—è©¦ Gemini APIï¼‰
                let imageBase64 = null;

                // æ–¹æ³•1ï¼šä½¿ç”¨ html2canvasï¼ˆä¸éœ€è¦ APIï¼‰
                try {
                    imageBase64 = await generateQuoteImageWithCanvas(selectedQuote, todayKey);
                } catch (error) {
                    console.warn('Canvas åœ–ç‰‡ç”Ÿæˆå¤±æ•—ï¼Œå˜—è©¦ä½¿ç”¨ Gemini API:', error);

                    // æ–¹æ³•2ï¼šå¦‚æœè¨­ç½®äº† Gemini API Keyï¼Œå‰‡ä½¿ç”¨ API
                    if (geminiApiKey) {
                        try {
                            imageBase64 = await generateQuoteImageWithGemini(selectedQuote);
                        } catch (apiError) {
                            console.warn('Gemini API åœ–ç‰‡ç”Ÿæˆå¤±æ•—:', apiError);
                        }
                    }
                }

                // æº–å‚™ä¿å­˜èªéŒ„ï¼ˆåœ–ç‰‡ç¨å¾Œåœ¨ saveDailyQuotes ä¸­è™•ç†ï¼‰
                const currentQuotesData = loadDailyQuotes();
                currentQuotesData[todayKey] = {
                    quote: selectedQuote,
                    date: todayKey,
                    image: imageBase64 || null // ä¿å­˜åŸå§‹ base64ï¼Œè®“ saveDailyQuotes è™•ç†å£“ç¸®
                };
                await saveDailyQuotes(currentQuotesData, todayKey);

                // è‡ªå‹•å°‡èªéŒ„åŠ å…¥åˆ°å¾…è¾¦äº‹é …ä¸­ä¸¦æ¨™è¨˜ç‚ºå®Œæˆ
                addDailyQuoteToTodos(todayKey, selectedQuote, imageBase64);

                // å¦‚æœç”¨æˆ¶æ­£åœ¨æŸ¥çœ‹ä»Šå¤©çš„æ—¥æœŸï¼Œæ›´æ–°é¡¯ç¤ºï¼›å¦å‰‡è‡ªå‹•é¸æ“‡ä»Šå¤©ä¸¦é¡¯ç¤º
                if (selectedDate && formatDateKey(selectedDate) === todayKey) {
                    renderDailyQuote(todayKey).catch(err => console.error('æ¸²æŸ“èªéŒ„å¤±æ•—:', err));
                    renderTodos(todayKey);
                } else {
                    // è‡ªå‹•é¸æ“‡ä»Šå¤©çš„æ—¥æœŸä»¥é¡¯ç¤ºèªéŒ„
                    const today = new Date();
                    selectDate(today);
                }

                // æ›´æ–°æœˆæ›†é¡¯ç¤º
                renderCalendar();
            } catch (error) {
                console.error('é ˜å–èªéŒ„å¤±æ•—:', error);
                card.innerHTML = `
                    <div class="text-center py-4">
                        <p class="text-red-600 mb-2">é ˜å–å¤±æ•—ï¼Œè«‹é‡è©¦</p>
                        <button onclick="claimDailyQuoteWithImage()"
                                class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition">
                            é‡è©¦
                        </button>
                    </div>
                `;
            }
        }

        // åˆ†æèªéŒ„æ„å¢ƒï¼Œæ ¹æ“šå¿ƒå¢ƒç”Ÿæˆå°æ‡‰çš„è¦–è¦ºæ™¯è‡´ï¼ˆç¢ºä¿æ¯å¤©é¡è‰²ä¸é‡è¤‡ï¼‰
        function getQuoteTheme(quote, dateKey) {
            const quoteLower = quote.toLowerCase();

            // æª¢æŸ¥ä»Šå¤©æ˜¯å¦å·²ç¶“æœ‰ä¸»é¡Œ
            const usedThemes = getUsedThemes();
            if (usedThemes[dateKey]) {
                // å¦‚æœä»Šå¤©å·²æœ‰ä¸»é¡Œï¼Œç›´æ¥è¿”å›è©²ä¸»é¡Œ
                const themeName = usedThemes[dateKey];
                const allThemes = getAllThemes();
                return allThemes.find(t => t.name === themeName) || allThemes[0];
            }

            // å®šç¾©é—œéµè©èˆ‡å°æ‡‰çš„æ„å¢ƒä¸»é¡Œ
            const moodKeywords = {
                // å¹³éœã€å¯§éœã€å…§çœ
                peaceful: {
                    keywords: ['å¹³éœ', 'å¯§éœ', 'å…§å¿ƒ', 'åŸè«’', 'æ¥å—', 'å¹³å‡¡', 'ç©©å®š', 'æƒ…ç·’ç©©å®š', 'å¹³éœ', 'å®‰éœ', 'æ²‰éœ'],
                    theme: {
                        name: 'å¯§éœæ¹–é¢',
                        gradient: 'linear-gradient(135deg, #667eea 0%, #764ba2 30%, #4facfe 60%, #00f2fe 100%)',
                        accent: '#00f2fe',
                        decor: 'ğŸŒŠ',
                        pattern: 'wave',
                        description: 'å¦‚å¹³éœæ¹–é¢èˆ¬çš„å¯§éœè—ç´«è‰²èª¿'
                    }
                },
                // æº«æš–ã€å¸Œæœ›ã€é¼“å‹µ
                warm: {
                    keywords: ['é–‹å¿ƒ', 'å¿«æ¨‚', 'å¸Œæœ›', 'æœŸå¾…', 'æ›´å¥½', 'æˆé•·', 'é€²æ­¥', 'åŠ æ²¹', 'åŠªåŠ›', 'å‹‡æ•¢', 'å …æŒ'],
                    theme: {
                        name: 'æº«æš–æ™¨æ›¦',
                        gradient: 'linear-gradient(135deg, #f093fb 0%, #f5576c 30%, #f6d365 60%, #fee140 100%)',
                        accent: '#fee140',
                        decor: 'ğŸŒ…',
                        pattern: 'star',
                        description: 'å¦‚æ™¨æ›¦èˆ¬æº«æš–çš„æ©™é‡‘è‰²èª¿'
                    }
                },
                // å¤¢å¹»ã€æº«æŸ”ã€ç¾å¥½
                dreamy: {
                    keywords: ['å¤¢æƒ³', 'ç¾å¥½', 'æº«æŸ”', 'æ„›', 'æ„Ÿè¦º', 'æœŸå¾…', 'æµªæ¼«', 'ç¾å¥½', 'æº«æŸ”', 'å¤¢å¹»'],
                    theme: {
                        name: 'å¤¢å¹»èŠ±åœ’',
                        gradient: 'linear-gradient(135deg, #fa709a 0%, #fee140 30%, #f093fb 60%, #667eea 100%)',
                        accent: '#f093fb',
                        decor: 'ğŸŒ¸',
                        pattern: 'star',
                        description: 'å¦‚å¤¢å¹»èŠ±åœ’èˆ¬çš„ç²‰ç´«è‰²èª¿'
                    }
                },
                // æ¸…æ–°ã€è‡ªç”±ã€é–‹é—Š
                fresh: {
                    keywords: ['è‡ªç”±', 'é–‹é—Š', 'æ¸…æ–°', 'è‡ªç„¶', 'å‘¼å¸', 'æ”¾é¬†', 'è¼•é¬†', 'è‡ªç”±', 'é–‹é—Š', 'å»£é—Š'],
                    theme: {
                        name: 'æ¸…æ–°åŸé‡',
                        gradient: 'linear-gradient(135deg, #30cfd0 0%, #4facfe 30%, #00f2fe 60%, #667eea 100%)',
                        accent: '#30cfd0',
                        decor: 'ğŸŒ¿',
                        pattern: 'leaf',
                        description: 'å¦‚åŸé‡èˆ¬æ¸…æ–°çš„é’è—è‰²èª¿'
                    }
                },
                // åŠ›é‡ã€å …å¼·ã€æ±ºå¿ƒ
                strong: {
                    keywords: ['åŠ›é‡', 'å …å¼·', 'å‹‡æ•¢', 'ä¸æ€•', 'æ‰“æ•—', 'æˆ°å‹', 'æ±ºå¿ƒ', 'å …æŒ', 'å‹‡æ•¢', 'å …å¼·'],
                    theme: {
                        name: 'å …éŸŒå±±å·’',
                        gradient: 'linear-gradient(135deg, #330867 0%, #764ba2 30%, #667eea 60%, #f093fb 100%)',
                        accent: '#764ba2',
                        decor: 'â›°ï¸',
                        pattern: 'diamond',
                        description: 'å¦‚å±±å·’èˆ¬å …éŸŒçš„æ·±ç´«è‰²èª¿'
                    }
                },
                // æ†‚é¬±ã€æ€è€ƒã€æ·±æ²‰
                contemplative: {
                    keywords: ['æ†‚é¬±', 'æ€è€ƒ', 'æ·±æ²‰', 'å¤±å»', 'ç—›è‹¦', 'å›°é›£', 'é›£é', 'æ†‚æ„', 'æ€è€ƒ', 'æ·±æ²‰'],
                    theme: {
                        name: 'æ·±é‚ƒå¤œç©º',
                        gradient: 'linear-gradient(135deg, #1e3c72 0%, #2a5298 30%, #667eea 60%, #764ba2 100%)',
                        accent: '#667eea',
                        decor: 'ğŸŒ™',
                        pattern: 'dot',
                        description: 'å¦‚å¤œç©ºèˆ¬æ·±é‚ƒçš„è—ç´«è‰²èª¿'
                    }
                },
                // å–œæ‚…ã€æ…¶ç¥ã€æˆå°±
                joyful: {
                    keywords: ['é–‹å¿ƒ', 'å¿«æ¨‚', 'æˆåŠŸ', 'æˆå°±', 'æ…¶ç¥', 'é–‹å¿ƒ', 'å¿«æ¨‚', 'å–œæ‚…', 'æ­¡æ¨‚', 'æ…¶ç¥'],
                    theme: {
                        name: 'æ­¡æ¨‚ç…™ç«',
                        gradient: 'linear-gradient(135deg, #f6d365 0%, #fda085 30%, #fa709a 60%, #f093fb 100%)',
                        accent: '#fda085',
                        decor: 'ğŸ‰',
                        pattern: 'star',
                        description: 'å¦‚ç…™ç«èˆ¬çµ¢çˆ›çš„é‡‘ç²‰è‰²èª¿'
                    }
                },
                // æº«æŸ”ã€é—œæ‡·ã€æ„›
                gentle: {
                    keywords: ['æº«æŸ”', 'é—œæ‡·', 'æ„›', 'ç…§é¡§', 'é—œå¿ƒ', 'æº«æŸ”', 'é—œæ‡·', 'æ„›', 'æº«æš–', 'é«”è²¼'],
                    theme: {
                        name: 'æº«æŸ”æœˆå…‰',
                        gradient: 'linear-gradient(135deg, #667eea 0%, #764ba2 30%, #f093fb 60%, #fa709a 100%)',
                        accent: '#f093fb',
                        decor: 'ğŸ’œ',
                        pattern: 'circle',
                        description: 'å¦‚æœˆå…‰èˆ¬æº«æŸ”çš„ç´«ç²‰è‰²èª¿'
                    }
                }
            };

            // åˆ†æèªéŒ„ï¼Œæ‰¾å‡ºåŒ¹é…çš„æ„å¢ƒ
            let matchedMood = null;
            let maxScore = 0;

            for (const [mood, data] of Object.entries(moodKeywords)) {
                let score = 0;
                data.keywords.forEach(keyword => {
                    if (quoteLower.includes(keyword)) {
                        score += keyword.length; // é—œéµè©è¶Šé•·ï¼Œæ¬Šé‡è¶Šé«˜
                    }
                });
                if (score > maxScore) {
                    maxScore = score;
                    matchedMood = data.theme;
                }
            }

            // å¦‚æœæ²’æœ‰åŒ¹é…åˆ°ï¼Œæ ¹æ“šèªéŒ„çš„æ•´é«”æƒ…æ„Ÿå‚¾å‘é¸æ“‡
            if (!matchedMood || maxScore === 0) {
                // åˆ†æèªéŒ„çš„æ•´é«”æƒ…æ„Ÿ
                const hasPositive = /é–‹å¿ƒ|å¿«æ¨‚|å¸Œæœ›|ç¾å¥½|æˆåŠŸ|æˆé•·|é€²æ­¥|å‹‡æ•¢|å …æŒ|åŠªåŠ›/.test(quoteLower);
                const hasNegative = /æ†‚é¬±|ç—›è‹¦|å›°é›£|å¤±å»|é›£é|æ†‚æ„|å¤±æœ›/.test(quoteLower);
                const hasNeutral = /å¹³éœ|å¯§éœ|æ¥å—|å¹³å‡¡|ç©©å®š|æƒ…ç·’/.test(quoteLower);

                if (hasPositive && !hasNegative) {
                    matchedMood = moodKeywords.warm.theme;
                } else if (hasNegative && !hasPositive) {
                    matchedMood = moodKeywords.contemplative.theme;
                } else if (hasNeutral) {
                    matchedMood = moodKeywords.peaceful.theme;
                } else {
                    // é»˜èªä½¿ç”¨æº«æŸ”ä¸»é¡Œ
                    matchedMood = moodKeywords.gentle.theme;
                }
            }

            // ç¢ºä¿ä¸»é¡Œä¸é‡è¤‡
            const selectedThemeName = getUnusedTheme(dateKey);
            // å¦‚æœåŒ¹é…çš„ä¸»é¡Œå·²ç¶“ç”¨éï¼Œä½¿ç”¨æœªä½¿ç”¨çš„ä¸»é¡Œ
            if (matchedMood && matchedMood.name === selectedThemeName) {
            return matchedMood;
            } else {
                // ä½¿ç”¨æœªä½¿ç”¨çš„ä¸»é¡Œ
                const allThemes = getAllThemes();
                return allThemes.find(t => t.name === selectedThemeName) || matchedMood;
            }
        }

        // ç²å–æ‰€æœ‰ä¸»é¡Œåˆ—è¡¨ï¼ˆç”¨æ–¼æŸ¥æ‰¾ï¼‰
        function getAllThemes() {
            return [
                {
                    name: 'å¯§éœæ¹–é¢',
                    gradient: 'linear-gradient(135deg, #667eea 0%, #764ba2 30%, #4facfe 60%, #00f2fe 100%)',
                    accent: '#00f2fe',
                    decor: 'ğŸŒŠ',
                    pattern: 'wave'
                },
                {
                    name: 'æº«æš–æ™¨æ›¦',
                    gradient: 'linear-gradient(135deg, #f093fb 0%, #f5576c 30%, #f6d365 60%, #fee140 100%)',
                    accent: '#fee140',
                    decor: 'ğŸŒ…',
                    pattern: 'star'
                },
                {
                    name: 'å¤¢å¹»èŠ±åœ’',
                    gradient: 'linear-gradient(135deg, #fa709a 0%, #fee140 30%, #f093fb 60%, #667eea 100%)',
                    accent: '#f093fb',
                    decor: 'ğŸŒ¸',
                    pattern: 'star'
                },
                {
                    name: 'æ¸…æ–°åŸé‡',
                    gradient: 'linear-gradient(135deg, #30cfd0 0%, #4facfe 30%, #00f2fe 60%, #667eea 100%)',
                    accent: '#30cfd0',
                    decor: 'ğŸŒ¿',
                    pattern: 'leaf'
                },
                {
                    name: 'å …éŸŒå±±å·’',
                    gradient: 'linear-gradient(135deg, #330867 0%, #764ba2 30%, #667eea 60%, #f093fb 100%)',
                    accent: '#764ba2',
                    decor: 'â›°ï¸',
                    pattern: 'diamond'
                },
                {
                    name: 'æ·±é‚ƒå¤œç©º',
                    gradient: 'linear-gradient(135deg, #1e3c72 0%, #2a5298 30%, #667eea 60%, #764ba2 100%)',
                    accent: '#667eea',
                    decor: 'ğŸŒ™',
                    pattern: 'dot'
                },
                {
                    name: 'æ­¡æ¨‚ç…™ç«',
                    gradient: 'linear-gradient(135deg, #f6d365 0%, #fda085 30%, #fa709a 60%, #f093fb 100%)',
                    accent: '#fda085',
                    decor: 'ğŸ‰',
                    pattern: 'star'
                },
                {
                    name: 'æº«æŸ”æœˆå…‰',
                    gradient: 'linear-gradient(135deg, #667eea 0%, #764ba2 30%, #f093fb 60%, #fa709a 100%)',
                    accent: '#f093fb',
                    decor: 'ğŸ’œ',
                    pattern: 'circle'
                }
            ];
        }

        // ä½¿ç”¨ html2canvas ç”ŸæˆèªéŒ„å¡ç‰‡åœ–ç‰‡ï¼ˆä¸éœ€è¦ APIï¼Œåªç”ŸæˆèƒŒæ™¯ï¼Œä¸å«æ–‡å­—ï¼‰
        async function generateQuoteImageWithCanvas(quote, dateKey) {
            const theme = getQuoteTheme(quote, dateKey);

            // å‰µå»ºä¸€å€‹è‡¨æ™‚çš„å¡ç‰‡å…ƒç´ 
            const tempCard = document.createElement('div');
            tempCard.style.position = 'fixed';
            tempCard.style.left = '-9999px';
            tempCard.style.width = '1000px';
            tempCard.style.height = '700px';
            tempCard.style.padding = '0';
            tempCard.style.background = theme.gradient;
            tempCard.style.borderRadius = '30px';
            tempCard.style.boxShadow = '0 30px 80px rgba(0,0,0,0.4)';
            tempCard.style.display = 'flex';
            tempCard.style.flexDirection = 'column';
            tempCard.style.justifyContent = 'center';
            tempCard.style.alignItems = 'center';
            tempCard.style.color = 'white';
            tempCard.style.fontFamily = "'Inter', sans-serif";
            tempCard.style.overflow = 'hidden';
            tempCard.style.position = 'relative';

            // æ·»åŠ èƒŒæ™¯è£é£¾åœ–æ¡ˆ
            const bgPattern = document.createElement('div');
            bgPattern.style.position = 'absolute';
            bgPattern.style.top = '0';
            bgPattern.style.left = '0';
            bgPattern.style.width = '100%';
            bgPattern.style.height = '100%';
            bgPattern.style.opacity = '0.15';
            bgPattern.style.backgroundImage = createPatternSVG(theme.pattern, theme.accent);
            bgPattern.style.backgroundRepeat = 'repeat';
            bgPattern.style.backgroundSize = '200px 200px';
            tempCard.appendChild(bgPattern);

            // æ·»åŠ å…‰æšˆæ•ˆæœ
            const glow1 = document.createElement('div');
            glow1.style.position = 'absolute';
            glow1.style.top = '-100px';
            glow1.style.right = '-100px';
            glow1.style.width = '400px';
            glow1.style.height = '400px';
            glow1.style.borderRadius = '50%';
            glow1.style.background = `radial-gradient(circle, ${theme.accent}40 0%, transparent 70%)`;
            glow1.style.filter = 'blur(60px)';
            tempCard.appendChild(glow1);

            const glow2 = document.createElement('div');
            glow2.style.position = 'absolute';
            glow2.style.bottom = '-150px';
            glow2.style.left = '-150px';
            glow2.style.width = '500px';
            glow2.style.height = '500px';
            glow2.style.borderRadius = '50%';
            glow2.style.background = `radial-gradient(circle, rgba(255,255,255,0.2) 0%, transparent 70%)`;
            glow2.style.filter = 'blur(80px)';
            tempCard.appendChild(glow2);

            // æ·»åŠ æ–‡å­—å…§å®¹
            const contentContainer = document.createElement('div');
            contentContainer.style.position = 'relative';
            contentContainer.style.zIndex = '10';
            contentContainer.style.maxWidth = '800px';
            contentContainer.style.padding = '60px';
            contentContainer.style.textAlign = 'center';

            // æ·»åŠ æ—¥æœŸæ¨™ç±¤
            const dateLabel = document.createElement('div');
            dateLabel.style.fontSize = '20px';
            dateLabel.style.fontWeight = '600';
            dateLabel.style.marginBottom = '40px';
            dateLabel.style.opacity = '0.9';
            dateLabel.style.letterSpacing = '2px';
            dateLabel.textContent = `âœ¨ ${dateKey}`;
            contentContainer.appendChild(dateLabel);

            // æ·»åŠ èªéŒ„æ–‡å­—
            const quoteText = document.createElement('div');
            quoteText.style.fontSize = '36px';
            quoteText.style.fontWeight = '600';
            quoteText.style.lineHeight = '1.6';
            quoteText.style.textShadow = '0 4px 20px rgba(0,0,0,0.3)';
            quoteText.style.whiteSpace = 'pre-line';
            quoteText.style.wordBreak = 'break-word';
            quoteText.textContent = quote;
            contentContainer.appendChild(quoteText);

            tempCard.appendChild(contentContainer);

            // æ ¹æ“šæ„å¢ƒæ·»åŠ é¡å¤–çš„è¦–è¦ºå…ƒç´ 
            if (theme.name.includes('æ¹–é¢') || theme.name.includes('åŸé‡')) {
                // æ·»åŠ æ°´å¹³ç·šæ¢ï¼Œæ¨¡æ“¬åœ°å¹³ç·š
                const horizonLine = document.createElement('div');
                horizonLine.style.position = 'absolute';
                horizonLine.style.bottom = '150px';
                horizonLine.style.left = '0';
                horizonLine.style.width = '100%';
                horizonLine.style.height = '2px';
                horizonLine.style.background = `linear-gradient(90deg, transparent, ${theme.accent}60, transparent)`;
                horizonLine.style.opacity = '0.4';
                tempCard.appendChild(horizonLine);
            }

            if (theme.name.includes('å¤œç©º') || theme.name.includes('æœˆå…‰')) {
                // æ·»åŠ æ˜Ÿæ˜Ÿé»é»
                for (let i = 0; i < 5; i++) {
                    const star = document.createElement('div');
                    star.style.position = 'absolute';
                    star.style.top = `${20 + i * 15}%`;
                    star.style.left = `${10 + i * 18}%`;
                    star.style.width = '4px';
                    star.style.height = '4px';
                    star.style.background = 'white';
                    star.style.borderRadius = '50%';
                    star.style.opacity = '0.6';
                    star.style.boxShadow = '0 0 6px white';
                    tempCard.appendChild(star);
                }
            }

            if (theme.name.includes('ç…™ç«') || theme.name.includes('æ™¨æ›¦')) {
                // æ·»åŠ å…‰ç·šæ•ˆæœ
                const lightRay = document.createElement('div');
                lightRay.style.position = 'absolute';
                lightRay.style.top = '0';
                lightRay.style.left = '50%';
                lightRay.style.width = '200px';
                lightRay.style.height = '100%';
                lightRay.style.background = `linear-gradient(180deg, ${theme.accent}30 0%, transparent 100%)`;
                lightRay.style.transform = 'translateX(-50%)';
                lightRay.style.filter = 'blur(40px)';
                tempCard.appendChild(lightRay);
            }

            document.body.appendChild(tempCard);

            try {
                // ç¢ºä¿å…ƒç´ å·²æ·»åŠ åˆ° DOMï¼ˆç­‰å¾…ä¸€å°æ®µæ™‚é–“è®“ç€è¦½å™¨æ¸²æŸ“ï¼‰
                await new Promise(resolve => setTimeout(resolve, 100));

                // ä½¿ç”¨ html2canvas è½‰æ›ç‚ºåœ–ç‰‡ï¼ˆæé«˜ scale ä»¥æå‡å“è³ªï¼‰
                const canvas = await html2canvas(tempCard, {
                    width: 1200,
                    height: 840,
                    scale: 2.5, // æé«˜ scale å¾ 1.5 åˆ° 2.5ï¼Œå¢åŠ åœ–ç‰‡æ¸…æ™°åº¦
                    backgroundColor: null,
                    useCORS: true,
                    logging: false,
                    allowTaint: false,
                    removeContainer: true // è‡ªå‹•ç§»é™¤è‡¨æ™‚å®¹å™¨
                });

                // è½‰æ›ç‚º base64
                const base64 = canvas.toDataURL('image/png');

                // ç§»é™¤è‡¨æ™‚å…ƒç´ 
                if (tempCard.parentNode) {
                document.body.removeChild(tempCard);
                }

                // æª¢æŸ¥ç”Ÿæˆçš„åœ–ç‰‡æ˜¯å¦æœ‰æ•ˆ
                if (!base64 || base64.length < 100) {
                    throw new Error('ç”Ÿæˆçš„åœ–ç‰‡æ•¸æ“šç„¡æ•ˆæˆ–éå°');
                }

                // è¿”å› base64ï¼ˆå»æ‰ data:image/png;base64, å‰ç¶´ï¼‰
                return base64.split(',')[1];
            } catch (error) {
                // ç¢ºä¿ç§»é™¤è‡¨æ™‚å…ƒç´ 
                if (tempCard.parentNode) {
                    try {
                    document.body.removeChild(tempCard);
                    } catch (e) {
                        console.warn('ç§»é™¤è‡¨æ™‚å…ƒç´ å¤±æ•—:', e);
                    }
                }

                // æä¾›æ›´è©³ç´°çš„éŒ¯èª¤ä¿¡æ¯
                console.error('html2canvas ç”Ÿæˆå¤±æ•—:', {
                    error: error.message,
                    stack: error.stack,
                    dateKey: dateKey
                });

                throw new Error(`åœ–ç‰‡ç”Ÿæˆå¤±æ•—: ${error.message || 'æœªçŸ¥éŒ¯èª¤'}`);
            }
        }

        // å‰µå»ºèƒŒæ™¯åœ–æ¡ˆ SVG
        function createPatternSVG(patternType, color) {
            const svgPatterns = {
                circle: `url("data:image/svg+xml,%3Csvg width='100' height='100' xmlns='http://www.w3.org/2000/svg'%3E%3Ccircle cx='50' cy='50' r='20' fill='${encodeURIComponent(color)}' opacity='0.3'/%3E%3C/svg%3E")`,
                wave: `url("data:image/svg+xml,%3Csvg width='100' height='100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M0,50 Q25,30 50,50 T100,50' stroke='${encodeURIComponent(color)}' fill='none' stroke-width='2' opacity='0.3'/%3E%3C/svg%3E")`,
                dot: `url("data:image/svg+xml,%3Csvg width='100' height='100' xmlns='http://www.w3.org/2000/svg'%3E%3Ccircle cx='20' cy='20' r='3' fill='${encodeURIComponent(color)}' opacity='0.4'/%3E%3Ccircle cx='80' cy='80' r='3' fill='${encodeURIComponent(color)}' opacity='0.4'/%3E%3C/svg%3E")`,
                star: `url("data:image/svg+xml,%3Csvg width='100' height='100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpolygon points='50,10 55,35 80,35 60,50 65,75 50,60 35,75 40,50 20,35 45,35' fill='${encodeURIComponent(color)}' opacity='0.2'/%3E%3C/svg%3E")`,
                leaf: `url("data:image/svg+xml,%3Csvg width='100' height='100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M50,20 Q30,40 50,60 Q70,40 50,20' fill='${encodeURIComponent(color)}' opacity='0.25'/%3E%3C/svg%3E")`,
                diamond: `url("data:image/svg+xml,%3Csvg width='100' height='100' xmlns='http://www.w3.org/2000/svg'%3E%3Cpolygon points='50,10 70,50 50,90 30,50' fill='${encodeURIComponent(color)}' opacity='0.2'/%3E%3C/svg%3E")`
            };
            return svgPatterns[patternType] || svgPatterns.circle;
        }

        // ä½¿ç”¨ Gemini API ç”ŸæˆèªéŒ„åœ–ç‰‡ï¼ˆå¯é¸ï¼‰
        async function generateQuoteImageWithGemini(quote) {
            if (!geminiApiKey) {
                throw new Error('Gemini API Key æœªè¨­å®š');
            }

            const prompt = `A highly aesthetic, minimalist abstract digital art background suitable for a daily quote card. Use soft, ambient lighting and colors inspired by the current time of day. Incorporate subtle elements related to inspiration or success, like a gentle upward curve or a blurred horizon. The style should be modern, serene, and clean. Resolution 1024x1024. The central theme relates to: "${quote}".`;

            const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/imagen-4.0-generate-001:predict?key=${geminiApiKey}`;

            const payload = {
                instances: [{ prompt: prompt }],
                parameters: {
                    "sampleCount": 1,
                    "aspectRatio": "1:1"
                }
            };

            const response = await fetch(apiUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });

            if (!response.ok) {
                throw new Error(`API returned status ${response.status}`);
            }

            const result = await response.json();
            const base64Data = result.predictions?.[0]?.bytesBase64Encoded;

            if (base64Data) {
                return base64Data;
            } else {
                throw new Error("Image generation failed to return base64 data.");
            }
        }

        // åŒæ­¥æ‰€æœ‰å·²è§£é–çš„èªéŒ„åˆ°å¾…è¾¦äº‹é …
        async function syncAllQuotesToTodos() {
            const quotesData = loadDailyQuotes();

            for (const dateKey in quotesData) {
                const quote = quotesData[dateKey];
                if (quote && quote.quote && quote.image) {
                    // æª¢æŸ¥æ˜¯å¦å·²ç¶“æœ‰é€™å€‹èªéŒ„å¾…è¾¦äº‹é …
                    if (!todos[dateKey]) {
                        todos[dateKey] = [];
                    }

                    const existingQuoteTodo = todos[dateKey].find(todo => {
                        if (typeof todo === 'string') return false; // å­—ä¸²æ ¼å¼ä¸å¯èƒ½æ˜¯èªéŒ„
                        return todo.isDailyQuote === true && todo.text === quote.quote;
                    });

                    if (!existingQuoteTodo) {
                        // å¦‚æœæ²’æœ‰ï¼Œå‰‡æ·»åŠ 
                        await addDailyQuoteToTodos(dateKey, quote.quote, quote.image);
                    } else if (typeof existingQuoteTodo === 'object' && !existingQuoteTodo.bgColor) {
                        // å¦‚æœå­˜åœ¨ä½†æ²’æœ‰èƒŒæ™¯é¡è‰²ï¼Œé‡æ–°æå–é¡è‰²
                        const bgColor = await extractDominantColor(quote.image);
                        existingQuoteTodo.bgColor = bgColor;
                        existingQuoteTodo.imageBase64 = quote.image;
                        saveTodos();

                        // å¦‚æœç•¶å‰é¸ä¸­çš„æ˜¯é€™å€‹æ—¥æœŸï¼Œç«‹å³æ›´æ–°é¡¯ç¤º
                        if (selectedDate && formatDateKey(selectedDate) === dateKey) {
                            renderTodos(dateKey);
                        }
                    }
                }
            }
        }

        // ç²å–æŒ‡å®šæ—¥æœŸçš„èªéŒ„ï¼ˆå¾ IndexedDB è¼‰å…¥åœ–ç‰‡ï¼‰
        async function getQuoteForDate(dateKey) {
            const quotesData = await loadDailyQuotes();
            const quote = quotesData[dateKey];

            if (!quote) return null;

            // å¦‚æœæœ‰åœ–ç‰‡å¼•ç”¨ï¼Œå¾ IndexedDB è¼‰å…¥
            if (quote.imageKey && quote.hasImage) {
                try {
                    const imageBase64 = await loadImageFromDB(quote.imageKey);
                    if (imageBase64) {
                        return {
                            ...quote,
                            image: imageBase64
                        };
                    }
                } catch (error) {
                    console.warn(`è¼‰å…¥åœ–ç‰‡å¤±æ•— (${dateKey}):`, error);
                }
            }

            // å…¼å®¹èˆŠæ ¼å¼ï¼ˆç›´æ¥åŒ…å«åœ–ç‰‡æ•¸æ“šï¼‰
            if (quote.image) {
                return quote;
            }

            return {
                ...quote,
                image: null
            };
        }

        // åŒæ­¥ç‰ˆæœ¬ï¼ˆè¿”å›åŸºæœ¬æ•¸æ“šï¼Œä¸è¼‰å…¥åœ–ç‰‡ï¼‰
        function getQuoteForDateSync(dateKey) {
            const quotesData = loadDailyQuotesSync();
            return quotesData[dateKey] || null;
        }

        // æ¸²æŸ“æ¯æ—¥èªéŒ„å¡ç‰‡ï¼ˆæ ¹æ“šé¸ä¸­çš„æ—¥æœŸæˆ–ä»Šå¤©ï¼‰
        async function renderDailyQuote(dateKey = null) {
            const card = document.getElementById('dailyQuoteCard');

            // å¦‚æœæ²’æœ‰æŒ‡å®šæ—¥æœŸï¼Œä½¿ç”¨é¸ä¸­çš„æ—¥æœŸï¼Œå¦‚æœæ²’æœ‰é¸ä¸­å‰‡ä¸é¡¯ç¤º
            if (!dateKey && !selectedDate) {
                card.innerHTML = '';
                return;
            }

            const targetDateKey = dateKey || (selectedDate ? formatDateKey(selectedDate) : null);
            if (!targetDateKey) {
                card.innerHTML = '';
                return;
            }

            const quote = await getQuoteForDate(targetDateKey);
            const isUnlocked = checkDateUnlocked(targetDateKey);
            const isToday = targetDateKey === getTodayKey();

            if (quote) {
                // å·²é ˜å–ï¼Œé¡¯ç¤ºèªéŒ„å’Œåœ–ç‰‡ï¼ˆåœ–ç‰‡ä½œç‚ºèƒŒæ™¯ï¼‰
                let imageSrc = '';
                let backgroundStyle = '';

                if (quote.image) {
                    // åˆ¤æ–·æ˜¯ data URL é‚„æ˜¯ç´” base64
                    imageSrc = quote.image.startsWith('data:')
                        ? quote.image
                        : `data:image/png;base64,${quote.image}`;
                    backgroundStyle = `background-image: url('${imageSrc}'); background-size: cover; background-position: center; background-repeat: no-repeat;`;
                }

                card.innerHTML = `
                    <div class="rounded-xl p-6 shadow-md mb-4 relative overflow-hidden min-h-[200px] flex flex-col justify-center" style="${backgroundStyle}">
                        <div class="relative z-10 bg-black bg-opacity-30 backdrop-blur-sm rounded-lg p-4">
                            <div class="flex items-center justify-between mb-3">
                                <div class="text-sm text-white font-semibold flex items-center drop-shadow-lg">
                                    <span class="mr-1">âœ¨</span> ${targetDateKey}
                        </div>
                                ${quote.image ? `
                                    <button onclick="downloadQuoteImage('${quote.image.startsWith('data:') ? quote.image : 'data:image/png;base64,' + quote.image}', '${targetDateKey}')" 
                                            class="px-3 py-1 bg-purple-600 hover:bg-purple-700 text-white text-xs rounded-lg transition-all shadow-lg font-semibold flex items-center gap-1">
                                        <span>ğŸ’¾</span> ä¸‹è¼‰
                                    </button>
                                ` : ''}
                            </div>
                            <div class="text-white text-lg leading-relaxed whitespace-pre-line font-medium drop-shadow-lg">
                                ${escapeHtml(quote.quote)}
                            </div>
                        </div>
                    </div>
                `;
            } else if (isToday && !isUnlocked && !developerMode) {
                // ä»Šå¤©æœªè§£é–ï¼šæ‰‹æ©Ÿæ¨¡å¼ä¸‹é¡¯ç¤ºæ‰“å¡æŒ‰éˆ•ï¼Œæ¡Œé¢æ¨¡å¼é¡¯ç¤ºæç¤ºæ–‡å­—
                if (isMobile()) {
                    // æ‰‹æ©Ÿæ¨¡å¼ï¼šé¡¯ç¤ºæ‰“å¡æŒ‰éˆ•ï¼ˆæœƒæ‰“é–‹è§£é–æ—¥æœŸ Modalï¼‰
                    const todayDateObj = parseDateKey(targetDateKey);
                    card.innerHTML = `
                        <div class="bg-gradient-to-br from-purple-50 to-pink-50 rounded-xl p-4 shadow-md border-l-4 border-purple-500 mb-4">
                            <div class="text-center py-2">
                                <p class="text-gray-600 mb-3 text-sm">ä»Šæ—¥é‚„æ²’æ‰“å¡</p>
                                <button onclick="openUnlockModalForToday()"
                                        class="px-6 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition font-semibold">
                                    ğŸ“… ç«‹å³æ‰“å¡
                                </button>
                            </div>
                        </div>
                    `;
                } else {
                    // æ¡Œé¢æ¨¡å¼ï¼šé¡¯ç¤ºæç¤ºæ–‡å­—
                    card.innerHTML = `
                        <div class="bg-gradient-to-br from-purple-50 to-pink-50 rounded-xl p-4 shadow-md border-l-4 border-purple-500 mb-4">
                            <div class="text-center py-2">
                                <p class="text-gray-600 mb-2 text-sm">ä»Šæ—¥é‚„æ²’æ‰“å¡</p>
                            </div>
                        </div>
                    `;
                }
            } else {
                // æ²’æœ‰èªéŒ„æ™‚ä¸é¡¯ç¤ºä»»ä½•å…§å®¹
                card.innerHTML = '';
            }
        }

        // ç›£è½èªéŒ„åˆ—è¡¨çš„æ›´æ–°ï¼ˆå¾ç®¡ç†é é¢ï¼‰
        window.addEventListener('storage', function(e) {
            if (e.key === 'dailyQuotes_list') {
                // èªéŒ„åˆ—è¡¨å·²æ›´æ–°ï¼Œé‡æ–°åŠ è¼‰
                // æ³¨æ„ï¼šåœ¨åŒä¸€å€‹çª—å£/æ¨™ç±¤é å…§ï¼Œstorage äº‹ä»¶ä¸æœƒè§¸ç™¼
                // æ‰€ä»¥æˆ‘å€‘ä½¿ç”¨è‡ªå®šç¾©äº‹ä»¶ä¾†é€šçŸ¥
                const newQuotes = e.newValue ? JSON.parse(e.newValue) : [];
                console.log('èªéŒ„åˆ—è¡¨å·²æ›´æ–°ï¼Œå…±', newQuotes.length, 'æ¢èªéŒ„');
            }
        });

        // åœ¨åŒä¸€å€‹çª—å£å…§ç›£è½è‡ªå®šç¾©äº‹ä»¶
        window.addEventListener('dailyQuotesUpdated', function() {
            // é‡æ–°ç²å–èªéŒ„åˆ—è¡¨ï¼ˆä¸‹æ¬¡ä½¿ç”¨æ™‚æœƒè‡ªå‹•ä½¿ç”¨æ–°çš„åˆ—è¡¨ï¼‰
            console.log('èªéŒ„åˆ—è¡¨å·²æ›´æ–°');
        });

        // åˆå§‹åŒ–
        async function init() {
            try {
                console.log('ğŸš€ é–‹å§‹åˆå§‹åŒ–æ‡‰ç”¨...');
                
                // è¼‰å…¥ä¸»é¡Œè¨­å®š
                loadTheme();
                
                // è¼‰å…¥æœˆæ›†åç¨±
                updateCalendarTitle();
                
                // è¼‰å…¥å…¨è¢å¹•æ¨¡å¼è¨­å®š
                loadFullscreenMode();
                
                // è¼‰å…¥é€šçŸ¥è¨­å®š
                loadNotificationSettings();
                
                // æ›´æ–°é–‹ç™¼è€…æ¨¡å¼æŒ‡ç¤ºå™¨
                updateDeveloperModeIndicator();
                // æ›´æ–°é‡ç½®æŒ‰éˆ•é¡¯ç¤ºç‹€æ…‹
                updateResetButtonVisibility();

                initUsers();
                
                // ç«‹å³æ¸²æŸ“æ—¥æ›†ï¼ˆä¸ç­‰å¾…èªéŒ„è¼‰å…¥ï¼‰
                console.log('ğŸ“… æ¸²æŸ“æ—¥æ›†...');
                renderCalendar();
                updateMonthYear();
                renderAllTodosList(); // åˆå§‹åŒ–æ™‚é¡¯ç¤ºæ‰€æœ‰å¾…è¾¦äº‹é …åˆ—è¡¨
                console.log('âœ… æ—¥æ›†æ¸²æŸ“å®Œæˆ');

                // ç•°æ­¥è¼‰å…¥èªéŒ„æ•¸æ“šï¼ˆä¸é˜»å¡æ—¥æ›†é¡¯ç¤ºï¼‰
                loadQuotesFromFile().then(() => {
                    dailyQuotes = dailyQuotesData; // æ›´æ–°è®Šæ•¸
                    console.log('âœ… èªéŒ„æ•¸æ“šè¼‰å…¥å®Œæˆ');
                }).catch(err => {
                    console.error('âš ï¸ èªéŒ„è¼‰å…¥å¤±æ•—ï¼Œä½¿ç”¨é»˜èªå€¼:', err);
                    dailyQuotes = getDefaultQuotes();
                });

                // æ‰‹æ©Ÿæ¨¡å¼ä¸‹è‡ªå‹•é¸æ“‡ä»Šå¤©ï¼Œæ¡Œé¢æ¨¡å¼ç­‰å¾…ç”¨æˆ¶é¸æ“‡
                if (isMobile()) {
                    const today = new Date();
                    selectDate(today);
                } else {
                    renderDailyQuote().catch(err => console.error('æ¸²æŸ“èªéŒ„å¤±æ•—:', err)); // æ¡Œé¢æ¨¡å¼ä¸è‡ªå‹•é¸æ“‡
                }

                // åŒæ­¥æ‰€æœ‰å·²è§£é–çš„èªéŒ„åˆ°å¾…è¾¦äº‹é …
                syncAllQuotesToTodos().then(() => {
                    renderCalendar();
                    renderAllTodosList();
                }).catch(err => {
                    console.error('âš ï¸ åŒæ­¥èªéŒ„å¤±æ•—:', err);
                });
                
                console.log('âœ… åˆå§‹åŒ–å®Œæˆ');
            } catch (error) {
                console.error('âŒ åˆå§‹åŒ–å¤±æ•—:', error);
                // å³ä½¿å¤±æ•—ä¹Ÿè¦æ¸²æŸ“åŸºæœ¬æ—¥æ›†
                renderCalendar();
                updateMonthYear();
            }
        }

        // æ›´æ–°æœˆä»½å¹´ä»½é¡¯ç¤º
        function updateMonthYear() {
            const year = currentDate.getFullYear();
            const month = String(currentDate.getMonth() + 1).padStart(2, '0');
            const monthYear = `${year}  ${month}`;
            document.getElementById('currentMonthYear').textContent = monthYear;
        }

        // æ¸²æŸ“æœˆæ›†
        function renderCalendar() {
            console.log('ğŸ“… é–‹å§‹æ¸²æŸ“æœˆæ›†...');
            const calendarGrid = document.getElementById('calendarGrid');
            if (!calendarGrid) {
                console.error('âŒ éŒ¯èª¤ï¼šæ‰¾ä¸åˆ° calendarGrid å…ƒç´ ï¼');
                return;
            }
            
            calendarGrid.innerHTML = '';

            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            console.log(`æ¸²æŸ“ ${year}å¹´${month + 1}æœˆ`);

            // ç•¶æœˆç¬¬ä¸€å¤©
            const firstDay = new Date(year, month, 1);
            const lastDay = new Date(year, month + 1, 0);
            const daysInMonth = lastDay.getDate();
            const startingDayOfWeek = firstDay.getDay();

            // å¡«å……ç©ºç™½ï¼ˆä¸Šå€‹æœˆçš„æ—¥æœŸï¼‰
            for (let i = 0; i < startingDayOfWeek; i++) {
                const emptyDay = document.createElement('div');
                emptyDay.className = 'calendar-day rounded-lg';
                calendarGrid.appendChild(emptyDay);
            }

            // ç•¶æœˆçš„æ—¥æœŸ
            const today = new Date();
            for (let day = 1; day <= daysInMonth; day++) {
                const date = new Date(year, month, day);
                const dateKey = formatDateKey(date);
                const dayElement = document.createElement('div');

                // é¿å…å¾½ç« /æ–‡å­—æº¢å‡ºæœˆæ›†æ ¼å­
                let classes = 'calendar-day relative overflow-hidden rounded-lg p-1.5 cursor-pointer border-2 border-transparent';

                const todayKey = getTodayKey();
                const isUnlocked = checkDateUnlocked(dateKey);
                const dayOfWeek = date.getDay();
                const holidayInfo = getHolidayInfo(dateKey);

                // æª¢æŸ¥æ˜¯å¦ç‚ºåœ‹å®šå‡æ—¥
                if (holidayInfo) {
                    classes += ' holiday';
                }
                // æª¢æŸ¥æ˜¯å¦ç‚ºé€±å…­
                else if (dayOfWeek === 6) {
                    classes += ' saturday';
                }
                // æª¢æŸ¥æ˜¯å¦ç‚ºé€±æ—¥
                else if (dayOfWeek === 0) {
                    classes += ' sunday';
                }

                // æª¢æŸ¥æ˜¯å¦ç‚ºä»Šå¤©
                if (isToday(date)) {
                    classes += ' today';
                }

                // æª¢æŸ¥æ˜¯å¦æœ‰æœªå®Œæˆçš„å¾…è¾¦äº‹é …
                const dateTodos = todos[dateKey] || [];
                const hasUncompletedTodos = dateTodos.some(todo => {
                    if (typeof todo === 'string') return true; // èˆŠæ ¼å¼è¦–ç‚ºæœªå®Œæˆ
                    // æª¢æŸ¥ status æˆ– completed/failed å±¬æ€§
                    if (todo.status) {
                        return todo.status === 'pending';
                    }
                    return !todo.completed && !todo.failed;
                });
                if (hasUncompletedTodos) {
                    classes += ' has-todos';
                }

                dayElement.className = classes;
                dayElement.onclick = () => selectDate(date);

                // æ—¥æœŸæ•¸å­—å’Œ Today æ¨™ç±¤å®¹å™¨ï¼ˆåŒä¸€è¡Œï¼‰
                const dayNumberContainer = document.createElement('div');
                // æ‰‹æ©Ÿï¼šè®“ Today å¼·åˆ¶æ›åˆ°ä¸‹ä¸€è¡Œï¼ˆç”¨ flex-wrap + Today æ¨™ç±¤ w-fullï¼‰
                dayNumberContainer.className = 'flex flex-wrap items-center gap-0.5 mb-0.5';

                const dayNumber = document.createElement('div');
                dayNumber.className = 'font-bold text-sm sm:text-base md:text-lg';
                dayNumber.style.color = 'white';
                dayNumber.textContent = day;
                dayNumberContainer.appendChild(dayNumber);

                // è¾²æ›†æ—¥æœŸ
                const lunar = Lunar.fromDate(date);
                const lunarDay = lunar.getDay();
                const lunarMonth = lunar.getMonth();
                let lunarText = '';
                
                // å¦‚æœæ˜¯åˆä¸€ï¼Œé¡¯ç¤ºæœˆä»½
                if (lunarDay === 1) {
                    lunarText = `${lunarMonth}æœˆ`;
                } else {
                    // å¦å‰‡é¡¯ç¤ºæ—¥æœŸ
                    const lunarDayNames = ['åˆä¸€', 'åˆäºŒ', 'åˆä¸‰', 'åˆå››', 'åˆäº”', 'åˆå…­', 'åˆä¸ƒ', 'åˆå…«', 'åˆä¹', 'åˆå',
                                           'åä¸€', 'åäºŒ', 'åä¸‰', 'åå››', 'åäº”', 'åå…­', 'åä¸ƒ', 'åå…«', 'åä¹', 'äºŒå',
                                           'å»¿ä¸€', 'å»¿äºŒ', 'å»¿ä¸‰', 'å»¿å››', 'å»¿äº”', 'å»¿å…­', 'å»¿ä¸ƒ', 'å»¿å…«', 'å»¿ä¹', 'ä¸‰å'];
                    lunarText = lunarDayNames[lunarDay - 1];
                }
                
                const lunarLabel = document.createElement('div');
                lunarLabel.className = 'text-[9px] sm:text-[10px] md:text-[11px] text-gray-500';
                lunarLabel.textContent = lunarText;
                dayNumberContainer.appendChild(lunarLabel);

                // æ™®é€šæ¨¡å¼ï¼šé–åœ–æ¨™ï¼ˆåªæœ‰ç•¶å¤©ä¸”æœªè§£é–æ™‚æ‰é¡¯ç¤ºï¼Œä½†æ‰‹æ©Ÿæ¨¡å¼ä¸‹ä¸é¡¯ç¤ºï¼‰
                if (!developerMode && dateKey === todayKey && !isUnlocked && !isMobile()) {
                    const lockButton = document.createElement('button');
                    lockButton.className = 'inline-flex items-center justify-center text-gray-400 hover:text-gray-600 transition p-0.5 rounded ml-0.5';
                    lockButton.innerHTML = `
                        <svg class="w-3.5 h-3.5 sm:w-4 sm:h-4" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z" clip-rule="evenodd"/>
                        </svg>
                    `;
                    lockButton.onclick = (e) => {
                        e.stopPropagation(); // é˜»æ­¢è§¸ç™¼æ—¥æœŸé¸æ“‡
                        openUnlockModal(dateKey, date);
                    };
                    dayNumberContainer.appendChild(lockButton);
                }

                // ä»Šå¤©çš„æ¨™ç±¤ - å·²ç§»é™¤ï¼Œåªé€éé‚Šæ¡†é¡è‰²å€åˆ†

                dayElement.appendChild(dayNumberContainer);

                // å¾…è¾¦äº‹é …æ•¸é‡æ¨™è¨˜ï¼ˆåªè¨ˆç®—æœªå®Œæˆçš„ï¼‰
                const uncompletedCount = dateTodos.filter(todo => {
                    if (typeof todo === 'string') return true; // èˆŠæ ¼å¼è¦–ç‚ºæœªå®Œæˆ
                    // æª¢æŸ¥ status æˆ– completed/failed å±¬æ€§
                    if (todo.status) {
                        return todo.status === 'pending';
                    }
                    return !todo.completed && !todo.failed;
                }).length;
                if (uncompletedCount > 0) {
                    const todoCount = document.createElement('div');
                    // å›ºå®šåœ¨æ ¼å­å³ä¸‹è§’ï¼Œé¿å…æ“ å£“å…§å®¹/æº¢å‡º
                    todoCount.className = 'absolute bottom-0.5 sm:bottom-1 right-0.5 sm:right-1 z-15 text-[9px] sm:text-[10px] md:text-xs bg-yellow-400 text-yellow-900 rounded-full px-1 sm:px-1.5 md:px-2 py-0.5 font-semibold whitespace-nowrap leading-none';
                    todoCount.textContent = uncompletedCount;
                    dayElement.appendChild(todoCount);
                }

                // é–‹ç™¼è€…æ¨¡å¼ï¼šç‚ºæ‰€æœ‰æ—¥æœŸæ·»åŠ å¿«é€Ÿæ‰“å¡æŒ‰éˆ•
                if (developerMode) {
                    // ä½¿ç”¨åŒæ­¥ç‰ˆæœ¬æª¢æŸ¥æ˜¯å¦æœ‰èªéŒ„
                    const quote = getQuoteForDateSync(dateKey);
                    if (!quote) { // å¦‚æœé‚„æ²’æœ‰èªéŒ„ï¼Œé¡¯ç¤ºæ‰“å¡æŒ‰éˆ•
                        const devCheckinBtn = document.createElement('button');
                        devCheckinBtn.className = 'absolute top-1 right-1 p-1 text-green-500 hover:text-green-700 transition text-xs font-bold';
                        devCheckinBtn.innerHTML = 'âœ“';
                        devCheckinBtn.title = 'é–‹ç™¼è€…æ¨¡å¼ï¼šå¿«é€Ÿæ‰“å¡';
                        devCheckinBtn.onclick = async (e) => {
                            e.stopPropagation();
                            // é¡¯ç¤ºè¼‰å…¥ç‹€æ…‹
                            devCheckinBtn.disabled = true;
                            devCheckinBtn.innerHTML = '...';
                            try {
                                await devModeCheckin(dateKey);
                            } catch (error) {
                                console.error('æ‰“å¡å¤±æ•—:', error);
                                alert('æ‰“å¡å¤±æ•—ï¼Œè«‹é‡è©¦');
                                devCheckinBtn.innerHTML = 'âœ“';
                                devCheckinBtn.disabled = false;
                            }
                        };
                        dayElement.style.position = 'relative';
                        dayElement.appendChild(devCheckinBtn);
                    }
                }

                // å¦‚æœå·²è§£é–ï¼Œé¡¯ç¤ºæ‰“å¡å¤©æ•¸
                if (isUnlocked) {
                    // è¨ˆç®—é€™æ˜¯ç¬¬å¹¾å¤©æ‰“å¡ï¼ˆçµ±è¨ˆæ‰€æœ‰å·²è§£é–çš„æ—¥æœŸä¸­ï¼Œé€™å€‹æ—¥æœŸæ˜¯ç¬¬å¹¾å€‹ï¼‰
                    const unlockedDates = loadUnlockedDates();
                    unlockedDates.sort(); // æŒ‰æ—¥æœŸæ’åº
                    const dayIndex = unlockedDates.indexOf(dateKey);
                    if (dayIndex !== -1) {
                        const dayCountLabel = document.createElement('div');
                        // å›ºå®šåœ¨æ ¼å­å·¦ä¸‹è§’ï¼Œé¿å…æŠŠæ ¼å­é«˜åº¦æ’é–‹/æº¢å‡º
                        dayCountLabel.className = 'absolute bottom-0.5 sm:bottom-1 left-0.5 sm:left-1 z-10 inline-flex items-center justify-center px-1 sm:px-1.5 md:px-2 py-0.5 sm:py-1 rounded-full bg-gradient-to-r from-purple-500 to-pink-500 text-white text-[9px] sm:text-[10px] md:text-xs font-bold shadow-md transform transition-transform hover:scale-105 whitespace-nowrap leading-none unlock-animation';
                        dayCountLabel.textContent = `#${dayIndex + 1}`;
                        dayElement.appendChild(dayCountLabel);
                    }
                    // åŠ å…¥ unlocked é¡åˆ¥ç”¨æ–¼æ¨£å¼
                    dayElement.classList.add('unlocked');
                }

                // é¡¯ç¤ºç¯€æ…¶æ¨™è¨˜ï¼ˆå·²åœ¨ä¸Šé¢æª¢æŸ¥éï¼‰
                if (holidayInfo) {
                    const holidayBadge = document.createElement('div');
                    // å›ºå®šåœ¨æ ¼å­å³ä¸Šè§’ï¼Œä½¿ç”¨ç°¡çŸ­åç¨±é¿å…é®æ“‹æ—¥æœŸ
                    holidayBadge.className = 'absolute top-0.5 sm:top-1 right-0.5 sm:right-1 z-20 holiday-badge inline-flex items-center gap-0.5 px-1 sm:px-1.5 py-0.5 rounded-full text-white font-bold shadow-md whitespace-nowrap leading-none text-[9px] sm:text-[10px]';
                    
                    // ä½¿ç”¨ç°¡çŸ­åç¨±
                    const shortName = getHolidayShortName(holidayInfo.name);
                    
                    // title å±¬æ€§é¡¯ç¤ºå®Œæ•´åç¨±
                    holidayBadge.title = holidayInfo.name;
                    holidayBadge.textContent = `${holidayInfo.emoji} ${shortName}`;
                    dayElement.appendChild(holidayBadge);
                }

                // å„²å­˜æ—¥æœŸè³‡è¨Šåˆ°å…ƒç´ ï¼Œæ–¹ä¾¿å¾ŒçºŒæŸ¥æ‰¾
                dayElement.setAttribute('data-date-key', dateKey);
                dayElement.setAttribute('data-day', day);

                calendarGrid.appendChild(dayElement);
            }
            
            console.log(`âœ… æœˆæ›†æ¸²æŸ“å®Œæˆï¼Œå…± ${daysInMonth} å¤©`);
        }

        // é¸æ“‡æ—¥æœŸ
        function selectDate(date) {
            selectedDate = date;
            const dateKey = formatDateKey(date);

            // å¦‚æœæ˜¯å…¨è¢å¹•æ¨¡å¼ï¼Œé»æ“Šæ—¥æœŸæ™‚é€€å‡ºå…¨è¢å¹•
            if (isFullscreenMode) {
                isFullscreenMode = false;
                localStorage.setItem('fullscreenMode', 'false');
                const toggle = document.getElementById('fullscreenModeToggle');
                if (toggle) toggle.checked = false;
                toggleFullscreenMode(false);
            }

            // æ›´æ–°æ¨™é¡Œ
            const dateStr = `${date.getFullYear()} å¹´ ${date.getMonth() + 1} æœˆ ${date.getDate()} æ—¥`;
            const dayOfWeek = dayNames[date.getDay()];
            document.getElementById('selectedDateTitle').textContent = `${dateStr}ï¼ˆ${dayOfWeek}ï¼‰`;

            // é¡¯ç¤ºè©²æ—¥æœŸçš„èªéŒ„
            renderDailyQuote(dateKey).catch(err => console.error('æ¸²æŸ“èªéŒ„å¤±æ•—:', err));

            // é¡¯ç¤ºå¾…è¾¦äº‹é …
            renderTodos(dateKey);

            // é¡¯ç¤ºæ–°å¢æŒ‰éˆ•ï¼ˆéš±è—è¡¨å–®ï¼‰
            document.getElementById('addTodoButton').classList.remove('hidden');
            document.getElementById('addTodoForm').classList.add('hidden');

            // æ›´æ–°æœˆæ›†é¸ä¸­ç‹€æ…‹
            updateSelectedDay();
        }

        // æ›´æ–°é¸ä¸­çš„æ—¥æœŸæ¨£å¼
        function updateSelectedDay() {
            // ç§»é™¤æ‰€æœ‰é¸ä¸­æ¨£å¼
            const allDays = document.querySelectorAll('.calendar-day');
            allDays.forEach(day => {
                day.classList.remove('ring-2', 'ring-blue-500', 'ring-offset-2');
            });

            // ç‚ºé¸ä¸­çš„æ—¥æœŸæ·»åŠ è—è‰²æ¡†
            if (selectedDate) {
                const selectedDateKey = formatDateKey(selectedDate);
                const selectedDayElement = document.querySelector(`[data-date-key="${selectedDateKey}"]`);

                if (selectedDayElement) {
                    selectedDayElement.classList.add('ring-2', 'ring-blue-500', 'ring-offset-2');
                }
            }
        }

        // æ¸²æŸ“å¾…è¾¦äº‹é …
        function renderTodos(dateKey) {
            const todoList = document.getElementById('todoList');
            const dateTodos = todos[dateKey] || [];

            if (dateTodos.length === 0) {
                todoList.innerHTML = '<p class="text-gray-400 text-sm text-center py-4">é€™ä¸€å¤©æ²’æœ‰å¾…è¾¦äº‹é …</p>';
                return;
            }

            todoList.innerHTML = dateTodos.map((todo, index) => {
                // æ”¯æ´èˆŠæ ¼å¼ï¼ˆå­—ä¸²ï¼‰å’Œæ–°æ ¼å¼ï¼ˆç‰©ä»¶ï¼‰
                const todoText = typeof todo === 'string' ? todo : todo.text;
                let status = 'pending'; // pending, completed, failed
                const isDailyQuote = typeof todo === 'object' && todo.isDailyQuote;

                if (typeof todo === 'object') {
                    // æ–°æ ¼å¼ï¼šä½¿ç”¨ status æˆ– completed/failed å±¬æ€§
                    if (todo.status) {
                        status = todo.status;
                    } else if (todo.completed) {
                        status = 'completed';
                    } else if (todo.failed) {
                        status = 'failed';
                    }
                }

                const isCompleted = status === 'completed';
                const isFailed = status === 'failed';

                // å¦‚æœæ˜¯æ¯æ—¥èªéŒ„ä¸”æœ‰èƒŒæ™¯é¡è‰²ï¼Œä½¿ç”¨åœ–ç‰‡é¡è‰²ä½œç‚ºèƒŒæ™¯
                let styleAttr = '';
                let className = isCompleted ? 'completed' : isFailed ? 'failed' : 'bg-gray-50 border-gray-200';

                if (isDailyQuote && typeof todo === 'object' && todo.bgColor) {
                    // ä½¿ç”¨åœ–ç‰‡ä¸»è‰²èª¿ä½œç‚ºèƒŒæ™¯
                    styleAttr = `style="background: ${todo.bgColor}; border-color: ${todo.bgColor};"`;
                    className = ''; // ä¸ä½¿ç”¨é è¨­é¡åˆ¥
                }

                return `
                    <div class="todo-item flex items-center gap-2 p-3 rounded-lg border ${className}" ${styleAttr}>
                        <!-- å®ŒæˆæŒ‰éˆ•ï¼ˆæ‰“å‹¾ï¼‰ -->
                        <button onclick="markAsCompleted('${dateKey}', ${index})"
                                class="flex-shrink-0 p-1 ${isCompleted ? 'text-emerald-600' : 'text-gray-400'} hover:bg-gray-200 rounded transition"
                                title="æ¨™è¨˜ç‚ºå®Œæˆ">
                            ${isCompleted ? `
                                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                                </svg>
                            ` : `
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                                </svg>
                            `}
                        </button>
                        <!-- å¤±æ•—æŒ‰éˆ•ï¼ˆXï¼‰ -->
                        <button onclick="markAsFailed('${dateKey}', ${index})"
                                class="flex-shrink-0 p-1 ${isFailed ? 'text-gray-500' : 'text-gray-400'} hover:bg-gray-200 rounded transition"
                                title="æ¨™è¨˜ç‚ºå¤±æ•—">
                            ${isFailed ? `
                                <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"/>
                                </svg>
                            ` : `
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
                                </svg>
                            `}
                        </button>
                        <div class="flex-1 flex flex-col">
                            <span class="flex items-center gap-2 ${isFailed ? 'line-through text-gray-500' : isCompleted ? 'text-emerald-800 font-semibold' : 'text-gray-800'}">
                                ${isCompleted ? '<span class="text-lg">âœ¨</span>' : ''}
                                ${escapeHtml(todoText)}
                                ${isCompleted ? '<span class="text-lg">ğŸ‰</span>' : ''}
                            </span>
                            ${typeof todo === 'object' && todo.time ? `<span class="text-xs text-blue-600 mt-1">ğŸ”” ${todo.time}</span>` : ''}
                            ${isFailed ? '<span class="text-xs text-amber-700 mt-1 flex items-center gap-1">ğŸ’ª ä½ é‚„æ˜¯å¾ˆæ£’</span>' : ''}
                        </div>
                        <!-- åˆªé™¤æŒ‰éˆ•ï¼ˆåƒåœ¾æ¡¶ï¼‰ -->
                        <button onclick="removeTodo('${dateKey}', ${index})"
                                class="flex-shrink-0 p-1 text-red-600 hover:bg-red-100 rounded transition"
                                title="åˆªé™¤">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                            </svg>
                        </button>
                    </div>
                `;
            }).join('');
        }

        // æ¸²æŸ“æ‰€æœ‰å¾…è¾¦äº‹é …æ—¥æœŸåˆ—è¡¨
        function renderAllTodosList() {
            const allTodosContent = document.getElementById('allTodosContent');
            const allDatesWithTodos = Object.keys(todos).filter(dateKey => {
                const dateTodos = todos[dateKey] || [];
                // åªé¡¯ç¤ºæœ‰æœªå®Œæˆå¾…è¾¦äº‹é …çš„æ—¥æœŸ
                return dateTodos.some(todo => {
                    if (typeof todo === 'string') return true; // èˆŠæ ¼å¼è¦–ç‚ºæœªå®Œæˆ
                    // æª¢æŸ¥ status æˆ– completed/failed å±¬æ€§
                    if (todo.status) {
                        return todo.status === 'pending';
                    }
                    return !todo.completed && !todo.failed;
                });
            });

            if (allDatesWithTodos.length === 0) {
                allTodosContent.innerHTML = '<p class="text-gray-400 text-sm text-center py-4">ç›®å‰æ²’æœ‰å¾…è¾¦äº‹é …</p>';
                return;
            }

            // æŒ‰æ—¥æœŸæ’åºï¼ˆæœ€æ–°çš„åœ¨å‰ï¼‰
            allDatesWithTodos.sort((a, b) => b.localeCompare(a));

            allTodosContent.innerHTML = allDatesWithTodos.map(dateKey => {
                const date = parseDateKey(dateKey);
                const dateStr = `${date.getFullYear()} å¹´ ${date.getMonth() + 1} æœˆ ${date.getDate()} æ—¥`;
                const dateTodos = todos[dateKey] || [];
                // åªè¨ˆç®—æœªå®Œæˆçš„å¾…è¾¦äº‹é …
                const uncompletedCount = dateTodos.filter(todo => {
                    if (typeof todo === 'string') return true; // èˆŠæ ¼å¼è¦–ç‚ºæœªå®Œæˆ
                    // æª¢æŸ¥ status æˆ– completed/failed å±¬æ€§
                    if (todo.status) {
                        return todo.status === 'pending';
                    }
                    return !todo.completed && !todo.failed;
                }).length;
                const dayOfWeek = dayNames[date.getDay()];

                return `
                    <div onclick="selectDateFromList('${dateKey}')"
                         class="flex items-center justify-between p-3 bg-gray-50 rounded-lg border border-gray-200 cursor-pointer hover:bg-gray-100 hover:border-blue-300 transition">
                        <div class="flex-1">
                            <div class="font-semibold text-gray-800 text-sm">${dateStr}ï¼ˆ${dayOfWeek}ï¼‰</div>
                        </div>
                        <div class="flex items-center gap-2">
                            <span class="bg-yellow-400 text-yellow-900 rounded-full px-2 py-1 text-xs font-bold">${uncompletedCount}</span>
                            <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" />
                            </svg>
            </div>
    </div>
                `;
            }).join('');
        }

        // å¾æ—¥æœŸåˆ—è¡¨é¸æ“‡æ—¥æœŸ
        function selectDateFromList(dateKey) {
            const date = parseDateKey(dateKey);
            selectDate(date);

            // å¦‚æœè©²æ—¥æœŸä¸åœ¨ç•¶å‰é¡¯ç¤ºçš„æœˆä»½ï¼Œåˆ‡æ›åˆ°è©²æœˆä»½
            if (date.getFullYear() !== currentDate.getFullYear() ||
                date.getMonth() !== currentDate.getMonth()) {
                currentDate = new Date(date.getFullYear(), date.getMonth(), 1);
                renderCalendar();
                updateMonthYear();
            }

            updateSelectedDay();
        }

        // è§£ææ—¥æœŸ key ç‚º Date ç‰©ä»¶
        function parseDateKey(dateKey) {
            const [year, month, day] = dateKey.split('-').map(Number);
            return new Date(year, month - 1, day);
        }

        // æ–°å¢å¾…è¾¦äº‹é …
        // æå–åœ–ç‰‡ä¸»è‰²èª¿ï¼ˆä½¿ç”¨ Canvas APIï¼‰
        function extractDominantColor(imageBase64) {
            return new Promise((resolve) => {
                // å¦‚æœæ²’æœ‰åœ–ç‰‡æ•¸æ“šï¼Œç›´æ¥è¿”å›é è¨­é¡è‰²
                if (!imageBase64 || imageBase64.trim() === '') {
                    resolve('rgb(230, 200, 255)');
                    return;
                }

                const img = new Image();
                img.onload = function() {
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    canvas.width = 100; // ç¸®å°å°ºå¯¸ä»¥æé«˜æ€§èƒ½
                    canvas.height = 100;
                    ctx.drawImage(img, 0, 0, 100, 100);

                    const imageData = ctx.getImageData(0, 0, 100, 100);
                    const data = imageData.data;

                    // è¨ˆç®—ä¸»è¦é¡è‰²ï¼ˆä½¿ç”¨ç°¡å–®çš„é¡è‰²èšé¡ï¼‰
                    let r = 0, g = 0, b = 0;
                    let count = 0;

                    // æ¡æ¨£éƒ¨åˆ†åƒç´ é»
                    for (let i = 0; i < data.length; i += 16) { // æ¯4å€‹å€¼ä»£è¡¨ä¸€å€‹åƒç´ ï¼Œè·³é16å€‹å€¼å³æ¯4å€‹åƒç´ æ¡æ¨£ä¸€æ¬¡
                        r += data[i];
                        g += data[i + 1];
                        b += data[i + 2];
                        count++;
                    }

                    r = Math.round(r / count);
                    g = Math.round(g / count);
                    b = Math.round(b / count);

                    // è½‰æ›ç‚º HSL ä»¥èª¿æ•´äº®åº¦ï¼Œç¢ºä¿èƒŒæ™¯ä¸æœƒå¤ªæš—æˆ–å¤ªäº®
                    const hsl = rgbToHsl(r, g, b);
                    // å¢åŠ äº®åº¦ï¼Œè®“èƒŒæ™¯æ›´æŸ”å’Œ
                    hsl.l = Math.min(95, Math.max(75, hsl.l + 20));
                    const adjustedRgb = hslToRgb(hsl.h, hsl.s, hsl.l);

                    resolve(`rgb(${adjustedRgb.r}, ${adjustedRgb.g}, ${adjustedRgb.b})`);
                };

                img.onerror = () => {
                    // å¦‚æœç„¡æ³•æå–é¡è‰²ï¼Œä½¿ç”¨é è¨­çš„ç´«è‰²èª¿
                    resolve('rgb(230, 200, 255)');
                };

                // è™•ç† base64 åœ–ç‰‡
                try {
                    const imageSrc = imageBase64.startsWith('data:')
                        ? imageBase64
                        : `data:image/png;base64,${imageBase64}`;
                    img.src = imageSrc;
                } catch (error) {
                    // å¦‚æœè¨­ç½® src å¤±æ•—ï¼Œä½¿ç”¨é è¨­é¡è‰²
                    resolve('rgb(230, 200, 255)');
                }
            });
        }

        // RGB è½‰ HSL
        function rgbToHsl(r, g, b) {
            r /= 255;
            g /= 255;
            b /= 255;
            const max = Math.max(r, g, b);
            const min = Math.min(r, g, b);
            let h, s, l = (max + min) / 2;

            if (max === min) {
                h = s = 0;
            } else {
                const d = max - min;
                s = l > 0.5 ? d / (2 - max - min) : d / (max + min);
                switch (max) {
                    case r: h = ((g - b) / d + (g < b ? 6 : 0)) / 6; break;
                    case g: h = ((b - r) / d + 2) / 6; break;
                    case b: h = ((r - g) / d + 4) / 6; break;
                }
            }
            return { h: h * 360, s: s * 100, l: l * 100 };
        }

        // HSL è½‰ RGB
        function hslToRgb(h, s, l) {
            h /= 360;
            s /= 100;
            l /= 100;
            let r, g, b;

            if (s === 0) {
                r = g = b = l;
            } else {
                const hue2rgb = (p, q, t) => {
                    if (t < 0) t += 1;
                    if (t > 1) t -= 1;
                    if (t < 1/6) return p + (q - p) * 6 * t;
                    if (t < 1/2) return q;
                    if (t < 2/3) return p + (q - p) * (2/3 - t) * 6;
                    return p;
                };
                const q = l < 0.5 ? l * (1 + s) : l + s - l * s;
                const p = 2 * l - q;
                r = hue2rgb(p, q, h + 1/3);
                g = hue2rgb(p, q, h);
                b = hue2rgb(p, q, h - 1/3);
            }
            return {
                r: Math.round(r * 255),
                g: Math.round(g * 255),
                b: Math.round(b * 255)
            };
        }

        // å°‡æ¯æ—¥èªéŒ„åŠ å…¥åˆ°å¾…è¾¦äº‹é …ä¸­
        async function addDailyQuoteToTodos(dateKey, quote, imageBase64) {
            if (!todos[dateKey]) {
                todos[dateKey] = [];
            }

            // æª¢æŸ¥æ˜¯å¦å·²ç¶“æœ‰é€™å€‹èªéŒ„å¾…è¾¦äº‹é …ï¼ˆé¿å…é‡è¤‡æ·»åŠ ï¼‰
            const existingQuoteTodo = todos[dateKey].find(todo => {
                if (typeof todo === 'string') return false; // å­—ä¸²æ ¼å¼ä¸å¯èƒ½æ˜¯èªéŒ„
                const text = todo.text;
                return todo.isDailyQuote === true && text === quote;
            });

            if (existingQuoteTodo) {
                return; // å·²å­˜åœ¨ï¼Œä¸é‡è¤‡æ·»åŠ 
            }

            // æå–åœ–ç‰‡ä¸»è‰²èª¿
            const bgColor = await extractDominantColor(imageBase64);

            // ä½¿ç”¨ç‰©ä»¶æ ¼å¼å„²å­˜å¾…è¾¦äº‹é …ï¼Œæ¨™è¨˜ç‚ºæ¯æ—¥èªéŒ„
            todos[dateKey].push({
                text: quote,
                status: 'completed', // è‡ªå‹•æ¨™è¨˜ç‚ºå®Œæˆ
                isDailyQuote: true, // æ¨™è¨˜ç‚ºæ¯æ—¥èªéŒ„
                imageBase64: imageBase64, // ä¿å­˜åœ–ç‰‡ç”¨æ–¼æå–é¡è‰²
                bgColor: bgColor // ä¿å­˜æå–çš„èƒŒæ™¯é¡è‰²
            });

            saveTodos();

            // å¦‚æœç•¶å‰é¸ä¸­çš„æ˜¯é€™å€‹æ—¥æœŸï¼Œç«‹å³æ›´æ–°é¡¯ç¤º
            if (selectedDate && formatDateKey(selectedDate) === dateKey) {
                renderTodos(dateKey);
            }

            renderCalendar();
            renderAllTodosList();
        }

        function addTodo() {
            if (!selectedDate) {
                alert('è«‹å…ˆé¸æ“‡æ—¥æœŸ');
                return;
            }

            const input = document.getElementById('newTodoInput');
            const timeInput = document.getElementById('todoTimeInput');
            const todoText = input.value.trim();
            const todoTime = timeInput.value;

            if (!todoText) {
                alert('è«‹è¼¸å…¥å¾…è¾¦äº‹é …');
                return;
            }

            const dateKey = formatDateKey(selectedDate);

            if (!todos[dateKey]) {
                todos[dateKey] = [];
            }

            // ä½¿ç”¨ç‰©ä»¶æ ¼å¼å„²å­˜å¾…è¾¦äº‹é …ï¼ˆåŒ…å«æ™‚é–“ï¼‰
            const newTodo = { text: todoText, status: 'pending' };
            if (todoTime) {
                newTodo.time = todoTime;
                // è¨­å®šé€šçŸ¥
                scheduleNotification(todoText, dateKey, todoTime);
            }
            
            todos[dateKey].push(newTodo);
            saveTodos();
            renderTodos(dateKey);
            renderCalendar();
            renderAllTodosList(); // æ›´æ–°æ‰€æœ‰å¾…è¾¦äº‹é …åˆ—è¡¨
            input.value = '';
            timeInput.value = '';
        }

        // æ¨™è¨˜ç‚ºå®Œæˆï¼ˆé»æ“Šç¬¬äºŒæ¬¡å¯å–æ¶ˆï¼‰
        function markAsCompleted(dateKey, index) {
            if (todos[dateKey] && todos[dateKey][index] !== undefined) {
                const todo = todos[dateKey][index];
                let currentStatus = 'pending';

                // åˆ¤æ–·ç•¶å‰ç‹€æ…‹
                if (typeof todo === 'object') {
                    if (todo.status) {
                        currentStatus = todo.status;
                    } else if (todo.completed) {
                        currentStatus = 'completed';
                    } else if (todo.failed) {
                        currentStatus = 'failed';
                    }
                }

                // å¦‚æœå·²ç¶“æ˜¯å®Œæˆç‹€æ…‹ï¼Œé»æ“Šç¬¬äºŒæ¬¡å‰‡å–æ¶ˆï¼ˆè®Šå›æœªå®Œæˆï¼‰
                if (currentStatus === 'completed') {
                    todos[dateKey][index] = {
                        text: typeof todo === 'string' ? todo : (todo.text || todo),
                        status: 'pending'
                    };
                } else {
                    // å¦å‰‡æ¨™è¨˜ç‚ºå®Œæˆ
                    todos[dateKey][index] = {
                        text: typeof todo === 'string' ? todo : (todo.text || todo),
                        status: 'completed'
                    };
                }

                saveTodos();
                renderTodos(dateKey);
                renderCalendar();
                renderAllTodosList(); // æ›´æ–°æ‰€æœ‰å¾…è¾¦äº‹é …åˆ—è¡¨
            }
        }

        // æ¨™è¨˜ç‚ºå¤±æ•—ï¼ˆé»æ“Šç¬¬äºŒæ¬¡å¯å–æ¶ˆï¼‰
        function markAsFailed(dateKey, index) {
            if (todos[dateKey] && todos[dateKey][index] !== undefined) {
                const todo = todos[dateKey][index];
                let currentStatus = 'pending';

                // åˆ¤æ–·ç•¶å‰ç‹€æ…‹
                if (typeof todo === 'object') {
                    if (todo.status) {
                        currentStatus = todo.status;
                    } else if (todo.completed) {
                        currentStatus = 'completed';
                    } else if (todo.failed) {
                        currentStatus = 'failed';
                    }
                }

                // å¦‚æœå·²ç¶“æ˜¯å¤±æ•—ç‹€æ…‹ï¼Œé»æ“Šç¬¬äºŒæ¬¡å‰‡å–æ¶ˆï¼ˆè®Šå›æœªå®Œæˆï¼‰
                if (currentStatus === 'failed') {
                    todos[dateKey][index] = {
                        text: typeof todo === 'string' ? todo : (todo.text || todo),
                        status: 'pending'
                    };
                } else {
                    // å¦å‰‡æ¨™è¨˜ç‚ºå¤±æ•—
                    todos[dateKey][index] = {
                        text: typeof todo === 'string' ? todo : (todo.text || todo),
                        status: 'failed'
                    };
                }

                saveTodos();
                renderTodos(dateKey);
                renderCalendar();
                renderAllTodosList(); // æ›´æ–°æ‰€æœ‰å¾…è¾¦äº‹é …åˆ—è¡¨
            }
        }

        // ç§»é™¤å¾…è¾¦äº‹é …
        function removeTodo(dateKey, index) {
            if (todos[dateKey] && todos[dateKey][index] !== undefined) {
                todos[dateKey].splice(index, 1);

                // å¦‚æœé™£åˆ—ç‚ºç©ºï¼Œåˆªé™¤è©²æ—¥æœŸ
                if (todos[dateKey].length === 0) {
                    delete todos[dateKey];
                }

                saveTodos();
                renderTodos(dateKey);
                renderCalendar();
                renderAllTodosList(); // æ›´æ–°æ‰€æœ‰å¾…è¾¦äº‹é …åˆ—è¡¨
            }
        }

        // åˆ‡æ›æœˆä»½
        function changeMonth(delta) {
            currentDate.setMonth(currentDate.getMonth() + delta);
            renderCalendar();
            updateMonthYear();
            // å¦‚æœé¸ä¸­çš„æ—¥æœŸåœ¨æ–°æœˆä»½ä¸­ï¼Œä¿æŒé¸ä¸­ç‹€æ…‹
            if (selectedDate) {
                const selectedDateKey = formatDateKey(selectedDate);
                const selectedDayElement = document.querySelector(`[data-date-key="${selectedDateKey}"]`);
                if (selectedDayElement) {
                    updateSelectedDay();
                } else {
                    // å¦‚æœé¸ä¸­çš„æ—¥æœŸä¸åœ¨ç•¶å‰æœˆä»½ï¼Œæ¸…é™¤é¸ä¸­ç‹€æ…‹
                    selectedDate = null;
                    document.getElementById('selectedDateTitle').textContent = 'é¸æ“‡æ—¥æœŸ';
                    document.getElementById('todoList').innerHTML = '<p class="text-gray-400 text-sm text-center py-8">è«‹é¸æ“‡æ—¥æœŸæŸ¥çœ‹å¾…è¾¦äº‹é …</p>';
                    document.getElementById('addTodoForm').classList.add('hidden');
                }
            }
        }

        // æ ¼å¼åŒ–æ—¥æœŸç‚º key (YYYY-MM-DD)
        function formatDateKey(date) {
            const y = date.getFullYear();
            const m = String(date.getMonth() + 1).padStart(2, '0');
            const d = String(date.getDate()).padStart(2, '0');
            return `${y}-${m}-${d}`;
        }

        // æª¢æŸ¥æ˜¯å¦ç‚ºä»Šå¤©
        function isToday(date) {
            const today = new Date();
            return date.getFullYear() === today.getFullYear() &&
                   date.getMonth() === today.getMonth() &&
                   date.getDate() === today.getDate();
        }

        // å„²å­˜å¾…è¾¦äº‹é …åˆ° localStorage
        function saveTodos() {
            saveUserTodos();
        }

        // HTML è½‰ç¾©
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // æ”¯æ´ Enter éµæ–°å¢
        document.getElementById('newTodoInput')?.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                addTodo();
            }
        });

        // åˆå§‹åŒ–
        init();
    </script>

    <!-- Firebase SDKs -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc, collection } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Firebase é…ç½®
        let firebaseConfig;
        let firebaseEnabled = false;

        // å¼·åˆ¶æª¢æŸ¥ Firebase é…ç½®
        try {
            if (typeof __firebase_config !== 'undefined' && __firebase_config) {
                firebaseConfig = typeof __firebase_config === 'string'
                    ? JSON.parse(__firebase_config)
                    : __firebase_config;
                firebaseEnabled = true;
                console.log('âœ… Firebase é…ç½®å·²è¼‰å…¥');
            } else {
                console.error('âŒ æœªæª¢æ¸¬åˆ° Firebase é…ç½®');
                showFirebaseWarning();
                firebaseEnabled = false;
            }
        } catch (e) {
            console.error('âŒ Firebase é…ç½®è§£æå¤±æ•—:', e);
            showFirebaseWarning();
            firebaseEnabled = false;
        }

        // é¡¯ç¤º Firebase è­¦å‘Š
        function showFirebaseWarning() {
            const warningBanner = document.createElement('div');
            warningBanner.className = 'fixed top-0 left-0 right-0 bg-red-600 text-white p-4 z-50 shadow-lg';
            warningBanner.innerHTML = `
                <div class="max-w-6xl mx-auto flex items-center justify-between">
                    <div class="flex items-center gap-3">
                        <span class="text-2xl">âš ï¸</span>
                        <div>
                            <p class="font-bold">Firebase é€£ç·šå¤±æ•—</p>
                            <p class="text-sm">æ­¤æ‡‰ç”¨ç¨‹å¼éœ€è¦ Firebase é€£ç·šæ‰èƒ½æ­£å¸¸é‹ä½œã€‚è«‹æª¢æŸ¥ç¶²è·¯é€£ç·šæˆ– Firebase é…ç½®ã€‚</p>
                        </div>
                    </div>
                </div>
            `;
            document.body.insertBefore(warningBanner, document.body.firstChild);
            
            // ç¦ç”¨ä¸»è¦åŠŸèƒ½
            document.getElementById('evedayAppRoot').style.opacity = '0.5';
            document.getElementById('evedayAppRoot').style.pointerEvents = 'none';
        }

        // Firebase æ‡‰ç”¨ç¨‹å¼è­˜åˆ¥ç¢¼
        const APP_ID = typeof __app_id !== 'undefined' ? __app_id : 'eveday-calendar';

        // åˆå§‹åŒ– Firebase
        let app, auth, db;
        if (firebaseEnabled) {
            try {
                app = initializeApp(firebaseConfig);
                auth = getAuth(app);
                db = getFirestore(app, 'eveday');  // ä½¿ç”¨ eveday è³‡æ–™åº«
                
                // è‡ªå‹•åŒ¿åç™»å…¥
                signInAnonymously(auth).then(() => {
                    console.log('âœ… Firebase åŒ¿åç™»å…¥æˆåŠŸ');
                }).catch((error) => {
                    console.error('âŒ Firebase åŒ¿åç™»å…¥å¤±æ•—:', error);
                    showFirebaseWarning();
                });
                
                // ç›£è½èªè­‰ç‹€æ…‹
                onAuthStateChanged(auth, (user) => {
                    if (user) {
                        console.log('âœ… Firebase ä½¿ç”¨è€…å·²èªè­‰:', user.uid);
                        updateFirebaseStatus(true);
                    } else {
                        console.log('âš ï¸ Firebase ä½¿ç”¨è€…æœªèªè­‰');
                        updateFirebaseStatus(false);
                    }
                });
                
            } catch (e) {
                console.error('âŒ Firebase åˆå§‹åŒ–å¤±æ•—:', e);
                showFirebaseWarning();
                firebaseEnabled = false;
                updateFirebaseStatus(false);
            }
        } else {
            updateFirebaseStatus(false);
        }

        // å°‡ Firebase å¯¦ä¾‹å°å‡ºä¾›å…¶ä»–è…³æœ¬ä½¿ç”¨
        window.__firebaseApp = app;
        window.__firebaseAuth = auth;
        window.__firebaseDb = db;
        window.__firebaseEnabled = firebaseEnabled;
    </script>
</body>
</html>

