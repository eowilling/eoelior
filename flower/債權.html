<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å‚µæ¬Šç®¡ç†èˆ‡æ³•å¾‹ç­–ç•¥å„€è¡¨æ¿</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap');
        body { font-family: 'Noto Sans TC', sans-serif; background-color: #F5F5F4; color: #1C1917; }
        .chart-container { position: relative; width: 100%; max-width: 400px; margin: 0 auto; height: 300px; }
        .card { background-color: white; border-radius: 0.75rem; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06); transition: all 0.3s ease; }
        .card:hover { box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); }
        .relationship-node { width: 80px; height: 80px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold; position: absolute; transition: all 0.5s ease; border-width: 4px; z-index: 10; background: white; }
        .connection-line { position: absolute; height: 4px; background-color: #E5E7EB; transform-origin: 0 50%; transition: all 0.5s ease; z-index: 1; }
        .active-path { background-color: #F59E0B; } /* Amber-500 */
        .doc-preview { font-family: 'Courier New', Courier, monospace; white-space: pre-wrap; line-height: 1.6; }
        .tab-btn.active { border-bottom: 2px solid #F59E0B; color: #D97706; }
    </style>
    <!-- Chosen Palette: Warm Neutrals (Stone/Warm Gray) with Amber/Gold accents for financial/legal importance. -->
    <!-- Application Structure Plan:
         1. Header: Context setting.
         2. Strategy Control: Toggle between "Assignment" and "Authorization". This drives the entire app state.
         3. Analysis Grid:
            - Left: Relationship Visualizer (Canvas/CSS) to show who owns the debt.
            - Right: Financial Breakdown (Chart.js) to show value.
         4. Comparison Matrix: Textual pros/cons of the selected strategy.
         5. Document Engine: Live preview of the specific contracts needed for the active strategy.
    -->
    <!-- Visualization & Content Choices:
         - Relationship Map: CSS-based node graph. Goal: Clarify the abstract legal relationship. Shows A->B transfer vs A->B agency.
         - Debt Chart: Chart.js Donut. Goal: Visualize the asset being discussed.
         - Comparison Table: Dynamic HTML. Goal: Help B decide "Do I want to own this or just help?".
         - Live Docs: Text replacement. Goal: Immediate utility.
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
</head>
<body class="bg-stone-100 min-h-screen">

    <!-- Header -->
    <header class="bg-white shadow-sm border-b border-stone-200 sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 h-16 flex items-center justify-between">
            <div class="flex items-center gap-3">
                <div class="w-8 h-8 bg-amber-500 rounded flex items-center justify-center text-white font-bold">B</div>
                <h1 class="text-xl font-bold text-stone-800">å‚µæ¬Šç®¡ç†æ±ºç­–ç³»çµ±</h1>
            </div>
            <div class="text-sm text-stone-500">æ“ä½œè€…: å”åŠ©è€é—† (B) è™•ç† A ä¹‹å‚µå‹™</div>
        </div>
    </header>

    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8 space-y-8">

        <!-- Intro Section -->
        <section class="max-w-4xl mx-auto text-center space-y-4">
            <h2 class="text-3xl font-bold text-stone-900">è«‹é¸æ“‡æ³•å¾‹ç­–ç•¥</h2>
            <p class="text-stone-600">æ‚¨æ­£å”åŠ©è€é—† (B) è™•ç†é™³å¤§å‰ (A) å°æ—å¿—ç² (C) çš„å‚µæ¬Šã€‚è«‹é¸æ“‡ä»¥ä¸‹ä¸€ç¨®æ¨¡å¼ï¼Œç³»çµ±å°‡è‡ªå‹•ç”Ÿæˆå°æ‡‰çš„æ³•å¾‹æ–‡ä»¶èˆ‡åˆ†æã€‚</p>

            <!-- Strategy Toggle -->
            <div class="flex justify-center mt-6">
                <div class="bg-stone-200 p-1 rounded-lg inline-flex">
                    <button id="btn-assign" onclick="setStrategy('assignment')" class="px-6 py-2 rounded-md text-sm font-medium transition-all duration-200 shadow-sm bg-white text-stone-900 ring-1 ring-stone-900/5">
                        æƒ…å¢ƒä¸€ï¼šå‚µæ¬Šè®“èˆ‡ (è²·æ–·)
                    </button>
                    <button id="btn-auth" onclick="setStrategy('authorization')" class="px-6 py-2 rounded-md text-sm font-medium transition-all duration-200 text-stone-600 hover:text-stone-900">
                        æƒ…å¢ƒäºŒï¼šæˆæ¬Šå§”è¨— (ä»£è¨)
                    </button>
                </div>
            </div>
        </section>

        <!-- Dashboard Grid -->
        <div class="grid grid-cols-1 lg:grid-cols-12 gap-6">

            <!-- Left Column: Visualization & Context (5 cols) -->
            <div class="lg:col-span-5 space-y-6">

                <!-- Relationship Visualizer -->
                <div class="card p-6 min-h-[400px] flex flex-col">
                    <h3 class="text-lg font-bold text-stone-800 mb-2">æ³•å¾‹é—œä¿‚åœ–è§£</h3>
                    <p id="visual-desc" class="text-sm text-stone-500 mb-8">å±•ç¤ºå„æ–¹ä¹‹é–“çš„æ¬Šåˆ©æµå‹•ã€‚</p>

                    <div class="relative w-full h-64 bg-stone-50 rounded-lg border border-stone-100 overflow-hidden" id="diagram-container">
                        <!-- Dynamic Nodes & Lines implemented in JS/CSS below -->
                        <!-- A Node -->
                        <div id="node-a" class="relationship-node border-stone-300 text-stone-600" style="top: 20px; left: 20px;">
                            A<br><span class="text-xs font-normal">åŸå‚µæ¬Šäºº</span>
                        </div>
                        <!-- B Node -->
                        <div id="node-b" class="relationship-node border-amber-500 text-amber-700 bg-amber-50" style="top: 20px; right: 20px;">
                            B<br><span class="text-xs font-normal">è€é—†</span>
                        </div>
                        <!-- C Node -->
                        <div id="node-c" class="relationship-node border-stone-300 text-stone-600" style="bottom: 20px; left: 50%; transform: translateX(-50%);">
                            C<br><span class="text-xs font-normal">å‚µå‹™äºº</span>
                        </div>

                        <!-- Lines -->
                        <div id="line-ab" class="connection-line" style="top: 60px; left: 100px; width: calc(100% - 200px);"></div>
                        <div id="line-ac" class="connection-line" style="height: 100px; width: 4px; left: 100px; top: 100px; transform: rotate(25deg);"></div> <!-- Approx visual only -->

                        <!-- Status Badge -->
                        <div id="status-badge" class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-white px-4 py-2 rounded-full shadow border border-stone-200 text-sm font-bold text-center">
                            ç‹€æ…‹è¼‰å…¥ä¸­...
                        </div>
                    </div>
                </div>

                <!-- Strategy Comparison -->
                <div class="card p-6">
                    <h3 class="text-lg font-bold text-stone-800 mb-4">ç­–ç•¥åˆ†æ</h3>
                    <div class="space-y-4">
                        <div class="flex items-start gap-3">
                            <div class="mt-1 w-2 h-2 rounded-full bg-green-500 flex-shrink-0"></div>
                            <div>
                                <span class="block text-sm font-bold text-stone-700">å„ªé»</span>
                                <p id="analysis-pros" class="text-sm text-stone-600">...</p>
                            </div>
                        </div>
                        <div class="flex items-start gap-3">
                            <div class="mt-1 w-2 h-2 rounded-full bg-red-500 flex-shrink-0"></div>
                            <div>
                                <span class="block text-sm font-bold text-stone-700">é¢¨éšª/ç¼ºé»</span>
                                <p id="analysis-cons" class="text-sm text-stone-600">...</p>
                            </div>
                        </div>
                        <div class="flex items-start gap-3">
                            <div class="mt-1 w-2 h-2 rounded-full bg-blue-500 flex-shrink-0"></div>
                            <div>
                                <span class="block text-sm font-bold text-stone-700">æ‰€éœ€æ–‡ä»¶</span>
                                <p id="analysis-docs" class="text-sm text-stone-600 font-mono bg-stone-100 p-1 rounded mt-1">...</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Debt Composition Chart -->
                <div class="card p-6">
                    <h3 class="text-lg font-bold text-stone-800 mb-2">æ¨™çš„å‚µæ¬Šçµæ§‹</h3>
                     <div class="chart-container">
                        <canvas id="debtChart"></canvas>
                    </div>
                    <p class="text-xs text-center text-stone-400 mt-2">*æ­¤åœ–è¡¨ç‚ºç¯„ä¾‹æ•¸æ“šï¼Œå±•ç¤ºå‚µæ¬Šçµ„æˆ</p>
                </div>

            </div>

            <!-- Right Column: Document Generator (7 cols) -->
            <div class="lg:col-span-7 space-y-6">

                <!-- Inputs -->
                <div class="card p-6 border-l-4 border-amber-500">
                    <h3 class="text-lg font-bold text-stone-800 mb-4">è³‡æ–™è¼¸å…¥ (å³æ™‚é è¦½)</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label class="block text-xs font-bold text-stone-500 uppercase">è®“èˆ‡äºº/æˆæ¬Šäºº (A)</label>
                            <input type="text" id="input-a" value="é™³å¤§å‰" class="w-full mt-1 px-3 py-2 bg-stone-50 border border-stone-300 rounded focus:outline-none focus:ring-2 focus:ring-amber-500">
                        </div>
                        <div>
                            <label class="block text-xs font-bold text-stone-500 uppercase">è€é—†/å—è®“äºº (B)</label>
                            <input type="text" id="input-b" value="ç‹ç¸½ç¶“ç†" class="w-full mt-1 px-3 py-2 bg-stone-50 border border-stone-300 rounded focus:outline-none focus:ring-2 focus:ring-amber-500">
                        </div>
                        <div>
                            <label class="block text-xs font-bold text-stone-500 uppercase">å‚µå‹™äºº (C)</label>
                            <input type="text" id="input-c" value="æ—å¿—ç²" class="w-full mt-1 px-3 py-2 bg-stone-50 border border-stone-300 rounded focus:outline-none focus:ring-2 focus:ring-amber-500">
                        </div>
                        <div>
                            <label class="block text-xs font-bold text-stone-500 uppercase">å‚µæ¬Šé‡‘é¡ (æ–°å°å¹£)</label>
                            <input type="text" id="input-amount" value="å£¹ä½°ä¼æ‹¾è¬" class="w-full mt-1 px-3 py-2 bg-stone-50 border border-stone-300 rounded focus:outline-none focus:ring-2 focus:ring-amber-500">
                        </div>
                    </div>
                </div>

                <!-- Document Tabs -->
                <div class="bg-white rounded-t-lg border-b border-stone-200 px-4 pt-4 flex gap-6" id="doc-tabs">
                    <!-- Tabs injected by JS -->
                </div>

                <!-- Document Preview -->
                <div class="card rounded-t-none p-8 bg-white min-h-[600px] shadow-inner">
                    <div id="doc-content" class="doc-preview text-stone-800 text-sm md:text-base">
                        <!-- Content injected by JS -->
                    </div>
                </div>

                <!-- Action Button -->
                <div class="flex justify-end">
                    <button onclick="window.print()" class="bg-stone-800 hover:bg-stone-900 text-white px-8 py-3 rounded-lg shadow-lg flex items-center gap-2 transition-transform transform hover:-translate-y-1">
                        <span class="text-xl">ğŸ–¨ï¸</span> åˆ—å°/å­˜æª”ç•¶å‰æ–‡ä»¶
                    </button>
                </div>

            </div>
        </div>
    </main>

    <script>
        // --- State Management ---
        const state = {
            strategy: 'assignment', // 'assignment' or 'authorization'
            inputs: {
                aName: 'é™³å¤§å‰',
                bName: 'ç‹ç¸½ç¶“ç†',
                cName: 'æ—å¿—ç²',
                amount: 'å£¹ä½°ä¼æ‹¾è¬',
                source: '113å¹´5æœˆ10æ—¥ç°½è¨‚ä¹‹å€Ÿæ¬¾å¥‘ç´„',
                date: 'ä¸­è¯æ°‘åœ‹ 114 å¹´ 5 æœˆ 10 æ—¥'
            },
            activeTab: 0
        };

        // --- Templates from Generated Markdown ---
        const templates = {
            assignment: {
                title: "æƒ…å¢ƒä¸€ï¼šå‚µæ¬Šè®“èˆ‡ (è²·æ–·)",
                desc: "A å°‡å‚µæ¬Šè³£çµ¦ Bã€‚B æˆç‚ºæ–°å‚µæ¬Šäººï¼ŒC ç›´æ¥æ¬  B éŒ¢ã€‚",
                pros: "å‚µæ¬Šé—œä¿‚å–®ç´”åŒ–ï¼ŒB æ“æœ‰å®Œå…¨è™•åˆ†æ¬Š (å¯å†è½‰è®“ã€å…é™¤)ã€‚A å®Œå…¨è„«èº«ã€‚",
                cons: "B éœ€æ‰¿æ“” C ä¸é‚„éŒ¢çš„é¢¨éšªã€‚é€šå¸¸éœ€æ”¯ä»˜ A ä¸€ç­†å°åƒ¹ (è²·å‚µæ¬Š)ã€‚",
                docs: ["å‚µæ¬Šè®“èˆ‡å¥‘ç´„æ›¸", "ä¸‰æ–¹å”è­°æ›¸ (è®“èˆ‡ç‰ˆ)"],
                contents: [
                    `# å‚µæ¬Šè®“èˆ‡å¥‘ç´„æ›¸\n\nç«‹å¥‘ç´„æ›¸äººï¼š\nè®“èˆ‡äºº (A)ï¼š{{A}}\nå—è®“äºº (B)ï¼š{{B}}\n\nç¬¬ä¸€æ¢ è®“èˆ‡æ¨™çš„\nè®“èˆ‡äºº A å°‡å…¶å°å‚µå‹™äºº C (å§“åï¼š{{C}}) æ‰€äº«æœ‰ä¹‹ä¸‹åˆ—å‚µæ¬Š (ä¸‹ç¨±ç³»çˆ­å‚µæ¬Š)ï¼š\n1. å‚µå‹™é‡‘é¡ï¼šæ–°å°å¹£ {{AMOUNT}} å…ƒæ•´\n2. å‚µå‹™ä¾†æºï¼š{{SOURCE}}\n\næ‚‰æ•¸è®“èˆ‡äºˆå—è®“äºº Bã€‚\n\nç¬¬äºŒæ¢ è®“èˆ‡ç¯„åœ\næœ¬æ¬¡è®“èˆ‡åŒ…å«ä¸»å‚µæ¬ŠåŠå…¶é™„éš¨æ¬Šåˆ©ï¼ŒåŒ…æ‹¬åˆ©æ¯ã€é•ç´„é‡‘ã€æ“”ä¿æ¬Šåˆ©ç­‰ã€‚\n\nç¬¬ä¸‰æ¢ è®“èˆ‡å¾Œè²¬ä»»\nç°½ç½²æ—¥èµ·ï¼Œå‚µæ¬Šç”± B å…¨æ¬Šè¡Œä½¿ï¼ŒA ä¸å†è² å›æ”¶è²¬ä»»ã€‚\n\nç«‹ç´„äººç°½ç« ï¼š\nè®“èˆ‡äºº Aï¼š__________________\nå—è®“äºº Bï¼š__________________\n\næ—¥æœŸï¼š{{DATE}}`,

                    `# ä¸‰æ–¹å”è­°æ›¸ (å‚µæ¬Šè®“èˆ‡ç¢ºèª)\n\nç«‹å”è­°æ›¸äººï¼š\nå‚µæ¬Šäºº (A)ï¼š{{A}}\nå—è®“äºº (B)ï¼š{{B}}\nå‚µå‹™äºº (C)ï¼š{{C}}\n\nç¬¬ä¸€æ¢ å‚µå‹™ç¢ºèª\nC ç¢ºèªæ¬  A é‡‘é¡ï¼šæ–°å°å¹£ {{AMOUNT}} å…ƒæ•´ã€‚\n\nç¬¬äºŒæ¢ å‚µæ¬Šè®“èˆ‡\nA å·²å°‡ç³»çˆ­å‚µæ¬Šè®“èˆ‡äºˆ Bã€‚C ç¢ºèªæ”¶å—é€šçŸ¥ï¼Œä¸¦åŒæ„è‡ªå³æ—¥èµ·ï¼Œå°‡å° A ä¹‹æ¸…å„Ÿç¾©å‹™è½‰å‘ B å±¥è¡Œï¼Œå‘ B æ¸…å„Ÿäº¦ç”Ÿæ¸…å„Ÿäºˆ A ä¹‹æ•ˆåŠ›ã€‚\n\nç¬¬ä¸‰æ¢ é•ç´„è™•ç†\nè‹¥ C é²å»¶çµ¦ä»˜ï¼ŒB å¾—é€•è¡Œæ¡å–æ³•å¾‹é€”å¾‘ã€‚\n\nç°½ç½²ï¼š\nAï¼š__________  Bï¼š__________  Cï¼š__________\n\næ—¥æœŸï¼š{{DATE}}`
                ]
            },
            authorization: {
                title: "æƒ…å¢ƒäºŒï¼šæˆæ¬Šå§”è¨— (ä»£è¨)",
                desc: "A ä»æ˜¯å‚µæ¬Šäººï¼ŒB åªæ˜¯ã€Œæ‰“æ‰‹ã€æˆ–ä»£ç†äººã€‚",
                pros: "B ä¸éœ€å…ˆå‡ºè³‡è²·å‚µæ¬Šã€‚è‹¥ C ä¸é‚„éŒ¢ï¼Œæå¤±ä»åœ¨ A èº«ä¸Šã€‚",
                cons: "B çš„æ¬Šé™å—é™æ–¼æˆæ¬Šæ›¸ã€‚æ³•å¾‹ç¨‹åº (å¦‚èµ·è¨´) å¯èƒ½ä»éœ€ä»¥ A åç¾©é€²è¡Œã€‚",
                docs: ["æˆæ¬Šæ›¸", "ä¸‰æ–¹å”è­°æ›¸ (å§”è¨—ç‰ˆ)"],
                contents: [
                    `# æˆæ¬Šæ›¸\n\næœ¬äºº A ({{A}}) æˆæ¬Šå—ä»»äºº B ({{B}})\nå¾—å‘å‚µå‹™äºº C (å§“åï¼š{{C}}) ä»£ç‚ºè™•ç†å‚µå‹™ç›¸é—œäº‹å®œã€‚\n\nå‚µæ¬Šé‡‘é¡ï¼šæ–°å°å¹£ {{AMOUNT}} å…ƒæ•´\n\næˆæ¬Šç¯„åœï¼š\n1. ä»£ç‚ºå‚¬æ”¶ã€å”å•†ã€æ”¶å—è©²å‚µæ¬¾ã€‚\n2. ä»£ç‚ºç°½ç½²å”å•†èˆ‡é‚„æ¬¾æ–‡ä»¶ã€‚\n3. ä»£ç‚ºé€²è¡Œèª¿è§£æˆ–æ³•å¾‹å‰ç½®ä½œæ¥­ã€‚\n\nä»£æ”¶æ¬¾é …è™•ç†ï¼š\nB ä»£æ”¶ä¹‹æ¬¾é …ï¼Œæ‰£é™¤å ±é…¬å¾Œæ‡‰è½‰äº¤äºˆ Aã€‚\n\næˆæ¬Šäºº Aï¼š__________________\nå—ä»»äºº Bï¼š__________________\n\næ—¥æœŸï¼š{{DATE}}`,

                    `# ä¸‰æ–¹å”è­°æ›¸ (ä»£ç†æ¬Šç¢ºèª)\n\nç«‹å”è­°æ›¸äººï¼š\nå‚µæ¬Šäºº (A)ï¼š{{A}}\nå—è¨—äºº (B)ï¼š{{B}}\nå‚µå‹™äºº (C)ï¼š{{C}}\n\nç¬¬ä¸€æ¢ å‚µå‹™ç¢ºèª\nC ç¢ºèªæ¬  A é‡‘é¡ï¼šæ–°å°å¹£ {{AMOUNT}} å…ƒæ•´ã€‚\n\nç¬¬äºŒæ¢ æˆæ¬Šç¢ºèª\nA æˆæ¬Š B ä»£ç‚ºæ”¶å—ç³»çˆ­å‚µæ¬Šï¼ŒC åŒæ„ B ä¹‹èº«åˆ†ç‚º A ä¹‹åˆæ³•å—è¨—äººï¼Œä¸¦åŒæ„å‘ B å±¥è¡Œæ¸…å„Ÿç¾©å‹™ã€‚\n\nç°½ç½²ï¼š\nAï¼š__________  Bï¼š__________  Cï¼š__________\n\næ—¥æœŸï¼š{{DATE}}`
                ]
            }
        };

        // --- Core Functions ---

        function init() {
            // Listeners
            document.querySelectorAll('input').forEach(input => {
                input.addEventListener('input', updateData);
            });

            // Initial Render
            updateChart();
            render();
        }

        function setStrategy(strat) {
            state.strategy = strat;
            state.activeTab = 0; // Reset tab
            render();
            animateVisuals();
        }

        function setTab(index) {
            state.activeTab = index;
            renderDocs();
        }

        function updateData() {
            state.inputs.aName = document.getElementById('input-a').value;
            state.inputs.bName = document.getElementById('input-b').value;
            state.inputs.cName = document.getElementById('input-c').value;
            state.inputs.amount = document.getElementById('input-amount').value;
            renderDocs(); // Re-render text only
        }

        function render() {
            // 1. Update Buttons
            const btnAssign = document.getElementById('btn-assign');
            const btnAuth = document.getElementById('btn-auth');

            if (state.strategy === 'assignment') {
                btnAssign.className = "px-6 py-2 rounded-md text-sm font-medium transition-all duration-200 shadow-sm bg-amber-500 text-white shadow-md transform scale-105";
                btnAuth.className = "px-6 py-2 rounded-md text-sm font-medium transition-all duration-200 text-stone-500 hover:text-stone-900";
            } else {
                btnAssign.className = "px-6 py-2 rounded-md text-sm font-medium transition-all duration-200 text-stone-500 hover:text-stone-900";
                btnAuth.className = "px-6 py-2 rounded-md text-sm font-medium transition-all duration-200 shadow-sm bg-amber-500 text-white shadow-md transform scale-105";
            }

            // 2. Update Analysis Text
            const currentData = templates[state.strategy];
            document.getElementById('analysis-pros').textContent = currentData.pros;
            document.getElementById('analysis-cons').textContent = currentData.cons;
            document.getElementById('analysis-docs').textContent = currentData.docs.join(" + ");

            // 3. Update Visuals
            updateVisualNodes();

            // 4. Update Tabs & Docs
            renderTabs();
            renderDocs();
        }

        function renderTabs() {
            const tabsContainer = document.getElementById('doc-tabs');
            const currentDocs = templates[state.strategy].docs;

            tabsContainer.innerHTML = currentDocs.map((docName, index) => {
                const isActive = index === state.activeTab;
                const activeClass = isActive ? "border-b-4 border-amber-500 text-amber-600 font-bold bg-stone-50" : "text-stone-500 hover:text-stone-700";
                return `<button onclick="setTab(${index})" class="pb-3 px-4 text-sm focus:outline-none transition-colors ${activeClass}">
                            ${docName}
                        </button>`;
            }).join('');
        }

        function renderDocs() {
            const currentTemplate = templates[state.strategy].contents[state.activeTab];
            let content = currentTemplate
                .replace(/{{A}}/g, state.inputs.aName)
                .replace(/{{B}}/g, state.inputs.bName)
                .replace(/{{C}}/g, state.inputs.cName)
                .replace(/{{AMOUNT}}/g, state.inputs.amount)
                .replace(/{{SOURCE}}/g, state.inputs.source)
                .replace(/{{DATE}}/g, state.inputs.date);

            document.getElementById('doc-content').textContent = content;
        }

        // --- Visual Animation Logic ---
        function updateVisualNodes() {
            const badge = document.getElementById('status-badge');
            const lineAB = document.getElementById('line-ab');

            if (state.strategy === 'assignment') {
                // A sends Debt to B
                badge.innerHTML = "å‚µæ¬Šç§»è½‰ <span class='text-amber-500'>âœ</span>";
                badge.className = "absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-white px-4 py-2 rounded-full shadow-lg border-2 border-amber-500 text-sm font-bold text-center z-20 text-stone-800";

                lineAB.className = "connection-line active-path bg-amber-400"; // Solid active line
                lineAB.style.height = "6px";

            } else {
                // A authorizes B
                badge.innerHTML = "æˆäºˆä»£ç†æ¬Š <span class='text-blue-500'>â—</span>";
                badge.className = "absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-white px-4 py-2 rounded-full shadow-lg border-2 border-blue-500 text-sm font-bold text-center z-20 text-stone-800";

                lineAB.className = "connection-line bg-blue-300 border-t-4 border-dashed border-blue-500 h-0 bg-transparent"; // Dashed line
                lineAB.style.height = "0px"; // Reset for border trick
            }
        }

        function animateVisuals() {
            // Simple animation trigger for "wow" factor
            const nodes = document.querySelectorAll('.relationship-node');
            nodes.forEach(node => {
                node.style.transform = "scale(1.1)";
                setTimeout(() => node.style.transform = "scale(1)", 200);
            });
        }

        // --- Chart.js Implementation ---
        function updateChart() {
            const ctx = document.getElementById('debtChart').getContext('2d');

            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['æœ¬é‡‘ (Principal)', 'åˆ©æ¯ (Interest)', 'é•ç´„é‡‘ (Penalty)'],
                    datasets: [{
                        data: [1200000, 200000, 100000], // Mock breakdown of the 1.5M
                        backgroundColor: [
                            '#F59E0B', // Amber 500
                            '#78716C', // Stone 500
                            '#D6D3D1'  // Stone 300
                        ],
                        borderWidth: 0,
                        hoverOffset: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    cutout: '70%',
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                font: { family: "'Noto Sans TC', sans-serif" },
                                usePointStyle: true
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return context.label + ': ' + context.raw.toLocaleString() + ' TWD';
                                }
                            }
                        }
                    }
                }
            });
        }

        // Boot
        window.onload = init;

    </script>
</body>
</html>
